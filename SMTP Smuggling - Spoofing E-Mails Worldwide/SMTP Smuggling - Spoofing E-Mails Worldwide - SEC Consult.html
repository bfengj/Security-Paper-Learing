<!DOCTYPE html>
<!-- saved from url=(0078)https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/ -->
<html dir="ltr" lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<!-- 
	Website by LIMESODA Interactive Marketing GmbH | www.limesoda.com

	This website is powered by TYPO3 - inspiring people to share!
	TYPO3 is a free open source Content Management Framework initially created by Kasper Skaarhoj and licensed under GNU/GPL.
	TYPO3 is copyright 1998-2024 of Kasper Skaarhoj. Extensions are copyright of their respective owners.
	Information and contribution at https://typo3.org/
-->


<link rel="icon" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Icons/Favicons/favicon.ico" type="image/vnd.microsoft.icon">
<title>SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult</title>
<meta name="generator" content="TYPO3 CMS">
<meta name="description" content="Introducing a novel technique for e-mail spoofing">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="index,follow">
<meta property="og:title" content="SMTP Smuggling - Spoofing E-Mails Worldwide">
<meta property="og:type" content="article">
<meta property="og:url" content="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/">
<meta property="og:image" content="https://sec-consult.com/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_a19d49513f.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="538">
<meta property="og:description" content="Introducing a novel technique for e-mail spoofing">
<meta property="og:site_name" content="SEC Consult">
<meta name="twitter:card" content="summary">
<meta name="google" content="notranslate">
<meta name="apple-mobile-web-app-capable" content="no">


<link rel="stylesheet" href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/merged-97715fc5f4aac216a7458bcec51b1983-ca581b873e32691311c3bd4fe829f89c.css" media="all">


<script src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/manifest.js" defer="defer"></script>
<script src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/vendor.js" defer="defer"></script>
<script src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/main.js" defer="defer"></script>


<script id="ls-cookie-consent" type="application/json">{"groups":{"group-2":{"cookie-5":{"gtm-trigger":"","header":["<!-- Matomo Tag Manager -->\r\n<script>\r\nvar _mtm = window._mtm = window._mtm || [];\r\n_mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});\r\nvar d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\r\ng.async=true; g.src='https:\/\/sec-consult.com\/matomo\/js\/container_EbyLTruV.js'; s.parentNode.insertBefore(g,s);\r\n<\/script>\r\n<!-- End Matomo Tag Manager -->"]}}},"options":{"forceConsent":false,"hideOptions":false,"noTracking":false},"rootPid":1}</script>

    
        
    
        
    
        
    

<link rel="apple-touch-icon" sizes="180x180" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Icons/Favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Icons/Favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Icons/Favicons/favicon-16x16.png">
<link rel="manifest" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Icons/Favicons/site.webmanifest">
<link rel="mask-icon" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Icons/Favicons/safari-pinned-tab.svg" color="#ea8923">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">
<link rel="preload" as="font" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Fonts/Icons/icons.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Fonts/Roboto/roboto-v20-latin-500.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Fonts/Roboto/roboto-v20-latin-700.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="https://sec-consult.com/typo3conf/ext/sec_consult_base/Resources/Public/Fonts/Roboto/roboto-v20-latin-regular.woff2" type="font/woff2" crossorigin="anonymous">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"SEC Consult Unternehmensberatung GmbH","url":"https://sec-consult.com/","email":"office@sec-consult.com","logo":"https://sec-consult.com/fileadmin/user_upload/sec-consult/SEC-Consult-Logo.png","foundingDate":"2002","foundingLocation":{"@type":"City","name":"Wiener Neustadt"},"location":[{"@type":"LocalBusiness","address":{"@type":"PostalAddress","streetAddress":"Wagramer Straße 19 / 16. Stock","postalCode":"1220","addressRegion":"Wien","addressCountry":"Österreich"},"geo":{"@type":"GeoCoordinates","latitude":48.234870,"longitude":16.420800}}],"sameAs":["https://sec-consult.com","https://twitter.com/sec_consult","https://www.linkedin.com/company/sec-consult","https://www.xing.com/companies/secconsultunternehmensberatunggmbh"],"telephone":"+43 1 890 30 43 0"}</script>
<link rel="canonical" href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/">

<link rel="alternate" hreflang="en-us" href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/">
<link rel="alternate" hreflang="de-AT" href="https://sec-consult.com/de/blog/detail/smtp-smuggling-ein-neue-methode-zur-absenderfaelschung-in-e-mails/">
<link rel="alternate" hreflang="x-default" href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/">
</head>
<body id="p31" class="page-31 pagelevel-2 language-en backendlayout-default layout-0" itemscope="" itemtype="https://schema.org/WebPage">




<div class="wrapper"><header class="header"><div class="header-container"><nav class="navbar"><div class="navbar-left"><a class="navbar__home-link" title="Home" href="https://sec-consult.com/"><svg xmlns="http://www.w3.org/2000/svg" class="navbar-logo" id="Ebene_1" data-name="Ebene 1" viewBox="0 0 306.85 88.37" width="230" height="67"><defs><style>.cls-1{fill:#fff}.cls-3{fill:#333c42}</style></defs><path d="M306.85 61.56c0 2.87-2.31 5.19-5.17 5.19H5.17C2.32 66.75 0 64.43 0 61.56V5.19C0 2.32 2.31 0 5.17 0h296.51c2.85 0 5.17 2.32 5.17 5.19v56.37z" class="cls-1"></path><path d="M305.33 61.57c0 1.82-1.83 3.67-3.66 3.67H5.14c-1.83 0-3.63-1.8-3.63-3.67V5.2c0-1.83 1.78-3.68 3.65-3.68h296.51c1.81 0 3.66 1.85 3.66 3.67v56.38z" class="cls-3"></path><path d="M64.85 57.04c0 2.89-1.06 3.95-3.94 3.95H9.42c-2.89 0-3.94-1.06-3.94-3.95V9.49c0-2.89 1.06-3.95 3.94-3.95h51.49c2.89 0 3.94 1.06 3.94 3.95v47.55z" class="cls-1"></path><path fill="#6f8591" d="M35.44 6.23l8.51 17.24 19.03 2.77-13.77 13.42 3.25 18.95-17.02-8.95-17.02 8.95 3.25-18.95L7.9 26.24l19.03-2.77 8.51-17.24z"></path><path fill="#a2bfce" d="M35.44 6.23l8.51 17.24-3.65 10.19 22.68-7.42-13.77 13.42-7.27 4.49 10.52 14.46-17.02-8.95-5.7-6.69-11.32 15.64 3.25-18.95 5.36-7.21L7.9 26.24l18.42-2.68 9.13 3.61-.01-20.94z"></path><circle cx="35.41" cy="34.7" r="16.02" class="cls-1"></circle><path d="M50.34 34.7c0 8.24-6.68 14.93-14.93 14.93S20.48 42.95 20.48 34.7s6.68-14.93 14.93-14.93 14.93 6.68 14.93 14.93z" class="cls-3"></path><path d="M47.79 34.7c0 6.84-5.54 12.38-12.38 12.38S23.03 41.54 23.03 34.7s5.54-12.38 12.38-12.38 12.38 5.54 12.38 12.38z" class="cls-1"></path><path fill="#f7941d" d="M46.7 34.7c0 6.23-5.05 11.29-11.29 11.29S24.12 40.94 24.12 34.7s5.05-11.29 11.29-11.29S46.7 28.46 46.7 34.7z"></path><path d="M77.95 42.18c1.66.94 4.32 1.88 7.02 1.88 2.91 0 4.45-1.3 4.45-3.27s-1.33-2.96-4.7-4.22c-4.65-1.79-7.73-4.58-7.73-8.97 0-5.16 4.03-9.06 10.59-9.06 3.2 0 5.48.67 7.15 1.53l-1.41 5.47c-1.08-.58-3.12-1.44-5.82-1.44s-4.07 1.39-4.07 2.92c0 1.93 1.54 2.78 5.19 4.26 4.94 1.97 7.23 4.76 7.23 9.02 0 5.07-3.57 9.38-11.26 9.38-3.2 0-6.36-.94-7.94-1.88l1.29-5.61zm38.89-5.74h-10.3v7.18h11.51v5.61h-17.83V18.99h17.24v5.61h-10.93v6.28h10.3v5.56zm26.05 11.97c-1.12.58-3.78 1.3-7.15 1.3-9.68 0-14.67-6.55-14.67-15.16 0-10.32 6.81-16.02 15.29-16.02 3.28 0 5.78.67 6.9 1.35l-1.33 5.38c-1.25-.58-3.03-1.12-5.32-1.12-4.99 0-8.89 3.27-8.89 10 0 6.06 3.32 9.87 8.93 9.87 1.95 0 4.03-.4 5.32-.99l.91 5.38zm33.12 0c-1.12.58-3.78 1.3-7.15 1.3-9.68 0-14.67-6.55-14.67-15.16 0-10.32 6.81-16.02 15.29-16.02 3.28 0 5.78.67 6.9 1.35l-1.33 5.38c-1.25-.58-3.03-1.12-5.32-1.12-4.99 0-8.89 3.27-8.89 10 0 6.06 3.32 9.87 8.93 9.87 1.95 0 4.03-.4 5.32-.99l.91 5.38zm23.27-10.4c0 8.03-5.28 11.71-10.72 11.71-5.94 0-10.51-4.22-10.51-11.31s4.32-11.66 10.89-11.66c6.19 0 10.35 4.62 10.35 11.26zm-14.71.22c0 3.77 1.45 6.59 4.15 6.59 2.49 0 4.03-2.65 4.03-6.64 0-3.23-1.16-6.55-4.03-6.55s-4.15 3.36-4.15 6.59zm18.61-3.95c0-2.74-.08-5.02-.17-7h5.49l.29 3.05h.12a7.185 7.185 0 016.27-3.54c4.15 0 7.27 3.01 7.27 9.47v12.97h-6.32V37.07c0-2.83-.91-4.76-3.2-4.76-1.75 0-2.78 1.3-3.24 2.56-.17.45-.21 1.08-.21 1.7v12.65h-6.31V34.28zm24.31 9.02c1.16.76 3.57 1.62 5.44 1.62s2.7-.67 2.7-1.8-.62-1.7-2.95-2.56c-4.24-1.53-5.86-3.99-5.82-6.59 0-4.13 3.24-7.22 8.27-7.22 2.37 0 4.45.63 5.69 1.3l-1.08 4.71c-.91-.54-2.7-1.26-4.4-1.26-1.54 0-2.41.67-2.41 1.75s.79 1.61 3.28 2.56c3.86 1.44 5.44 3.59 5.49 6.77 0 4.13-2.95 7.13-8.77 7.13-2.66 0-5.03-.67-6.56-1.57l1.12-4.84zm37.23-1.12c0 2.87.08 5.2.17 7.04h-5.48l-.29-3.1H259c-.79 1.35-2.7 3.59-6.36 3.59-4.16 0-7.15-2.78-7.15-9.56V27.27h6.32v11.8c0 3.19.96 5.11 3.2 5.11 1.75 0 2.78-1.3 3.16-2.38.17-.4.25-.9.25-1.48V27.27h6.32v14.89zm5.07-24.81h6.32v31.85h-6.32V17.37zm18.49 3.99v5.92h4.53v5.02h-4.53v7.94c0 2.65.62 3.86 2.49 3.86.87 0 1.29-.05 1.87-.18l.04 5.16c-.79.31-2.33.58-4.07.58-2.04 0-3.74-.76-4.78-1.88-1.16-1.3-1.75-3.41-1.75-6.51V32.3h-2.7v-5.02h2.7V23.2l6.19-1.84z" class="cls-1"></path><path d="M147.59 88.37c-.66 0-1.24-.11-1.73-.33s-.88-.53-1.15-.93c-.27-.4-.4-.85-.4-1.35s.11-.91.34-1.31c.23-.39.6-.7 1.12-.94.52-.23 1.22-.35 2.1-.35h2.81v1.15h-2.75c-.8 0-1.34.13-1.62.4s-.42.59-.42.97c0 .44.17.78.52 1.05.35.26.83.39 1.44.39s1.13-.13 1.58-.4.78-.66.98-1.17l.32 1.11c-.21.52-.59.94-1.12 1.25-.54.31-1.21.46-2.03.46zm2.91-.1V86.4l-.08-.35v-3.2c0-.68-.2-1.21-.59-1.58-.4-.37-.99-.56-1.78-.56-.52 0-1.04.09-1.54.26s-.93.4-1.27.69l-.67-1.2c.46-.37 1.01-.65 1.65-.85.64-.2 1.31-.29 2.02-.29 1.22 0 2.15.3 2.81.89s.99 1.5.99 2.71v5.36h-1.52zm9.24-8.96c.73 0 1.36.14 1.92.42s.98.7 1.3 1.27c.31.57.47 1.29.47 2.16v5.11h-1.61v-4.92c0-.86-.21-1.51-.63-1.94s-1.01-.65-1.77-.65c-.57 0-1.07.11-1.49.33-.42.22-.75.55-.98.99s-.34.98-.34 1.62v4.57H155V79.4h1.54v2.39l-.25-.64c.29-.58.74-1.03 1.34-1.36s1.31-.49 2.11-.49zm13.07 7.5h6.83v1.46h-8.5V76.55h8.27v1.46h-6.6v8.8zm-.15-5.21h6.03v1.42h-6.03V81.6zm11.64 6.67l-3.88-8.87h1.67l3.45 8.03h-.8l3.52-8.03h1.57l-3.88 8.87h-1.64zm7.83-10.58c-.31 0-.57-.1-.78-.3s-.31-.45-.31-.74.1-.55.31-.75c.21-.2.47-.3.78-.3s.57.1.78.29c.21.2.31.44.31.73s-.1.56-.3.76c-.2.21-.46.31-.79.31zm-.8 10.58V79.4h1.61v8.87h-1.61zm8.33.1c-.86 0-1.63-.19-2.3-.57-.68-.38-1.21-.91-1.6-1.59-.39-.68-.59-1.47-.59-2.38s.19-1.69.59-2.37c.39-.68.92-1.2 1.6-1.58.68-.38 1.44-.57 2.3-.57.75 0 1.42.17 2.03.5s1.09.84 1.45 1.51c.36.67.54 1.51.54 2.51s-.18 1.84-.53 2.51c-.35.67-.83 1.18-1.43 1.52-.6.34-1.29.51-2.06.51zm.13-1.41c.56 0 1.06-.13 1.52-.39.45-.26.81-.62 1.07-1.1.26-.47.39-1.02.39-1.65s-.13-1.19-.39-1.65c-.26-.46-.62-.82-1.07-1.08-.45-.26-.96-.39-1.52-.39s-1.08.13-1.52.39c-.45.26-.8.62-1.07 1.08-.27.46-.4 1.01-.4 1.65s.13 1.17.4 1.65.62.84 1.07 1.1c.45.26.95.39 1.52.39zm3.03 1.31v-2.39l.1-2.06-.17-2.06v-5.91h1.61v12.42h-1.54zm8.54.1c-.95 0-1.78-.19-2.5-.59-.72-.39-1.28-.93-1.67-1.61s-.59-1.46-.59-2.34.19-1.66.58-2.34c.39-.68.92-1.21 1.59-1.6.67-.39 1.44-.58 2.28-.58s1.62.19 2.28.57c.66.38 1.17.91 1.55 1.6.37.69.56 1.49.56 2.4v.23c0 .09-.01.17-.03.25h-7.55v-1.15h6.71l-.65.4a3.02 3.02 0 00-.35-1.52c-.25-.45-.58-.8-1.01-1.05-.43-.25-.93-.38-1.5-.38s-1.06.13-1.49.38-.78.6-1.02 1.05c-.25.45-.37.97-.37 1.55v.27c0 .59.14 1.12.41 1.58.27.46.65.82 1.15 1.08.49.26 1.06.39 1.69.39.52 0 1-.09 1.43-.27.43-.18.81-.45 1.13-.8l.89 1.04c-.4.47-.9.83-1.5 1.07s-1.26.37-2 .37zm11.03-9.06c.73 0 1.36.14 1.92.42s.98.7 1.3 1.27c.31.57.47 1.29.47 2.16v5.11h-1.61v-4.92c0-.86-.21-1.51-.63-1.94s-1.01-.65-1.77-.65c-.57 0-1.07.11-1.49.33-.42.22-.75.55-.98.99s-.34.98-.34 1.62v4.57h-1.61V79.4h1.54v2.39l-.25-.64c.29-.58.74-1.03 1.34-1.36s1.31-.49 2.11-.49zm11.17 8.96V75.85h1.61v5.91l-.17 2.06.1 2.06v2.39h-1.54zm4.7.1c-.76 0-1.44-.17-2.05-.51-.61-.34-1.09-.85-1.44-1.52-.35-.67-.53-1.51-.53-2.51s.18-1.84.54-2.51c.36-.67.85-1.17 1.46-1.51.61-.33 1.28-.5 2.02-.5.87 0 1.64.19 2.31.57.67.38 1.2.91 1.59 1.58s.59 1.46.59 2.37-.2 1.7-.59 2.38-.92 1.21-1.59 1.59c-.67.38-1.44.57-2.31.57zm-.13-1.41c.57 0 1.08-.13 1.53-.39.45-.26.81-.62 1.07-1.1.26-.47.39-1.02.39-1.65s-.13-1.19-.39-1.65c-.26-.46-.62-.82-1.07-1.08-.45-.26-.96-.39-1.53-.39s-1.06.13-1.51.39c-.45.26-.81.62-1.07 1.08-.26.46-.39 1.01-.39 1.65s.13 1.17.39 1.65.62.84 1.07 1.1c.45.26.96.39 1.51.39zm10.58 1.41c-.76 0-1.43-.14-2-.42-.57-.28-1.02-.71-1.34-1.28-.32-.57-.48-1.3-.48-2.17v-5.11h1.61v4.92c0 .87.21 1.52.63 1.96.42.44 1.01.65 1.77.65.56 0 1.04-.11 1.46-.34s.73-.56.95-1c.22-.44.33-.97.33-1.6v-4.59h1.61v8.87h-1.52v-2.39l.25.64c-.29.59-.73 1.05-1.31 1.37-.58.32-1.23.49-1.96.49zm10.14 0c-.74 0-1.44-.1-2.1-.3-.66-.2-1.19-.45-1.56-.74l.67-1.27c.38.26.85.47 1.41.65.56.18 1.13.27 1.71.27.75 0 1.29-.11 1.61-.32s.49-.51.49-.89c0-.28-.1-.5-.3-.65-.2-.16-.47-.27-.79-.35s-.69-.15-1.1-.21c-.4-.06-.8-.14-1.2-.23-.4-.09-.77-.23-1.11-.4-.33-.17-.6-.41-.8-.72s-.3-.72-.3-1.23.15-1 .45-1.41c.3-.4.73-.71 1.28-.93.55-.22 1.21-.33 1.97-.33.58 0 1.17.07 1.77.21s1.09.34 1.46.59l-.69 1.27c-.4-.27-.82-.45-1.26-.55-.44-.1-.87-.15-1.31-.15-.7 0-1.23.11-1.57.34s-.52.52-.52.88c0 .3.1.53.31.69.21.16.47.29.8.38s.69.16 1.1.23c.4.06.8.14 1.21.23.4.1.77.23 1.1.39s.6.4.8.7c.21.3.31.7.31 1.21 0 .54-.16 1-.47 1.39s-.75.69-1.32.91-1.25.33-2.04.33zm6.64-10.68c-.31 0-.57-.1-.78-.3s-.31-.45-.31-.74.1-.55.31-.75c.21-.2.47-.3.78-.3s.57.1.78.29c.21.2.31.44.31.73s-.1.56-.3.76c-.2.21-.46.31-.79.31zm-.8 10.58V79.4h1.61v8.87h-1.61zm9.41-8.96c.73 0 1.36.14 1.92.42s.98.7 1.3 1.27c.31.57.47 1.29.47 2.16v5.11h-1.61v-4.92c0-.86-.21-1.51-.63-1.94s-1.01-.65-1.77-.65c-.57 0-1.07.11-1.49.33-.42.22-.75.55-.98.99s-.34.98-.34 1.62v4.57h-1.61V79.4h1.54v2.39l-.25-.64c.29-.58.74-1.03 1.34-1.36s1.31-.49 2.11-.49zm10.61 9.06c-.95 0-1.78-.19-2.5-.59-.72-.39-1.28-.93-1.67-1.61s-.59-1.46-.59-2.34.19-1.66.58-2.34c.39-.68.92-1.21 1.59-1.6.67-.39 1.44-.58 2.28-.58s1.62.19 2.28.57c.66.38 1.17.91 1.55 1.6.37.69.56 1.49.56 2.4v.23c0 .09-.01.17-.03.25h-7.55v-1.15h6.71l-.65.4a3.02 3.02 0 00-.35-1.52c-.25-.45-.58-.8-1.01-1.05-.43-.25-.93-.38-1.5-.38s-1.06.13-1.49.38-.78.6-1.02 1.05c-.25.45-.37.97-.37 1.55v.27c0 .59.14 1.12.41 1.58.27.46.65.82 1.15 1.08.49.26 1.06.39 1.69.39.52 0 1-.09 1.43-.27.43-.18.81-.45 1.13-.8l.89 1.04c-.4.47-.9.83-1.5 1.07s-1.26.37-2 .37zm8.84 0c-.74 0-1.44-.1-2.1-.3-.66-.2-1.19-.45-1.56-.74l.67-1.27c.38.26.85.47 1.41.65.56.18 1.13.27 1.71.27.75 0 1.29-.11 1.61-.32s.49-.51.49-.89c0-.28-.1-.5-.3-.65-.2-.16-.47-.27-.79-.35s-.69-.15-1.1-.21c-.4-.06-.8-.14-1.2-.23-.4-.09-.77-.23-1.11-.4-.33-.17-.6-.41-.8-.72s-.3-.72-.3-1.23.15-1 .45-1.41c.3-.4.73-.71 1.28-.93.55-.22 1.21-.33 1.97-.33.58 0 1.17.07 1.77.21s1.09.34 1.46.59l-.69 1.27c-.4-.27-.82-.45-1.26-.55-.44-.1-.87-.15-1.31-.15-.7 0-1.23.11-1.57.34s-.52.52-.52.88c0 .3.1.53.31.69.21.16.47.29.8.38s.69.16 1.1.23c.4.06.8.14 1.21.23.4.1.77.23 1.1.39s.6.4.8.7c.21.3.31.7.31 1.21 0 .54-.16 1-.47 1.39s-.75.69-1.32.91-1.25.33-2.04.33zm8.38 0c-.74 0-1.44-.1-2.1-.3-.66-.2-1.19-.45-1.56-.74l.67-1.27c.38.26.85.47 1.41.65.56.18 1.13.27 1.71.27.75 0 1.29-.11 1.61-.32s.49-.51.49-.89c0-.28-.1-.5-.3-.65-.2-.16-.47-.27-.79-.35s-.69-.15-1.1-.21c-.4-.06-.8-.14-1.2-.23-.4-.09-.77-.23-1.11-.4-.33-.17-.6-.41-.8-.72s-.3-.72-.3-1.23.15-1 .45-1.41c.3-.4.73-.71 1.28-.93.55-.22 1.21-.33 1.97-.33.58 0 1.17.07 1.77.21s1.09.34 1.46.59l-.69 1.27c-.4-.27-.82-.45-1.26-.55-.44-.1-.87-.15-1.31-.15-.7 0-1.23.11-1.57.34s-.52.52-.52.88c0 .3.1.53.31.69.21.16.47.29.8.38s.69.16 1.1.23c.4.06.8.14 1.21.23.4.1.77.23 1.1.39s.6.4.8.7c.21.3.31.7.31 1.21 0 .54-.16 1-.47 1.39s-.75.69-1.32.91-1.25.33-2.04.33z"></path></svg></a></div><div class="navbar-right"><div class="navbar-toggle"><span class="sr-only" id="toggle-btn">Toggle Navbar</span><button class="navbar-toggle" data-toggle="#mainNav" data-toggle-global="" aria-labelledby="toggle-btn"><span class="navbar-toggle--top"></span><span class="navbar-toggle--middle"></span><span class="navbar-toggle--bottom"></span></button></div><div class="navbar-nav" id="mainNav" data-toggle-animate=""><div class="nav-top"><div class="nav-top__item"><ul class="meta-nav"><li class="meta-nav__item"><a class="meta-nav__link" href="https://sec-consult.com/career/">Career</a></li><li class="meta-nav__item"><a class="meta-nav__link" href="https://sec-consult.com/about-us/">About us</a></li><li class="meta-nav__item"><a class="meta-nav__link" href="https://sec-consult.com/contact/">Contact</a></li></ul></div><div class="nav-top__item"><ul id="language-nav" class="language-nav language-nav--0"><li class="language-nav__item language-nav__item--dropdown" data-toggle-hover=""><a class="language-nav__link language-nav__link--dropdown language-nav__link--active" href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" data-toggle-media="" data-toggle="#languageNav" aria-expanded="false" data-toggle-group="navbar">
                            EN
                        </a><div class="language-nav__dropdown" id="languageNav" data-toggle-animate=""><ul class="language-nav language-nav--1"><li class="language-nav__item"><a class="language-nav__link" href="https://sec-consult.com/de/blog/detail/smtp-smuggling-ein-neue-methode-zur-absenderfaelschung-in-e-mails/" hreflang="de-AT" title="German">
                                                        DE
                                                    </a></li></ul></div></li></ul></div><div class="nav-top__item"><div class="nav-search"><button class="nav-search__toggle" data-toggle-media="" data-toggle-global="" data-toggle="#searchContainer" type="button" aria-label="Toggle Search"><span class="i-search"></span><span class="i-close"></span></button><div id="searchContainer" class="nav-search__container" data-toggle-animate=""><form action="https://sec-consult.com/search/" class="nav-search__form" id="searchForm" method="get"><label class="label nav-search__label" id="input-label" for="input-id" aria-label="Search"><span class="sr-only">Search</span><input type="text" id="input-id" class="input__field nav-search__input" name="tx_indexedsearch_pi2[search][sword]" placeholder="Enter search term"><input type="hidden" name="tx_indexedsearch_pi2[action]" value="search"><input type="hidden" name="tx_indexedsearch_pi2[controller]" value="Search"></label><button type="submit" class="nav-search__submit" aria-label="Search"><span class="i-search"></span></button></form></div></div></div></div><div class="nav-bottom"><ul class="main-nav main-nav--0" role="menu"><li class="main-nav__item main-nav__item--0 main-nav__item--dropdown" role="none" data-toggle-hover=""><span class="main-nav__link main-nav__link--no-link main-nav__link--0" tabindex="0" role="menuitem" data-toggle-media="" data-toggle="#dropdown9" aria-expanded="false" data-toggle-group="navbar">
                            Security Testing
                        </span><button class="main-nav__mobile-toggle" type="button" data-toggle-no-media="" data-toggle="#dropdown9" aria-expanded="false"><span class="i-down-open"></span></button><div class="main-nav__dropdown main-nav__dropdown--0" id="dropdown9" data-toggle-animate=""><ul class="main-nav main-nav--1"><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/web-application-security/" class="main-nav__link main-nav__link--1">
                                        Web Application Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/penetration-testing/" class="main-nav__link main-nav__link--1">
                                        Penetration Testing
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/mobile-security/" class="main-nav__link main-nav__link--1">
                                        Mobile Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/cloud-security/" class="main-nav__link main-nav__link--1">
                                        Cloud Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/it-infrastructure-security/" class="main-nav__link main-nav__link--1">
                                        IT Infrastructure Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/security-for-sap-services/" class="main-nav__link main-nav__link--1">
                                        Security for SAP Services
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/iot-and-embedded-systems-security/" class="main-nav__link main-nav__link--1">
                                        IoT and Embedded Systems Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/red-teaming/" class="main-nav__link main-nav__link--1">
                                        Red Teaming
                                    </a></li></ul></div></li><li class="main-nav__item main-nav__item--0 main-nav__item--dropdown" role="none" data-toggle-hover=""><span class="main-nav__link main-nav__link--no-link main-nav__link--0" tabindex="0" role="menuitem" data-toggle-media="" data-toggle="#dropdown20" aria-expanded="false" data-toggle-group="navbar">
                            Processes &amp; Organisation
                        </span><button class="main-nav__mobile-toggle" type="button" data-toggle-no-media="" data-toggle="#dropdown20" aria-expanded="false"><span class="i-down-open"></span></button><div class="main-nav__dropdown main-nav__dropdown--0" id="dropdown20" data-toggle-animate=""><ul class="main-nav main-nav--1"><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/processes-organisation/information-security-management-ism/" class="main-nav__link main-nav__link--1">
                                        Information Security Management (ISM)
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/processes-organisation/network-and-information-systems-security-nis/" class="main-nav__link main-nav__link--1">
                                        Network and Information Systems Security (NIS)
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/processes-organisation/ot-security/" class="main-nav__link main-nav__link--1">
                                        OT Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/processes-organisation/secure-software-development/" class="main-nav__link main-nav__link--1">
                                        Secure Software Development Consulting
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/security-testing/red-teaming/" class="main-nav__link main-nav__link--1">
                                        Red Teaming
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/processes-organisation/sec-trainings/" class="main-nav__link main-nav__link--1">
                                        SEC Trainings
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/processes-organisation/project-und-program-management/" class="main-nav__link main-nav__link--1">
                                        Project- und Program Management
                                    </a></li></ul></div></li><li class="main-nav__item main-nav__item--0 main-nav__item--dropdown" role="none" data-toggle-hover=""><span class="main-nav__link main-nav__link--no-link main-nav__link--0" tabindex="0" role="menuitem" data-toggle-media="" data-toggle="#dropdown26" aria-expanded="false" data-toggle-group="navbar">
                            Incident Response
                        </span><button class="main-nav__mobile-toggle" type="button" data-toggle-no-media="" data-toggle="#dropdown26" aria-expanded="false"><span class="i-down-open"></span></button><div class="main-nav__dropdown main-nav__dropdown--0" id="dropdown26" data-toggle-animate=""><ul class="main-nav main-nav--1"><li class="main-nav__item main-nav__item--1" role="none"><a href="https://sec-consult.com/incident-response/sec-defence/" class="main-nav__link main-nav__link--1">
                                        SEC Defence
                                    </a></li></ul></div></li><li class="main-nav__item main-nav__item--0" role="none"><a href="https://sec-consult.com/vulnerability-lab/" class="main-nav__link main-nav__link--0" role="menuitem">
                            Vulnerability Lab
                        </a></li><li class="main-nav__item main-nav__item--0" role="none"><a href="https://sec-consult.com/blog/" class="main-nav__link main-nav__link--0" role="menuitem">
                            Blog
                        </a></li></ul></div></div></div><a class="navbar-incident" href="https://sec-consult.com/incident-response/sec-defence/"><div class="navbar-incident__left"><span class="i-incident"></span><br><span>Incident?</span></div><div class="navbar-incident__right">
                                
                                    Breached?<br>Report an incident
                                
                            </div></a></nav></div></header><section role="main" itemprop="mainContentOfPage"><div class="content-wrapper"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://sec-consult.com/blog/","name":"Blog"}}]}</script><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="https://sec-consult.com/" target="">
                                Home
                            </a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="https://sec-consult.com/blog/" target="">
                                Blog
                            </a></li><li class="breadcrumbs__item"><span class="breadcrumbs__text">SMTP Smuggling - Spoofing E-Mails Worldwide</span></li></ol></nav><!--TYPO3SEARCH_begin--><section class="section section__list section__default--news_pi1"><div id="c42" class="frame frame-default frame-type-list frame-layout-0"><div class="news news-single"><div class="article" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="news-detail news-detail--default"><div class="news-detail__top"><h1 itemprop="headline">SMTP Smuggling - Spoofing E-Mails Worldwide</h1><time class="news-detail__date" itemprop="datePublished" datetime="2023-12-18">
                    18.12.2023
                </time><div class="news-detail__teaser news-detail__teaser--no-container" itemprop="description"><p>Introducing a novel technique for e-mail spoofing</p></div><figure class="news-detail__figure"><picture><source srcset="/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_7f33eb8f68.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_195f68e383.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_28f58303d8.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_715ff8579a.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_1ec709623c.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_1d155a3b18.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_6f99720678.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/a/8/csm_SMTP_Smuggling-Overview_Header_47977b1a86.png" type="image/png" media="(min-width: 100px)"><img class="news-detail__img" loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/csm_SMTP_Smuggling-Overview_Header_1ec709623c.png" width="1110" height="498" alt="Overview SMTP Smuggling"></picture></figure></div><div class="news-detail__text" itemprop="articleBody"><p><em>In the course of a research project in collaboration with the SEC Consult Vulnerability Lab, Timo Longin (<a href="https://twitter.com/timolongin" target="_blank" rel="noreferrer noopener">@timolongin</a>) - known for his <a href="https://sec-consult.com/blog/detail/taking-over-a-country-kaminsky-style/" target="_blank">DNS protocol attacks</a> - discovered a novel exploitation technique for yet another Internet protocol - SMTP (<a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" target="_blank" rel="noreferrer">Simple Mail Transfer Protocol</a>). Threat actors could abuse vulnerable SMTP servers worldwide to send malicious e-mails from arbitrary e-mail addresses, allowing targeted phishing attacks. Due to the nature of the exploit itself, this type of vulnerability was dubbed <strong>SMTP smuggling</strong>. Multiple 0-days were discovered, and various vendors were notified during our responsible disclosure in 2023.&nbsp;</em></p></div><section class="section section__text section--alternative-background"><div id="c4716" class="frame frame-default frame-type-text frame-layout-0"><header><h2>
                Update on SMTP smuggling and responsible disclosure
            </h2></header><p>Update 2024-02-19: The SMTP smuggling research scored 3rd place in the Portswigger Top 10 web hacking techniques of 2023, check it out here: <a href="https://portswigger.net/research/top-10-web-hacking-techniques-of-2023" target="_blank" rel="noreferrer">portswigger.net/research/top-10-web-hacking-techniques-of-2023</a></p><p>Update 2024: We have created a new website which gives a short summary about the identified vulnerability, available tools and mitigations of various vendors: <a href="https://smtpsmuggling.com/" target="_blank" rel="noreferrer">smtpsmuggling.com</a></p><p>Update, 2023-12-22: We were made aware of public discussions about the SMTP smuggling research on various platforms and we wanted to add some input regarding responsible disclosure as well as previous and further communication with the vendors.</p><p>We strictly adhere to our responsible disclosure processes (<a href="https://sec-consult.com/vulnerability-lab/responsible-disclosure-policy/" target="_blank">https://sec-consult.com/vulnerability-lab/responsible-disclosure-policy/</a>) and always contact affected vendors before any publication. But in this case a lack of clarity in the communication and different interpretations of the impact of the vulnerability led to assumptions from all parties involved on who is affected, what the real impact could be and who has to be notified before publication.</p><p>As documented in the timeline of the blog post, the vulnerabilities were initially identified in June 2023 and after further internal research we contacted the specific, affected vendors (Microsoft, Cisco, GMX/Ionos). GMX and Microsoft fixed the issues promptly. But after receiving some feedback from Cisco, that our identified vulnerability is just a feature of the software and not a bug/vulnerability, we contacted CERT/CC on 17th August to get some help for further discussion with Cisco and involve other potentially affected vendors (such as sendmail) through the <a href="https://kb.cert.org/vince/" target="_blank" rel="noreferrer">VINCE communication platform</a>.</p><p>There, we submitted all our research details and explained the case to the vendors involved. We received feedback from Cisco that our identified research is not a vulnerability, but a feature and that they will not change the default configuration nor inform their customers. Other vendors did not respond in VINCE but were contacted by CERT/CC.</p><p>Based on this feedback and as multiple other vendors were included in this discussion through the CERT/CC VINCE platform without objecting, we wrongly assessed the broader impact of the SMTP smuggling research. Because of this assumption, we asked CERT/CC end of November regarding publication of the details and received confirmation to proceed.</p><p>As our research was accepted at this year's 37C3 conference (info received on 3rd December) and we still thought that Cisco users should be warned about the vulnerable default configuration, we decided to publish our research before the conference and holidays in order to provide administrators time to re-configure their Cisco configuration. Hence, we also contacted CERT-Bund (BSI Germany) and CERT.at on 5th December via encrypted email and informed them about the planned release date of the blog post for 18th December and included the full blog post details and further call for action to warn Cisco users.<br><br> Furthermore, we continue discussing SMTP smuggling with CERT/CC and affected vendors through the VINCE platform to address future remediation and measures.</p><p><br> Our learnings from this case are that we will put even more thought into potential broader impact when sharing details with affected vendors and to strengthen the collaboration and communication with all parties involved.</p><p>&nbsp;</p><h2>Postfix remediation and workaround</h2><p>Postfix developers Wietse Venema and Viktor Dukhovni have promptly responded to the SMTP smuggling threat and released short-term workarounds on how the vulnerability can be fixed:</p><p><a href="https://www.postfix.org/smtp-smuggling.html" target="_blank" rel="noreferrer">https://www.postfix.org/smtp-smuggling.html</a></p><h3>&nbsp;</h3><h3>Official tools to test for SMTP smuggling issues are now available on <a href="https://github.com/The-Login/SMTP-Smuggling-Tools" target="_blank" rel="noreferrer">GitHub</a></h3></div></section><section class="section section__textpic"><div id="c4608" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_full__02_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/9/f/csm_SMTP_Smuggling-SMTP_session_example_full__02__805c61822c.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/9/f/csm_SMTP_Smuggling-SMTP_session_example_full__02__eaded2b254.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/9/f/csm_SMTP_Smuggling-SMTP_session_example_full__02__12ad94fa9b.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/9/f/csm_SMTP_Smuggling-SMTP_session_example_full__02__a063caee35.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_full__02_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_full__02_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_full__02_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_full__02_.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_full__02_.png" width="537" height="553" alt="Example SMTP session between sender.example and receiver.example "></picture></a><figcaption class="image-caption">
            Figure 1: Example SMTP session between sender.example and receiver.example 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Novel attacks in SMTP? Yes, you read that right - <strong>SMTP!&nbsp;</strong></p><p>Even though SMTP, the Simple Mail Transfer Protocol, is used for sending e-mails across the globe since the beginning of the Internet, it is still possible to find new ways of exploiting it even in 2023! So, <strong>fasten your seat belts</strong>, as we embark on an expedition beyond the known limits of SMTP, and venture into the uncharted territories of <strong>SMTP smuggling</strong>!&nbsp;</p><h2>TL;DR&nbsp;</h2><p>By exploiting interpretation differences of the SMTP protocol, it is possible to smuggle/send spoofed e-mails - hence SMTP smuggling - while still passing SPF alignment checks. During this research, two types of SMTP smuggling, <strong>outbound</strong> and <strong>inbound</strong>, were discovered. These allowed sending spoofed e-mails <strong>from millions</strong> of domains (e.g., admin@outlook.com) to millions of receiving SMTP servers (e.g., Amazon, PayPal, eBay). Identified vulnerabilities in Microsoft and GMX were quickly fixed, however, <strong>SEC Consult urges</strong> companies using the also affected <a href="https://www.cisco.com/site/in/en/products/security/secure-email/index.html" target="_blank" rel="noreferrer">Cisco Secure Email</a> product to manually update their vulnerable default configuration (see Responsible Disclosure section below)!&nbsp;</p><h2>&nbsp;</h2><h2>SMTP Basics&nbsp;</h2><p>Before getting into the juicy bits and details of SMTP smuggling, we must first have a basic understanding of the SMTP protocol, SMTP terminology and e-mailing in general. Let's learn by example!&nbsp;</p><p>Here, in figure 1, we have an SMTP session between sender.example and receiver.example.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4609" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_only_sender__03_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/1/a/csm_SMTP_Smuggling-SMTP_session_example_only_sender__03__0164bca620.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/1/a/csm_SMTP_Smuggling-SMTP_session_example_only_sender__03__cd9e99910f.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/1/a/csm_SMTP_Smuggling-SMTP_session_example_only_sender__03__13e72eb70f.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/1/a/csm_SMTP_Smuggling-SMTP_session_example_only_sender__03__2297541ee0.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender__03_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender__03_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender__03_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/1/a/csm_SMTP_Smuggling-SMTP_session_example_only_sender__03__6aab3f43ae.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_only_sender__03_.png" width="614" height="227" alt="SMTP session transferring a mail object, including mail envelope and mail content/data, with SMTP commands, line breaks and data separated by color. "></picture></a><figcaption class="image-caption">
            Figure 2: SMTP session transferring a mail object, including mail envelope and mail content/data, with SMTP commands, line breaks and data separated by color. 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>So, what's exactly going on here?&nbsp;</p><ol><li>Initially, the receiving SMTP server <strong>mx.receiver.example</strong> sends a greeting, indicating that it is ready to accept incoming SMTP commands.&nbsp;</li><li>The "client"/sender <strong>sender.example</strong> initiates the SMTP session by sending the EHLO (extended hello) <strong>SMTP command</strong> to the server, specifying its domain name. Note that all SMTP commands will be highlighted in red.&nbsp;</li><li><strong>mx.receiver.example</strong> responds with a 250 status code, indicating that the requested command (EHLO) was successful. It also provides supported <strong>SMTP capabilities</strong>.&nbsp;</li><li>Then, <strong>sender.example</strong> specifies the sender e-mail address as well as the receiver e-mail address via "mail FROM" and "rcpt TO" in the mail <strong>envelope</strong>. <strong>mx.receiver.example</strong> confirms both of these <strong>SMTP commands</strong> with a 250 status code.&nbsp;</li><li>Now, <strong>sender.example</strong> transmits the "data" command to signal its intention to start sending the message data/content.&nbsp;</li><li>After receiving a "go ahead" response, <strong>sender.example</strong> sends <strong>message</strong><strong>headers</strong> "Subject"/"From"/"To", a <strong>message body</strong> "lorem ipsum" and an <strong>end-of-data sequence</strong><strong>"&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;"</strong> (Carriage-Return / Line-Feed, and a single dot in a line). Note that all message data will be highlighted in blue.&nbsp;</li><li><strong>mx.receiver.example</strong> reads the end-of-data sequence and responds with a 250 status code, implying that the message data was accepted.&nbsp;</li><li>Lastly, <strong>sender.example</strong> closes the connection via the "quit" command.&nbsp;</li></ol><p>As you can see, there is a lot of back and forth in this SMTP session. To keep it simple and concise, SMTP sessions in this blog post <strong>only</strong> include the data transmitted by the sender as shown in figure 2.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4610" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Sending_e-mails_overview__3__04_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/5/d/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__6a38bcd2d7.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/5/d/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__bf4406ff80.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/5/d/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__6ccd48c07e.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/5/d/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__6429ff2d75.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/5/d/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__d48082ab2d.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/5/d/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__5d27cf5044.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/5/d/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__14d8bc127c.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/5/d/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__0139ab50ca.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/csm_SMTP_Smuggling-Sending_e-mails_overview__3__04__803988674e.png" width="1100" height="277" alt="Overview of a simplified e-mailing process via SMTP from left to right "></picture></a><figcaption class="image-caption">
            Figure 3: Overview of a simplified e-mailing process via SMTP from left to right 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>With this much knowledge about the SMTP protocol, we can put the training wheels aside and look at how SMTP is used to transfer e-mails across the Internet. For example, by sending an e-mail from <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" rel="noreferrer noopener" target="_blank" data-mailto-token="nbjmup+vtfsApvumppl/dpn" data-mailto-vector="1">user(at)outlook.com</a> to <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" rel="noreferrer noopener" target="_blank" data-mailto-token="nbjmup+vtfsAsfdfjwfs/fybnqmf" data-mailto-vector="1">user(at)receiver.example</a>!&nbsp;</p><p>When sending an e-mail via <a href="https://outlook.com/" target="_blank" rel="noreferrer">outlook.com</a>, we generally have two options:&nbsp;</p><ol><li>Outlook's web interface&nbsp;</li><li>Using SMTP&nbsp;</li></ol><p>Since this blog post is about SMTP smuggling and doesn't have to do anything with web applications (like <a href="https://portswigger.net/kb/issues/00200800_smtp-header-injection" target="_blank" rel="noreferrer">SMTP header injection</a>), we're opting for number two - SMTP! How this works is described in figure 3.&nbsp;</p></div></div></div></section><section class="section section__text"><div id="c4611" class="frame frame-default frame-type-text frame-layout-0"><p>So, starting from the left side of the overview, the <strong>mail user agent</strong> (<strong>MUA</strong>: Thunderbird, Outlook, Windows Mail, etc.) connects to Outlook's <strong>mail transfer agent</strong> (<strong>MTA</strong>) on the message submission port TCP/587. MTAs that are dedicated to sending <strong>outbound e-mails</strong> are further addressed as <strong>outbound SMTP servers</strong>. The MUA then sends a series of SMTP commands and message data. Since we haven't described the STARTTLS and AUTH LOGIN commands before, here is a short description:&nbsp;</p><ul class="list-normal"><li data-aria-level="1" data-aria-posinset="1" data-font="Symbol" data-leveltext="" data-list-defn-props="{&quot;335552541&quot;:1,&quot;335559684&quot;:-2,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769226&quot;:&quot;Symbol&quot;,&quot;469769242&quot;:[8226],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" data-listid="3"><p><strong>STARTTLS</strong> is used to upgrade to an encrypted TLS session. Since SMTP is generally unencrypted, credentials would otherwise be exposed to listening attackers.&nbsp;</p></li><li data-aria-level="1" data-aria-posinset="2" data-font="Symbol" data-leveltext="" data-list-defn-props="{&quot;335552541&quot;:1,&quot;335559684&quot;:-2,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769226&quot;:&quot;Symbol&quot;,&quot;469769242&quot;:[8226],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" data-listid="3"><p>The AUTH LOGIN SMTP command is used for authenticating the user. In this case, this is done via username and password.&nbsp;</p></li></ul><p>After evaluating if the authenticated user is allowed to send an e-mail for the provided e-mail address in the "mail FROM" and "From" fields, the Outlook SMTP server sends an <strong>inbound e-mail</strong> to the <strong>inbound SMTP server </strong>of <strong>receiver.example</strong> over port TCP/25. This SMTP data looks very similar to the SMTP data submitted to the <strong>outbound SMTP</strong> server, but doesn't include the AUTH LOGIN command and, in this case, doesn't use STARTTLS.&nbsp;</p><p>This concludes the e-mail transfer. But how does the receiving inbound SMTP server make sure that the outbound SMTP server is indeed allowed to send e-mails for outlook.com? Or, why can't just anyone send e-mails for the outlook.com domain?&nbsp;</p><p>&nbsp;</p><h2>SPF, DKIM and DMARC&nbsp;</h2><p>Before an inbound SMTP server accepts an e-mail, it checks the sender's authenticity via e-mail authentication mechanisms such as <a href="https://en.wikipedia.org/wiki/Sender_Policy_Framework" target="_blank" rel="noreferrer">SPF</a>, <a href="https://en.wikipedia.org/wiki/DomainKeys_Identified_Mail" target="_blank" rel="noreferrer">DKIM</a> and <a href="https://en.wikipedia.org/wiki/DMARC" target="_blank" rel="noreferrer">DMARC</a>. This is important, since otherwise attackers could just send e-mails from arbitrary domains. For example, sending an e-mail as <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" data-mailto-token="nbjmup+benjoApvumppl/dpn" data-mailto-vector="1">admin(at)outlook.com</a> from an attacker server would be entirely possible. The most prevalent e-mail authentication mechanism, <strong>SPF</strong>, works by permitting sender IP addresses in special SPF/TXT DNS records. The SPF record of <a href="http://outlook.com/" target="_blank" rel="noreferrer">outlook.com</a> permits the following IP ranges for e-mail transfer:&nbsp;</p><p><span class="inline-code">v=spf1 include:spf-a.outlook.com include:spf-b.outlook.com ip4:157.55.9.128/25 include:spf.protection.outlook.com include:spf-a.hotmail.com include:_spf-ssg-b.microsoft.com include:_spf-ssg-c.microsoft.com ~all&nbsp;</span></p><p>&nbsp;</p></div></section><section class="section section__textpic"><div id="c4618" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/7/c/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05__ec96aa0bd7.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/7/c/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05__96d8d1cc61.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/7/c/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05__b59e74dae6.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/7/c/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05__c5ff3c2e9f.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/7/c/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05__6aac7a94b3.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_spoofing__05_.png" width="635" height="226" alt="Passing SPF checks with attacker.example domain, while sending as user@sender.example "></picture></a><figcaption class="image-caption">
            Figure 4: Passing SPF checks with attacker.example domain, while sending as user@sender.example 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>If you are not sending from one of these IP ranges, the SPF check would fail and your e-mail most likely won't be forwarded or will be marked as spam. But which domain is actually getting checked? The problem with SPF by itself is that only the MAIL FROM domain from the mail envelope is checked. The From header in the message data, which is further displayed in the received e-mail, can have an arbitrary value, as shown in figure 4 (blue text).&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4619" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/2/b/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06__97a5b12ac0.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/2/b/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06__a63a95f529.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/2/b/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06__74f3750fd4.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/2/b/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06__775bb8540b.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/2/b/csm_SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06__39f00013aa.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_only_sender_SPF_and_DKIM_spoofing__06_.png" width="695" height="304" alt="Passing SPF and DKIM checks, by sending from an attacker server with an attacker-controlled DKIM key "></picture></a><figcaption class="image-caption">
            Figure 5: Passing SPF and DKIM checks, by sending from an attacker server with an attacker-controlled DKIM key 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>The same goes for <strong>DKIM</strong> (DomainKeys Identified Mail) as well. DKIM allows signing the message data, including the From header. This signature can then be verified by the receiver with a public key that resides in the DNS. However, it is not enforced, which domain holds the public key (see figure 5).&nbsp;</p></div></div></div></section><section class="section section__text"><div id="c4620" class="frame frame-default frame-type-text frame-layout-0"><p>In this case, the message from "user@sender.example" may be signed, but the verification key is located at "dkim._domainkey.attacker.example". This location is derived from concatenating the selector (s=) "dkim", the static value "_domainkey" and the domain (d=) "attacker.example". So, even though an e-mail may have a valid SPF record and a valid DKIM signature, there is no mechanism for telling if the e-mail comes from a malicious sender or not.&nbsp;</p><p>Fortunately, there is <strong>DMARC</strong>, which stands for "Domain-based Message Authentication, Reporting and Conformance". DMARC introduces so-called "identifier alignment" for SPF and DKIM and allows senders to specify alignment policies for both methods. It verifies if the email's "From" domain aligns with SPF checks and/or DKIM signatures. Thus, the DMARC check fails if there is a mismatch between the MAIL FROM and the From domain where otherwise the SPF check would pass. An example for a DMARC policy, which is always located in a TXT record at _dmarc.[domain], can be seen here:&nbsp;</p><p><span class="inline-code">v=DMARC1; p=reject; sp=none; fo=0; adkim=r; aspf=r; pct=100; rf=afrf&nbsp;</span></p></div></section><section class="section section__text"><div id="c4621" class="frame frame-default frame-type-text frame-layout-0"><p>The policy (p=) tells the receiving server to reject 100 percent (pct=) of the messages that fail the DMARC check. Therefore, the message will get accepted (only) if a valid SPF record and/or DKIM signature is provided.&nbsp;</p><p>However, what happens if there is no DMARC record? In general, e-mail authenticity handling heavily depends on the inbound SMTP server's configuration and software. As a rule of thumb, if there is SPF or DKIM alignment, there is a good chance of the e-mail being accepted!&nbsp;</p><p>Now, with the groundwork done, let's get into <strong>SMTP smuggling</strong>!&nbsp;</p><p>&nbsp;</p></div></section><section class="section section__textpic"><div id="c4622" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="https://portswigger.net/web-security/request-smuggling" title="Figure 6: Simple example of HTTP request smuggling by PortSwigger" target="_blank" rel="noreferrer"><picture><source srcset="/fileadmin/_processed_/7/e/csm_SMTP_Smuggling-HTTP_request_smuggling__07__45abc75acb.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-HTTP_request_smuggling__07_.png" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/7/e/csm_SMTP_Smuggling-HTTP_request_smuggling__07__3646ab2194.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/7/e/csm_SMTP_Smuggling-HTTP_request_smuggling__07__005072109a.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-HTTP_request_smuggling__07_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-HTTP_request_smuggling__07_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/7/e/csm_SMTP_Smuggling-HTTP_request_smuggling__07__ed882e4c46.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/7/e/csm_SMTP_Smuggling-HTTP_request_smuggling__07__a893caf5ae.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-HTTP_request_smuggling__07_.png" width="791" height="365" alt="Simple example of HTTP request smuggling by PortSwigger " title="Figure 6: Simple example of HTTP request smuggling by PortSwigger "></picture></a><figcaption class="image-caption">
            Figure 6: Simple example of HTTP request smuggling by PortSwigger 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><h2>SMTP Smuggling?&nbsp;</h2><p>The initial goal of this research was to test the SMTP protocol against some common and exotic attacks that work on other protocols, such as HTTP. Thanks to the contribution of many brilliant minds, there is a variety of <strong>HTTP</strong> attacks to choose from. However, in the context of SMTP, one of them just fit the bill. <strong>HTTP request smuggling</strong>!</p><p>If you want an in-depth explanation of HTTP request smuggling and all its facets, James Kettle (aka <a href="https://twitter.com/albinowax" target="_blank" rel="noreferrer">@albinowax</a>) did a <a href="https://jameskettle.com/" target="_blank" rel="noreferrer">wonderful job</a> on that. However, for now, we only need to understand the essentials!&nbsp;</p><p>With HTTP request smuggling, we're basically trying to exploit different interpretations of the same thing. For example, with discrepancies in the interpretation and processing of the "Content-Length" and "Transfer-Encoding" HTTP headers, an arbitrary HTTP request can be smuggled to an otherwise unreachable back-end server like in figure 6.&nbsp;</p><p>&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4623" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_only_sender__08_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/0/0/csm_SMTP_Smuggling-SMTP_session_example_only_sender__08__aa75bc41e9.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/0/0/csm_SMTP_Smuggling-SMTP_session_example_only_sender__08__90824f483b.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/0/0/csm_SMTP_Smuggling-SMTP_session_example_only_sender__08__d6e8dad7b7.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/0/0/csm_SMTP_Smuggling-SMTP_session_example_only_sender__08__a0e30bb83d.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender__08_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender__08_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_example_only_sender__08_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/0/0/csm_SMTP_Smuggling-SMTP_session_example_only_sender__08__7f2d441f55.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_example_only_sender__08_.png" width="614" height="227" alt="SMTP session with SMTP commands and message data separated by colour. "></picture></a><figcaption class="image-caption">
            Figure 7: SMTP session with SMTP commands and message data separated by colour. 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>In this example, the vulnerable front-end server only sees one HTTP POST request, while the back-end server sees a POST request <strong>and</strong> a GET request to /<strong>admin</strong>!&nbsp;</p><p>With SMTP, we also have a setup with two servers, being <strong>outbound and inbound SMTP servers</strong>. So, let's take a look at an SMTP session again in figure 7.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4624" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-Overview__09_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/c/2/csm_SMTP_Smuggling-Overview__09__7cf90ddc8f.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/c/2/csm_SMTP_Smuggling-Overview__09__a4a36eab59.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/c/2/csm_SMTP_Smuggling-Overview__09__b59fdfa487.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/c/2/csm_SMTP_Smuggling-Overview__09__3b2c54ee71.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/c/2/csm_SMTP_Smuggling-Overview__09__5da9f93d00.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-Overview__09_.png" width="692" height="406" alt="SMTP smuggling in theory "></picture></a><figcaption class="image-caption">
            Figure 8: SMTP smuggling in theory 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Now tell me, <strong>what happens if outbound and inbound SMTP servers interpret the end-of-data sequence (&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;) differently?&nbsp;</strong></p><p>Exactly, S<strong>MTP smuggling!&nbsp;</strong></p><p>If SMTP servers have a different understanding of where the message data ends, an attacker can potentially break out of the message data. Even worse, this may allow to specify arbitrary SMTP commands and even to send separate e-mails (see figure 8)!&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4625" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_analysis_test_setup__3__10_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/e/3/csm_SMTP_Smuggling-SMTP_analysis_test_setup__3__10__52bd789a80.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/e/3/csm_SMTP_Smuggling-SMTP_analysis_test_setup__3__10__d24dd857ea.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/e/3/csm_SMTP_Smuggling-SMTP_analysis_test_setup__3__10__36b99058e5.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/e/3/csm_SMTP_Smuggling-SMTP_analysis_test_setup__3__10__2a7f4cd495.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_analysis_test_setup__3__10_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/e/3/csm_SMTP_Smuggling-SMTP_analysis_test_setup__3__10__7596151d37.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/e/3/csm_SMTP_Smuggling-SMTP_analysis_test_setup__3__10__5a335726d1.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/e/3/csm_SMTP_Smuggling-SMTP_analysis_test_setup__3__10__7e89a7b4f7.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_analysis_test_setup__3__10_.png" width="988" height="297" alt="SMTP analysis setup for analyzing outbound SMTP servers "></picture></a><figcaption class="image-caption">
            Figure 9: SMTP analysis setup for analyzing outbound SMTP servers 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>So, that's the basic idea of SMTP smuggling! But does it actually work?&nbsp;</p><h2>&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt; is a lie?&nbsp;</h2><p>To get a good understanding of how different kinds of SMTP software work, we can start our analysis as shown in figure 9:&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4626" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_CRLF_smuggling___11_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/a/f/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling___11__83b9404dc3.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/a/f/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling___11__57bddcc292.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/a/f/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling___11__ad8ad0761b.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/a/f/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling___11__b5e7bd22b8.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_CRLF_smuggling___11_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_CRLF_smuggling___11_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_CRLF_smuggling___11_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/a/f/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling___11__800f41a4c0.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_CRLF_smuggling___11_.png" width="568" height="189" alt="Using \n.\n as end-of-data sequence #1 "></picture></a><figcaption class="image-caption">
            Figure 10: Using \n.\n as end-of-data sequence #1 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>First, we register e-mail accounts at various public e-mail providers that support mail submissions via SMTP (unlike Tutanota and ProtonMail). We used the following providers for this research project:&nbsp;</p><ul class="list-normal"><li>outlook.com&nbsp;</li><li>gmail.com&nbsp;</li><li>gmx.net&nbsp;</li><li>icloud.com&nbsp;</li><li>zoho.com&nbsp;</li><li>fastmail.com&nbsp;</li><li>runbox.com&nbsp;</li><li>startmail.com&nbsp;</li><li>mailbox.org&nbsp;</li><li>aol.com&nbsp;</li><li>yahoo.com&nbsp;</li><li>web.de&nbsp;</li></ul><p>Then, by sending e-mails through the <strong>outbound</strong> SMTP servers of these providers and receiving them on an <strong>inbound SMTP analysis server</strong>, we can see first differences in the implementation of the SMTP protocol in these SMTP servers.&nbsp;</p><p>When looking at the <strong>SMTP analysis client</strong> it becomes apparent straight away that some SMTP products do things "differently" than others. For example, here are some responses received from e-mail providers after sending the <strong>DATA</strong> SMTP command:</p><p><span class="inline-code">- 250 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;&nbsp;<br> - 250 Start mail input; end with &lt;CRLF&gt;.&lt;CRLF&gt;&nbsp;<br> - 250 Send data ending with &lt;CRLF&gt;.&lt;CRLF&gt;&nbsp;</span></p><p>This doesn't look good for our plans to smuggle SMTP commands, since we're looking for different interpretations of SMTP, and not the same text written differently. Right? But, we're not going to back off just because of some text, are we?&nbsp;</p><p>After further analysis, some SMTP servers returned the following responses, which looked a bit more promising:&nbsp;</p><p><span class="inline-code">- Enter message, ending with "." on a line by itself&nbsp;<br> - Enter mail, end with "." on a line by itself&nbsp;</span></p><p>Why would that be more promising, though? Well, different operating systems have a different understanding of "<strong>a line by itself</strong>". A "." on a line by itself on Windows would be separated via two carriage return line feeds (<strong>&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</strong> or <strong>\r\n.\r\n</strong>), while a "." on a line by itself on Linux would be separated with two line feeds (&lt;LF&gt;.&lt;LF&gt; or \n.\n).&nbsp;</p><p>So, why don't we try to end the message data of an e-mail with <strong>&lt;LF&gt;.&lt;LF&gt;?</strong> This would therefore look like in figure 10.</p></div></div></div></section><section class="section section__textpic"><div id="c4627" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_CRLF_smuggling__12_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/d/b/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling__12__0a60d3527e.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/d/b/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling__12__8b70b15aec.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/d/b/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling__12__9393154e58.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/d/b/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling__12__9dc2b3fe87.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_CRLF_smuggling__12_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_CRLF_smuggling__12_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_CRLF_smuggling__12_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/d/b/csm_SMTP_Smuggling-SMTP_session_CRLF_smuggling__12__b8eddcb05c.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_CRLF_smuggling__12_.png" width="637" height="275" alt="Using \n.\n as end-of-data sequence #2 "></picture></a><figcaption class="image-caption">
            Figure 11: Using \n.\n as end-of-data sequence #2 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Now, if an SMTP server doesn't consider &lt;LF&gt;.&lt;LF&gt; as the end-of-data sequence, the connection will be left hanging, since it's waiting for the actual &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;. Therefore, as shown in figure 11, we add the following.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4628" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-12-4_19-57-58__13_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_19-57-58__13__1d4f359dcf.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_19-57-58__13__c6c9377b0d.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_19-57-58__13__ff41766cd0.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_19-57-58__13__2a337da643.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-12-4_19-57-58__13_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-12-4_19-57-58__13_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_19-57-58__13__a699179de2.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_19-57-58__13__2022cc0ab0.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-12-4_19-57-58__13_.png" width="790" height="308" alt="Outbound e-mail provider delivering an e-mail with &lt;LF&gt;.&lt;LF&gt; sequence (not vulnerable) "></picture></a><figcaption class="image-caption">
            Figure 12: Outbound e-mail provider delivering an e-mail with &lt;LF&gt;.&lt;LF&gt; sequence (not vulnerable) 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>With this, whenever &lt;LF&gt;.&lt;LF&gt; is supported as end-of-data sequence by the inbound SMTP server, only "lorem ipsum" will be part of the message data, otherwise the message also includes "This server is ignoring line feeds as end-of-data sequence!".&nbsp;</p><p>But, what can we actually achieve with this? Well, let's see how a message transfer could look like if &lt;LF&gt;.&lt;LF&gt; doesn't end the data section, like in figure 12.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4629" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-CRLF_Smuggling_2__3__14_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/9/d/csm_SMTP_Smuggling-CRLF_Smuggling_2__3__14__8193354391.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/9/d/csm_SMTP_Smuggling-CRLF_Smuggling_2__3__14__949bf732d8.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/9/d/csm_SMTP_Smuggling-CRLF_Smuggling_2__3__14__7a9e42c5a3.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/9/d/csm_SMTP_Smuggling-CRLF_Smuggling_2__3__14__ed14fce3ac.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-CRLF_Smuggling_2__3__14_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-CRLF_Smuggling_2__3__14_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/9/d/csm_SMTP_Smuggling-CRLF_Smuggling_2__3__14__3ed32ae59e.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/9/d/csm_SMTP_Smuggling-CRLF_Smuggling_2__3__14__4c61dd5151.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-CRLF_Smuggling_2__3__14_.png" width="790" height="308" alt="Outbound e-mail provider delivering an e-mail with &lt;LF&gt;.&lt;LF&gt; sequence (vulnerable) "></picture></a><figcaption class="image-caption">
            Figure 13: Outbound e-mail provider delivering an e-mail with &lt;LF&gt;.&lt;LF&gt; sequence (vulnerable) 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Depending on the receiving inbound SMTP server this may be completely harmless. However, what if the inbound SMTP server interprets &lt;LF&gt;.&lt;LF&gt; as end-of-data sequence? (see figure 13)&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4630" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-GMX_Smuggling__3__15_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/3/8/csm_SMTP_Smuggling-GMX_Smuggling__3__15__c8af0b844d.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/3/8/csm_SMTP_Smuggling-GMX_Smuggling__3__15__578316ca29.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/3/8/csm_SMTP_Smuggling-GMX_Smuggling__3__15__a3c13b193e.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/3/8/csm_SMTP_Smuggling-GMX_Smuggling__3__15__aa23d0f236.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-GMX_Smuggling__3__15_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-GMX_Smuggling__3__15_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/3/8/csm_SMTP_Smuggling-GMX_Smuggling__3__15__04c7c0267c.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/3/8/csm_SMTP_Smuggling-GMX_Smuggling__3__15__ca70ecb209.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-GMX_Smuggling__3__15_.png" width="791" height="313" alt="Potential end-of-data sequence between START and END going through GMX&#39;s outbound SMTP server unchanged "></picture></a><figcaption class="image-caption">
            Figure 14: Potential end-of-data sequence between START and END going through GMX's outbound SMTP server unchanged 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>In this case, the "harmless" &lt;LF&gt;.&lt;LF&gt; breaks out of the message data and "This server is ignoring line feeds as end-of-data sequence!" may now be interpreted as an <strong>SMTP command</strong>! Note that this requires the inbound server to accept multiple SMTP commands in a batch, or so-called SMTP pipelining. Luckily for us, most servers support this nowadays.&nbsp;</p><p>However, <strong>outbound SMTP servers</strong> commonly handle such "troublesome" &lt;LF&gt;.&lt;LF&gt; sequences via different means:&nbsp;</p><ul class="list-normal"><li>Dot-stuffing (Escaping the single dot with another dot):  &lt;LF&gt;..&lt;LF&gt;&nbsp;</li><li>Replacing it with a &lt;CR&gt;&lt;LF&gt;&nbsp;</li><li>Encoding it (e.g., via quoted-printable): =0A.=0A&nbsp;</li><li>Removing the entire sequence&nbsp;</li><li>Not sending the message&nbsp;</li></ul><p>But sometimes, <strong>they do nothing at all</strong>!&nbsp;</p><p>So, essentially, we're looking for specific characteristics in outbound and inbound SMTP servers in terms of end-of-data sequence handling. More precisely, we're searching for what outbound SMTP servers ignore (e.g., &lt;LF&gt;.&lt;LF&gt;) and what inbound SMTP servers interpret (e.g., &lt;LF&gt;.&lt;LF&gt; as end-of-data). If we can find a correct combination, we can smuggle!&nbsp;</p><p>&nbsp;</p><h2>First Blood&nbsp;</h2><p>As previously mentioned, we've created e-mail accounts at various e-mail providers. Shortly after sending potential end-of-data sequences (e.g., &lt;LF&gt;.&lt;LF&gt;) from outbound provider SMTP servers to the SMTP analysis server, a <strong>promising candidate emerged</strong>!&nbsp;</p><p><strong>GMX</strong>, established in 1997, is one of the old-school e-mail providers in the DACH region with roughly 20 million users. When sending an <strong>&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</strong> sequence to the outbound GMX SMTP server, it is passed unfiltered to the inbound SMTP server, as shown in figure 14!&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4631" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_smuggling_GMX__16_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/9/e/csm_SMTP_Smuggling-SMTP_smuggling_GMX__16__754993e69e.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/9/e/csm_SMTP_Smuggling-SMTP_smuggling_GMX__16__4676df4187.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/9/e/csm_SMTP_Smuggling-SMTP_smuggling_GMX__16__950bb2423f.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/9/e/csm_SMTP_Smuggling-SMTP_smuggling_GMX__16__2ba970aede.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_smuggling_GMX__16_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_smuggling_GMX__16_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/9/e/csm_SMTP_Smuggling-SMTP_smuggling_GMX__16__83e98e7fc9.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/9/e/csm_SMTP_Smuggling-SMTP_smuggling_GMX__16__4a9fc4084b.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_smuggling_GMX__16_.png" width="955" height="412" alt="SMTP smuggling from admin@gmx.net to user@provider.example "></picture></a><figcaption class="image-caption">
            Figure 15: SMTP smuggling from admin@gmx.net to user@provider.example 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Therefore, we can now break out of the message data at the inbound SMTP server, if &lt;LF&gt;.&lt;CR&gt;&lt;LF&gt; is interpreted as an end-of-data sequence. So, how do we find such servers?&nbsp;</p><p>We simply send an e-mail with the following message data (see figure 15) to all the e-mail addresses we've registered.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4632" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/GMX_to_GMAIL_smuggling_failed__17_.PNG" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/3/7/csm_GMX_to_GMAIL_smuggling_failed__17__11b8e36e25.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/3/7/csm_GMX_to_GMAIL_smuggling_failed__17__4f7f1770d1.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/3/7/csm_GMX_to_GMAIL_smuggling_failed__17__ef6e262ef3.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/3/7/csm_GMX_to_GMAIL_smuggling_failed__17__7e479b9298.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/GMX_to_GMAIL_smuggling_failed__17_.PNG" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/GMX_to_GMAIL_smuggling_failed__17_.PNG" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/GMX_to_GMAIL_smuggling_failed__17_.PNG" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/GMX_to_GMAIL_smuggling_failed__17_.PNG" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/GMX_to_GMAIL_smuggling_failed__17_.PNG" width="326" height="413" alt="Failed attempt of SMTP smuggling against Gmail "></picture></a><figcaption class="image-caption">
            Figure 16: Failed attempt of SMTP smuggling against Gmail 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>For a lot of them, we receive a very suspicious looking e-mail like in figure 16, since &lt;LF&gt;.&lt;CR&gt;&lt;LF&gt; did not end the message data.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4633" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/GMX_to_FASTMAIL_smuggling_success__18_.PNG" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/b/7/csm_GMX_to_FASTMAIL_smuggling_success__18__1ee24f1b21.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/b/7/csm_GMX_to_FASTMAIL_smuggling_success__18__4ad6e5f92d.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/b/7/csm_GMX_to_FASTMAIL_smuggling_success__18__324004cc62.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/b/7/csm_GMX_to_FASTMAIL_smuggling_success__18__9d5d8867d8.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/GMX_to_FASTMAIL_smuggling_success__18_.PNG" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/GMX_to_FASTMAIL_smuggling_success__18_.PNG" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/GMX_to_FASTMAIL_smuggling_success__18_.PNG" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/GMX_to_FASTMAIL_smuggling_success__18_.PNG" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/GMX_to_FASTMAIL_smuggling_success__18_.PNG" width="360" height="98" alt="Successful SMTP smuggling from GMX to Fastmail. &quot;Look at me! I am the admin now!&quot; "></picture></a><figcaption class="image-caption">
            Figure 17: Successful SMTP smuggling from GMX to Fastmail. "Look at me! I am the admin now!" 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>But for some of them, we hit the jackpot!&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4634" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_smuggling_WEB.DE_19_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/8/3/csm_SMTP_Smuggling-SMTP_smuggling_WEB.DE_19__735952133a.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/8/3/csm_SMTP_Smuggling-SMTP_smuggling_WEB.DE_19__56efd7d218.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/8/3/csm_SMTP_Smuggling-SMTP_smuggling_WEB.DE_19__e60efcd5b4.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/8/3/csm_SMTP_Smuggling-SMTP_smuggling_WEB.DE_19__d40a46b354.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_smuggling_WEB.DE_19_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/8/3/csm_SMTP_Smuggling-SMTP_smuggling_WEB.DE_19__64bf082a74.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/8/3/csm_SMTP_Smuggling-SMTP_smuggling_WEB.DE_19__5ea07f4d4a.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/8/3/csm_SMTP_Smuggling-SMTP_smuggling_WEB.DE_19__0ff2386396.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_smuggling_WEB.DE_19_.png" width="977" height="413" alt="Cross-domain SMTP smuggling to different recipients "></picture></a><figcaption class="image-caption">
            Figure 18: Cross-domain SMTP smuggling to different recipients 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>This proof of concept (figure 17) was the first sign that SMTP smuggling actually works!&nbsp;</p><p>By inspecting the message headers, we can see that the SPF check passes with domain alignment for gmx.net! This is because the smuggled message actually came from the legitimate GMX SMTP server.&nbsp;</p><p><span class="inline-code">Received-SPF: pass&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; (gmx.net: 212.227.15.15 is authorized to use 'admin@gmx.net' in 'mfrom' identity (mechanism 'ip4:212.227.15.0/25' matched))&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; receiver=mx4.messagingengine.com;&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; identity=mailfrom;&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; envelope-from="admin@gmx.net";&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; helo=mout.gmx.net;&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; client-ip=212.227.15.15&nbsp;</span></p><p>Since we've achieved domain alignment for gmx.net, this e-mail will most likely pass spam filters, even with strict DMARC policies!&nbsp;<strong>But wait</strong>, if other domains also use the outbound SMTP server of GMX to send e-mails, can't we spoof them as well?&nbsp;Let's see! By analyzing the SPF record of <strong>web.de</strong>, we can see that the outbound SMTP IP address of GMX <strong>212.227.15.15</strong> is included as well!&nbsp;</p><p><span class="inline-code">v=spf1 ip4:212.227.126.128/25 ip4:212.227.15.0/25 ip4:212.227.17.0/27 ip4:217.72.192.248/29 ip4:82.165.159.0/26 ip4:217.72.207.0/27 ip4:217.72.192.64/26 ip4:82.165.229.130 ip4:82.165.230.22 ~all&nbsp;</span></p><p>Now, we can change the SMTP smuggling message data accordingly, like in figure 18.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4635" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/WEB.DE_to_FASTMAIL_smuggling_success__20_.PNG" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/b/3/csm_WEB.DE_to_FASTMAIL_smuggling_success__20__1f950746e6.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/b/3/csm_WEB.DE_to_FASTMAIL_smuggling_success__20__e23952cb00.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/b/3/csm_WEB.DE_to_FASTMAIL_smuggling_success__20__2e2e45736b.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/b/3/csm_WEB.DE_to_FASTMAIL_smuggling_success__20__2458ea6713.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/WEB.DE_to_FASTMAIL_smuggling_success__20_.PNG" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/WEB.DE_to_FASTMAIL_smuggling_success__20_.PNG" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/WEB.DE_to_FASTMAIL_smuggling_success__20_.PNG" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/WEB.DE_to_FASTMAIL_smuggling_success__20_.PNG" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/WEB.DE_to_FASTMAIL_smuggling_success__20_.PNG" width="360" height="48" alt="Successful cross-domain SMTP smuggling from GMX to Fastmail using web.de as sender domain "></picture></a><figcaption class="image-caption">
            Figure 19: Successful cross-domain SMTP smuggling from GMX to Fastmail using web.de as sender domain 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>To simulate a real-life scenario, we specify a different receiver e-mail address for the first message and only send the smuggled message (figure 19) to the target.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4636" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-12-4_21-4-41__21_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_21-4-41__21__e62c99302e.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_21-4-41__21__d5eb6497cc.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_21-4-41__21__026ca6562b.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/f/f/csm_image-2023-12-4_21-4-41__21__87003211dc.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-12-4_21-4-41__21_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-12-4_21-4-41__21_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-12-4_21-4-41__21_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-12-4_21-4-41__21_.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-12-4_21-4-41__21_.png" width="227" height="85" alt="Censored (real) profile picture associated with admin@web.de "></picture></a><figcaption class="image-caption">
            Figure 20: Censored (real) profile picture associated with admin@web.de 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>In this case, our target would even see the associated profile picture (in this case of the real 'admin@web.de' user), like in figure 20!&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4637" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-BDAT__22_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/0/8/csm_SMTP_Smuggling-BDAT__22__f1e36425d9.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/0/8/csm_SMTP_Smuggling-BDAT__22__5cea96872a.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/0/8/csm_SMTP_Smuggling-BDAT__22__15bf65615e.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/0/8/csm_SMTP_Smuggling-BDAT__22__aafef80b82.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-BDAT__22_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-BDAT__22_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-BDAT__22_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/0/8/csm_SMTP_Smuggling-BDAT__22__88aae0e9d3.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-BDAT__22_.png" width="620" height="208" alt="Sending message data via BDAT"></picture></a><figcaption class="image-caption">
            Figure 21: Sending message data via BDAT
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>And again, the SPF verification checks out!&nbsp;</p><p><span class="inline-code">Received-SPF: pass&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; (web.de: 212.227.17.22 is authorized to use 'admin@web.de' in 'mfrom' identity (mechanism 'ip4:212.227.17.0/27' matched))&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; receiver=mx4.messagingengine.com;&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; identity=mailfrom;&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; envelope-from="admin@web.de";&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; helo=mout.gmx.net;&nbsp;</span></p><p><span class="inline-code">&nbsp;&nbsp;&nbsp; client-ip=212.227.17.22&nbsp;</span></p><p>Now, you might think that this was already cool, <strong>but we're just getting started</strong>!&nbsp;</p><p>Even though we initially only analyzed GMX, the problem is far worse than it seemed at first. Like many big e-mail providers, GMX is using a custom SMTP server called <strong>Nemesis</strong><strong>SMTPd</strong>. Since GMX is part of <strong>Ionos</strong>, e-mailing services provided by Ionos are also using Nemesis SMTPd. By putting 1 and 1 together, we register an e-mail domain at Ionos and check if SMTP smuggling works. And it does! However, smuggling via a custom e-mail domain doesn't even seem to be necessary. The SPF record for the registered e-mail domain includes "_spf-eu.ionos.com" and the SPF record for gmx.net includes "_spf.gmx.net". Looking at the permitted IP ranges reveals "some" collisions:&nbsp;</p><p><span class="inline-code">$ dig _spf-eu.ionos.com TXT&nbsp;<br> "v=spf1 ip4:212.227.126.128/25 ip4:212.227.15.0/25 ip4:212.227.17.0/27 ip4:82.165.159.0/26 ip4:217.72.192.64/26 ?all"&nbsp;<br> &nbsp;<br> $ dig _spf.gmx.net TXT&nbsp;<br> "v=spf1 ip4:212.227.126.128/25 ip4:212.227.15.0/25 ip4:212.227.17.0/27 ip4:82.165.159.0/24 ip4:74.208.4.192/26  ip4:217.72.207.0/27 ip4:82.165.229.31 ip4:82.165.230.21 ip4:213.165.64.0/23 ip4:74.208.5.64/26 ~all"&nbsp;</span></p><p>So, either way, this allowed <strong>spoofing</strong> not only <strong>gmx.net</strong> and <strong>web.de</strong>, but also around a <strong>million</strong> other domains hosted at <strong>Ionos</strong>! But more on the details later! &nbsp;</p><p>&nbsp;</p><h2>Smuggling via Microsoft Exchange Online&nbsp;</h2><p>After a deeper analysis of outbound SMTP servers, a peculiarity in <strong>Microsoft Outlook's</strong> (<a href="https://outlook.com/" target="_blank" rel="noreferrer">outlook.com</a>) SMTP server was observed. When trying to send an <strong>&lt;LF&gt;.&lt;LF&gt;</strong> sequence, the message does not get transmitted, and the following error message is returned:&nbsp;</p><p>Remote server returned '550 5.6.11 SMTPSEND.BareLinefeedsAreIllegal; message contains bare linefeeds, which cannot be sent via DATA and receiving system does not support BDAT'&nbsp;</p><p>However, same as with GMX, <strong>Outlook doesn't filter &lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</strong> sequences.&nbsp;</p><p>Still, it wasn't possible to smuggle to the same receivers (e.g., Fastmail) as with GMX. Reason for this is Outlook's usage of the optional <strong>BDAT</strong> SMTP command. BDAT is an alternative to the <strong>DATA</strong> command to transfer the message data. It works by specifying the message length with the BDAT command, instead of relying on an end-of-data sequence. For example, to transfer 72 bytes of message data, we can do it like in figure 21.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4638" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_smuggling_Outlook__23_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/f/2/csm_SMTP_Smuggling-SMTP_smuggling_Outlook__23__4553225740.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/f/2/csm_SMTP_Smuggling-SMTP_smuggling_Outlook__23__a8696421b0.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/f/2/csm_SMTP_Smuggling-SMTP_smuggling_Outlook__23__97e89cd3b8.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/f/2/csm_SMTP_Smuggling-SMTP_smuggling_Outlook__23__d251670509.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_smuggling_Outlook__23_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_smuggling_Outlook__23_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/f/2/csm_SMTP_Smuggling-SMTP_smuggling_Outlook__23__cbc7f1b022.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/f/2/csm_SMTP_Smuggling-SMTP_smuggling_Outlook__23__7946d5ab12.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_smuggling_Outlook__23_.png" width="967" height="570" alt="Sending a phishing e-mail from admin@outlook.com via SMTP smuggling"></picture></a><figcaption class="image-caption">
            Figure 22: Sending a phishing e-mail from admin@outlook.com via SMTP smuggling
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Even though that stops us from smuggling to some inbound SMTP servers, the BDAT command can only be used by Outlook, if the inbound SMTP server supports it. If the inbound SMTP server doesn't indicate BDAT support by returning the <strong>CHUNKING</strong> capability, DATA is used as fallback.&nbsp;</p><p>Therefore, we're looking for an inbound SMTP server that interprets &lt;LF&gt;.&lt;CR&gt;&lt;LF&gt; as an end-of-data sequence and doesn't support BDAT.&nbsp;&nbsp;</p><p>Funnily enough, the <a href="https://sec-consult.com/" target="_blank" rel="noreferrer noopener">sec-consult.com</a> SMTP server supports just that! Note that <strong>LOTS</strong> of servers on the Internet support this, but since we've got to make sure that our own systems are secure anyways, we'll be using sec-consult.com. So, what's the first thing to do with our newly gained power? <strong>Sending spoofed e-mails to co-workers to make sure it actually works!</strong> (see figure 22)&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4639" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/teams_conversation_OIDA__24_.PNG" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/2/3/csm_teams_conversation_OIDA__24__208fa81240.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/2/3/csm_teams_conversation_OIDA__24__d450b64b09.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/2/3/csm_teams_conversation_OIDA__24__622ff2619f.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/2/3/csm_teams_conversation_OIDA__24__6224b9c879.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/teams_conversation_OIDA__24_.PNG" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/teams_conversation_OIDA__24_.PNG" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/teams_conversation_OIDA__24_.PNG" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/2/3/csm_teams_conversation_OIDA__24__cf55f47787.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/teams_conversation_OIDA__24_.PNG" width="572" height="114" alt="Typical Austrian reaction after receiving a spoofed e-mail "></picture></a><figcaption class="image-caption">
            Figure 23: Typical Austrian reaction after receiving a spoofed e-mail 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Based on their reaction (figure 23), the message from <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" rel="noreferrer noopener" target="_blank" data-mailto-token="nbjmup+benjoApvumppl/dpn" data-mailto-vector="1">admin(at)outlook.com</a> definitely got delivered and didn't end up in spam.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4640" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-7-5_15-26-20__24_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/b/7/csm_image-2023-7-5_15-26-20__24__69b3f18758.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/b/7/csm_image-2023-7-5_15-26-20__24__70e458da47.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/b/7/csm_image-2023-7-5_15-26-20__24__a87151eb87.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/b/7/csm_image-2023-7-5_15-26-20__24__49e343c3ec.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_15-26-20__24_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_15-26-20__24_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_15-26-20__24_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_15-26-20__24_.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-7-5_15-26-20__24_.png" width="334" height="253" alt="Receiving a spoofed e-mail from admin@outlook.com aka Timo Lo(n)gin "></picture></a><figcaption class="image-caption">
            Figure 24: Receiving a spoofed e-mail from admin@outlook.com aka Timo Lo(n)gin 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>The actual e-mail is shown in figure 24:&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4641" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-7-10_22-55-21__25_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/a/f/csm_image-2023-7-10_22-55-21__25__9889800189.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/a/f/csm_image-2023-7-10_22-55-21__25__61e74599fe.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/a/f/csm_image-2023-7-10_22-55-21__25__d26e364b54.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/a/f/csm_image-2023-7-10_22-55-21__25__5efeee647e.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-10_22-55-21__25_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-10_22-55-21__25_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-10_22-55-21__25_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/a/f/csm_image-2023-7-10_22-55-21__25__efd81990ca.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-7-10_22-55-21__25_.png" width="679" height="664" alt="Using HTML with SMTP smuggling to create a convincing phishing e-mail "></picture></a><figcaption class="image-caption">
            Figure 25: Using HTML with SMTP smuggling to create a convincing phishing e-mail 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>We can once more confirm SPF alignment by looking at the message headers:&nbsp;</p><p><span class="inline-code">Received-SPF: Pass (<a href="http://mx3.atos.net/" target="_blank" rel="noreferrer noopener">mx3.atos.net</a>: domain of <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" rel="noreferrer noopener" target="_blank" data-mailto-token="nbjmup+benjoApvumppl/dpn" data-mailto-vector="1">admin(at)outlook.com</a> designates 40.92.75.68 as permitted sender)&nbsp;<br>   identity=mailfrom; client-ip=40.92.75.68;&nbsp;<br>   receiver=<a href="http://mx3.atos.net/" target="_blank" rel="noreferrer noopener">mx3.atos.net</a>; envelope-from="admin@<a href="http://outlook.com/" target="_blank" rel="noreferrer noopener">outlook.com</a>";&nbsp;<br>   x-sender="admin@<a href="http://outlook.com/" target="_blank" rel="noreferrer noopener">outlook.com</a>"; x-conformance=spf_only;&nbsp;<br>   x-record-type="v=spf1"; x-record-text="v=spf1&nbsp;<br>   ip4:40.92.0.0/15 ip4:40.107.0.0/16 ip4:52.100.0.0/14&nbsp;<br>   ip4:104.47.0.0/17 ip6:2a01:111:f400::/48&nbsp;<br>   ip6:2a01:111:f403::/49 ip6:2a01:111:f403:8000::/50&nbsp;<br>   ip6:2a01:111:f403:c000::/51 ip6:2a01:111:f403:f000::/52 -all"&nbsp;</span></p><p>Since the previous examples were only text-based, attackers could also use HTML, for some more convincing phishing e-mails (figure 25).&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4642" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-7-5_15-53-16__26_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/f/6/csm_image-2023-7-5_15-53-16__26__9964f1b73a.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/f/6/csm_image-2023-7-5_15-53-16__26__7bf2ff6acd.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/f/6/csm_image-2023-7-5_15-53-16__26__b856cb3491.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/f/6/csm_image-2023-7-5_15-53-16__26__ab4802cbff.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_15-53-16__26_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_15-53-16__26_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_15-53-16__26_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_15-53-16__26_.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-7-5_15-53-16__26_.png" width="341" height="251" alt="Receiving a spoofed e-mail on hr@sec-consult.com from ceo@sec-consult.com "></picture></a><figcaption class="image-caption">
            Figure 26: Receiving a spoofed e-mail on hr@sec-consult.com from ceo@sec-consult.com 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>However, to keep it simple, we'll stick to just text.&nbsp;</p><p>So, this is cool, but again, <strong>that's not everything</strong>! Since the outbound Outlook SMTP server is not only used for e-mails by <a href="https://outlook.com/" target="_blank" rel="noreferrer">outlook.com</a>, but for <strong>the entirety of Exchange Online</strong>, we can now send e-mails from <strong>every domain which uses Exchange Online to send e-mails</strong>!&nbsp;</p><p>Since this affects <strong>LOTS</strong> of companies (as later discussed in SMTP Smuggling Impact section), we can choose our sender domain freely. We can even use <a href="https://sec-consult.com/" target="_blank">sec-consult.com</a> itself! (see figure 26)&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4643" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_exotic__27_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/5/b/csm_SMTP_Smuggling-SMTP_session_exotic__27__1e601db198.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/5/b/csm_SMTP_Smuggling-SMTP_session_exotic__27__6399fb19fc.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/5/b/csm_SMTP_Smuggling-SMTP_session_exotic__27__c4c8d253e6.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/5/b/csm_SMTP_Smuggling-SMTP_session_exotic__27__4e8ac3d3a0.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_exotic__27_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_exotic__27_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_session_exotic__27_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/5/b/csm_SMTP_Smuggling-SMTP_session_exotic__27__3127c76859.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_session_exotic__27_.png" width="568" height="188" alt="Example message data with exotic end-of-data sequence using a null byte "></picture></a><figcaption class="image-caption">
            Figure 27: Example message data with exotic end-of-data sequence using a null byte 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>As before, the SPF check succeeds with domain alignment, since sec-consult.com is using Exchange Online and the SPF record includes the respective Exchange Online SPF domain <strong>spf.protection.outlook.com</strong>.&nbsp;</p><p><span class="inline-code">Received-SPF: Pass (<a href="http://mx4.atos.net/" target="_blank" rel="noreferrer noopener">mx4.atos.net</a>: domain of <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" rel="noreferrer noopener" target="_blank" data-mailto-token="nbjmup+dfpAtfd.dpotvmu/dpn" data-mailto-vector="1">ceo(at)sec-consult.com</a>&nbsp;<br>   designates 40.92.48.103 as permitted sender)&nbsp;<br>   identity=mailfrom; client-ip=40.92.48.103;&nbsp;<br>   receiver=<a href="http://mx4.atos.net/" target="_blank" rel="noreferrer noopener">mx4.atos.net</a>; envelope-from="ceo@<a href="http://sec-consult.com/" target="_blank" rel="noreferrer noopener">sec-consult.com</a>";&nbsp;<br>   x-sender="ceo@<a href="http://sec-consult.com/" target="_blank" rel="noreferrer noopener">sec-consult.com</a>"; x-conformance=spf_only;&nbsp;<br>   x-record-type="v=spf1"; x-record-text="v=spf1&nbsp;<br>   ip4:40.92.0.0/15 ip4:40.107.0.0/16 ip4:52.100.0.0/14&nbsp;<br>   ip4:104.47.0.0/17 ip6:2a01:111:f400::/48&nbsp;<br>   ip6:2a01:111:f403::/49 ip6:2a01:111:f403:8000::/50&nbsp;<br>   ip6:2a01:111:f403:c000::/51 ip6:2a01:111:f403:f000::/52 -all"&nbsp;</span></p><p>With GMX and Exchange Online out of the way, we're now approaching our last target!&nbsp;</p><p>&nbsp;</p><h2>Smuggling to Amazon, PayPal, eBay, ..., on the road to Cisco&nbsp;</h2><p>GMX and Exchange Online allow SMTP smuggling due to insufficient sanitization at their outbound SMTP servers, <strong>but what about insecure inbound SMTP servers</strong>? What if there are inbound SMTP servers that allow such non-restrictive end-of-data sequences that even the most restrictive outbound SMTP servers would let such sequences through?&nbsp;</p><p>To get to the bottom of this, we can use a scanner that sends e-mails to inbound SMTP servers, but uses exotic end-of-data sequences. If the connection to the inbound SMTP server times out, the exotic end-of-data sequence was ignored. Otherwise, we most likely found something interesting!&nbsp;</p><p>So, what exactly is "exotic"? Exotic end-of-data sequences could for example be:&nbsp;</p><ul class="list-normal"><li>Interrupted end-of-data sequences: &nbsp;&nbsp; 	<ul class="list-normal"><li>&lt;CR&gt;&lt;LF&gt;\x00.&lt;CR&gt;&lt;LF&gt;&nbsp;</li><li>&lt;CR&gt;&lt;LF&gt;.\x00&lt;CR&gt;&lt;LF&gt;&nbsp;</li></ul></li><li>End-of-data sequences using incomplete CRLFs:&nbsp;&nbsp; 	<ul class="list-normal"><li>&lt;LF&gt;.&lt;LF&gt;&nbsp;</li><li>&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&nbsp;</li><li>&lt;CR&gt;.&lt;LF&gt;&nbsp;</li></ul></li><li>End-of-data sequences in the message header&nbsp;</li></ul><p>The message data of such an "exotic" e-mail could look like in figure 27.</p></div></div></div></section><section class="section section__textpic"><div id="c4644" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_smuggling_iCloud__28_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/6/0/csm_SMTP_Smuggling-SMTP_smuggling_iCloud__28__bc08a61165.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/6/0/csm_SMTP_Smuggling-SMTP_smuggling_iCloud__28__c559943149.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/6/0/csm_SMTP_Smuggling-SMTP_smuggling_iCloud__28__f84cec72dd.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/6/0/csm_SMTP_Smuggling-SMTP_smuggling_iCloud__28__c7b59a4c61.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_smuggling_iCloud__28_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-SMTP_smuggling_iCloud__28_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/6/0/csm_SMTP_Smuggling-SMTP_smuggling_iCloud__28__4a0fb995b7.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/6/0/csm_SMTP_Smuggling-SMTP_smuggling_iCloud__28__b8d8430e06.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/SMTP_Smuggling-SMTP_smuggling_iCloud__28_.png" width="967" height="570" alt="SMTP smuggling exploiting exotic end-of-data sequence &lt;CR&gt;.&lt;CR&gt; "></picture></a><figcaption class="image-caption">
            Figure 28: SMTP smuggling exploiting exotic end-of-data sequence &lt;CR&gt;.&lt;CR&gt; 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Now, by scanning the former Alexa Top 1000, various inbound SMTP servers accepting such sequences were identified! However, only one of those sequences seems to be working for lots of SMTP servers: <strong>&lt;CR&gt;.&lt;CR&gt;</strong>&nbsp;</p><p>This sequence gets accepted by the inbound e-mail servers of some really high-value targets:&nbsp;</p><ul class="list-normal"><li>Amazon&nbsp;</li><li>PayPal&nbsp;</li><li>eBay&nbsp;</li><li>Cisco&nbsp;</li><li>The IRS&nbsp;</li></ul><p>The one thing that they all have in common is that they're using <a href="https://www.cisco.com/site/in/en/products/security/secure-email/index.html" target="_blank" rel="noreferrer">Cisco Secure Email</a>, with on-prem <strong>Cisco Secure Email Gateway</strong> or cloud-based Cisco's Secure Email Cloud Gateway. And again, for some odd reason, sec-consult.com is using Cisco Secure Email Gateway as well!&nbsp;</p><p>As a proof of concept (figure 28), we can now send an e-mail from <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" rel="noreferrer noopener" target="_blank" data-mailto-token="nbjmup+benjoAjdmpve/dpn" data-mailto-vector="1">admin(at)icloud.com</a> to our target at sec-consult.com, since, like with many other outbound SMTP servers (further discussed in SMTP Smuggling Impact),<strong> &lt;CR&gt;.&lt;CR&gt; doesn't get filtered:</strong>&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4645" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-7-5_18-13-25__29_.png" class="lightbox" rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/9/4/csm_image-2023-7-5_18-13-25__29__735b18487b.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/9/4/csm_image-2023-7-5_18-13-25__29__bf5bae9a58.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/9/4/csm_image-2023-7-5_18-13-25__29__da3b2e851b.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/9/4/csm_image-2023-7-5_18-13-25__29__1246900d67.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_18-13-25__29_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_18-13-25__29_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_18-13-25__29_.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-7-5_18-13-25__29_.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-7-5_18-13-25__29_.png" width="337" height="250" alt="Sending spoofed e-mails as admin@icloud.com "></picture></a><figcaption class="image-caption">
            Figure 29: Sending spoofed e-mails as admin@icloud.com 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Like before, the e-mail goes through unscathed, as shown in figure 29.&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4646" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="https://securitytrails.com/domain/mx01.ionos.de/dns?__cf_chl_tk=.TKYmeShS.FZRsY6AAhEHSwz4V.4vi5xyMUN0i6TvkY-1702368252-0-gaNycGzNFWU" target="_blank" rel="noreferrer"><picture><source srcset="/fileadmin/_processed_/1/d/csm_ionos_domains__30__83ff974d3b.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/1/d/csm_ionos_domains__30__7db6508420.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/1/d/csm_ionos_domains__30__60b10fb935.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/1/d/csm_ionos_domains__30__1a6ebedea9.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/ionos_domains__30_.PNG" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/ionos_domains__30_.PNG" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/ionos_domains__30_.PNG" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/1/d/csm_ionos_domains__30__40b60ca736.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/ionos_domains__30_.PNG" width="592" height="269" alt="Getting domains using Ionos e-mail services via SecurityTrails "></picture></a><figcaption class="image-caption">
            Figure 30: Getting domains using Ionos e-mail services via SecurityTrails 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>SPF checks pass with domain alignment and without any issues.&nbsp;</p><p><span class="inline-code">Received-SPF: Pass (<a href="http://mx4.atos.net/" target="_blank" rel="noreferrer noopener">mx4.atos.net</a>: domain of <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" rel="noreferrer noopener" target="_blank" data-mailto-token="nbjmup+benjoAjdmpve/dpn" data-mailto-vector="1">admin(at)icloud.com</a>&nbsp;<br>   designates 17.57.155.23 as permitted sender)&nbsp;<br>   identity=mailfrom; client-ip=17.57.155.23;&nbsp;<br>   receiver=<a href="http://mx4.atos.net/" target="_blank" rel="noreferrer noopener">mx4.atos.net</a>; envelope-from="admin@<a href="http://icloud.com/" target="_blank" rel="noreferrer noopener">icloud.com</a>";&nbsp;<br>   x-sender="admin@<a href="http://icloud.com/" target="_blank" rel="noreferrer noopener">icloud.com</a>"; x-conformance=spf_only;&nbsp;<br>   x-record-type="v=spf1"; x-record-text="v=spf1&nbsp;<br>   ip4:17.58.0.0/16 ip4:17.57.155.0/24 ip4:17.57.156.0/24&nbsp;<br>   ip4:144.178.36.0/24 ip4:144.178.38.0/24 ip4:112.19.199.64/29&nbsp;<br>   ip4:112.19.242.64/29 ip4:222.73.195.64/29 ip4:157.255.1.64/29&nbsp;<br>   ip4:106.39.212.64/29 ip4:123.126.78.64/29&nbsp;<br> &nbsp; ip4:183.240.219.64/29 ip4:39.156.163.64/29 ~all"&nbsp;</span></p><p>Hence, DMARC passes as well:&nbsp;</p><p><span class="inline-code">Authentication-Results-Original: <a href="http://mx4.atos.net/" target="_blank" rel="noreferrer noopener">mx4.atos.net</a>; dkim=none (message not signed)&nbsp;<br>  header.i=none; spf=Pass smtp.mailfrom=admin@<a href="http://icloud.com/" target="_blank" rel="noreferrer noopener">icloud.com</a>; spf=None&nbsp;<br>  smtp.helo=postmaster@<a href="http://qs51p00im-qukt01080502.me.com/" target="_blank" rel="noreferrer noopener">qs51p00im-qukt01080502.me.com</a>; dmarc=pass (p=quarantine&nbsp;<br>  dis=none) d=<a href="http://icloud.com/" target="_blank" rel="noreferrer noopener">icloud.com</a>&nbsp;</span></p><p>With Cisco's Secure Email covered, we can now go on and take a look at the global impact!&nbsp;</p><p>&nbsp;</p><h2>SMTP Smuggling Impact&nbsp;</h2><p>At this point we've covered lots of <strong>outbound and inbound SMTP smuggling</strong>. But, speaking globally, how bad is it?&nbsp;</p><h3>GMX and Ionos&nbsp;</h3><p>SMTP smuggling via GMX and Ionos e-mail services allowed SMTP smuggling from roughly <strong>1.35 million different domains</strong>, as indicated by the domains pointing their MX record to Ionos (figure 30).&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4647" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="https://www.shodan.io/search/facet?query=port%3A25&amp;facet=product" target="_blank" rel="noreferrer"><picture><source srcset="/fileadmin/_processed_/e/d/csm_shodan_email_software__31__418eca2305.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/e/d/csm_shodan_email_software__31__eeb783d612.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/e/d/csm_shodan_email_software__31__757450cdc8.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/e/d/csm_shodan_email_software__31__402b607929.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/e/d/csm_shodan_email_software__31__4ab34bb636.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/e/d/csm_shodan_email_software__31__897b0e4498.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/e/d/csm_shodan_email_software__31__a8bcccd0c9.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/e/d/csm_shodan_email_software__31__69ecb2258e.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/csm_shodan_email_software__31__30e6c2e871.png" width="1100" height="185" alt="Used SMTP software on the Internet (Shodan)(results may vary) "></picture></a><figcaption class="image-caption">
            Figure 31: Used SMTP software on the Internet (Shodan)(results may vary) 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>Checking the SPF record of these domains confirms that they are most likely all permitting <strong>_spf-eu.ionos.com</strong> for sending e-mails.&nbsp;</p><p>However, as already mentioned, SMTP smuggling doesn't work for every receiving inbound SMTP server and, in this case, requires inbound SMTP servers to accept <strong>&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</strong> as end-of-data sequence. So, who's affected?&nbsp;</p><p>Only few of the bigger e-mail providers that were tested are affected. These include:&nbsp;</p><ul class="list-normal"><li data-aria-level="1" data-aria-posinset="1" data-font="Wingdings" data-leveltext="" data-list-defn-props="{&quot;335552541&quot;:1,&quot;335559684&quot;:-2,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769226&quot;:&quot;Wingdings&quot;,&quot;469769242&quot;:[9642],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" data-listid="8"><p>Fastmail&nbsp;</p></li><li data-aria-level="1" data-aria-posinset="2" data-font="Wingdings" data-leveltext="" data-list-defn-props="{&quot;335552541&quot;:1,&quot;335559684&quot;:-2,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769226&quot;:&quot;Wingdings&quot;,&quot;469769242&quot;:[9642],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" data-listid="8"><p>Runbox&nbsp;</p></li></ul><p>This might not seem bad at first, but looking at affected SMTP software on the Internet is a different story. After testing some popular e-mail software in their default configuration, it turned out that <strong>Postfix</strong> and <strong>Sendmail</strong> fulfil the requirements, are <strong>affected</strong> and can be smuggled to. Speaking globally, this is a lot (figure 31)!&nbsp;</p></div></div></div></section><section class="section section__text"><div id="c4648" class="frame frame-default frame-type-text frame-layout-0"><p>Aside from Postfix and Sendmail, other SMTP implementations are most likely affected as well, including Cisco Secure Email (Cloud) Gateway, to which we'll get in a second.&nbsp;</p><h3>Microsoft Exchange Online&nbsp;</h3><p>Same as GMX and Ionos, Exchange Online allowed smuggling via a <strong>&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</strong> end-of-data sequence as well, which makes it possible to smuggle from every domain pointing their SPF record to Exchange Online. This amounts to <a href="https://enlyft.com/tech/products/exchange-online" target="_blank" rel="noreferrer">millions of domains</a> all across the globe, including some very high-value targets owned by Microsoft like <strong>microsoft.com, msn.com, github.com, outlook.com, office365.com, openai.com</strong> and many more, and also domains of their customers (e.g., <strong>tesla.com, mastercard.com, nike.com</strong>, etc.).&nbsp;</p><p>However, as previously mentioned, smuggling from Exchange Online is even more restricted than from GMX/Ionos, since the receiving inbound SMTP server must support BDAT. This is the case for Fastmail and - still - hundreds of thousands of <a href="https://www.shodan.io/search?query=postfix+port%3A25+-CHUNKING" target="_blank" rel="noreferrer">postfix</a> and <a href="https://www.shodan.io/search?query=sendmail+port%3A25+-CHUNKING" target="_blank" rel="noreferrer">sendmail</a> servers.&nbsp;</p><p>&nbsp;</p></div></section><section class="section section__table"><div id="c4649" class="frame frame-default frame-type-table frame-layout-0"><table class="ce-table"><tbody><tr><td>
                            
                    
            
    


        Software
    


        
                
                        
                                </td><td>
                    
            
    


        Without BDAT/CHUNKING 
    


        
                
                        </td><td>
                    
            
    


        Total 
    


        
                
                        </td><td>
                    
            
    


        Percentage 
    


        
                
                        </td><td>
                    
            
    


        Shodan query 
    


        
                
                        </td></tr><tr><td>
                    
            
    


        Postfix 
    


        
                
                        </td><td>
            
    


        716884 
    


        
                </td><td>
            
    


        1475616 
    


        
                </td><td>
            
    


        ~50% 
    


        
                </td><td>
            
    


        postfix port:25 -CHUNKING 
    


        
                </td></tr><tr><td>
                    
            
    


        Sendmail 
    


        
                
                        </td><td>
            
    


        168823 
    


        
                </td><td>
            
    


        169030 
    


        
                </td><td>
            
    


        ~99% 
    


        
                </td><td>
            
    


        sendmail port:25 -CHUNKING 
    


        
                </td></tr></tbody></table></div></section><section class="section section__textpic"><div id="c4650" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="https://www.cisco.com/c/en/us/td/docs/security/esa/esa15-0/user_guide/b_ESA_Admin_Guide_15-0/b_ESA_Admin_Guide_12_1_chapter_0100.html?bookSearch=true#task_1254814__table_985308C400C84CE3BC190BC8A3A95D86" target="_blank" rel="noreferrer"><picture><source srcset="/fileadmin/_processed_/3/1/csm_image-2023-12-4_20-56-43__32__0e2fd56e2c.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/3/1/csm_image-2023-12-4_20-56-43__32__1d8d563df8.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/3/1/csm_image-2023-12-4_20-56-43__32__48afd52422.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/3/1/csm_image-2023-12-4_20-56-43__32__00e1ec65bf.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-12-4_20-56-43__32_.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/image-2023-12-4_20-56-43__32_.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/3/1/csm_image-2023-12-4_20-56-43__32__f1f8459130.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/3/1/csm_image-2023-12-4_20-56-43__32__9e7e5a4b7b.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/image-2023-12-4_20-56-43__32_.png" width="780" height="181" alt="Relevant configuration settings of Cisco Secure Email "></picture></a><figcaption class="image-caption">
            Figure 32: Relevant configuration settings of Cisco Secure Email 
        </figcaption></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p>These numbers from Shodan might not paint the whole picture though, as many servers maybe running postfix, but are hiding their identification banner. Also, other smaller SMTP servers are affected as well, again including Cisco Secure Email (Cloud) Gateway.&nbsp;</p><p>We did not analyze all SMTP software out there, hence it might be possible that other vulnerable servers exist as well.&nbsp;</p><h3>Cisco Secure Email (Cloud) Gateway&nbsp;</h3><p>The Cisco Secure Email Gateway and its cloud counterpart, the Cisco Secure Email Cloud Gateway, are both "vulnerable" to <strong>inbound</strong> SMTP smuggling. The quotes are necessary in this case, since, according to lengthy discussions with Cisco, this is not a bug, but a feature (see Responsible Disclosure section)!&nbsp;</p><p><strong>By default</strong>, Cisco Secure Email (Cloud) Gateway accepts <strong>&lt;CR&gt;.&lt;CR&gt;</strong> as end-of-data sequence, which does not get filtered by the following SMTP servers when sending outbound:&nbsp;</p><ul class="list-normal"><li>Outlook/Exchange Online&nbsp;</li><li>Icloud&nbsp;</li><li>On-premise exchange server&nbsp;</li><li>Postfix&nbsp;</li><li>Sendmail&nbsp;</li><li>Startmail&nbsp;</li><li>Fastmail&nbsp;</li><li>Zohomail&nbsp;</li></ul><p>This would allow inbound SMTP smuggling to around 40k domains using Cisco's Secure Email <strong>Cloud</strong> Gateway, if they're using the <strong>default configuration</strong> (like we did). These domains can be determined by checking a passive DNS database like SecurityTrails for <a href="https://securitytrails.com/list/apex_domain/iphmx.com" target="_blank" rel="noreferrer">iphmx.com subdomains</a>. Identifying on-premise Cisco Secure Email Gateways on the other hand is a difficult task, since lots of Internet-wide scanners (e.g., Shodan) seem to get blocked when conducting service scans. However, to get a better feeling for the usage of this product, we scanned the former Alexa Top 1000, and discovered at least the following 32 domains.&nbsp;</p><ul class="list-normal"><li><a href="http://amazon.com/" target="_blank" rel="noreferrer noopener">amazon.com</a>&nbsp;</li><li><a href="http://amazon.co.jp/" target="_blank" rel="noreferrer noopener">amazon.co.jp</a>&nbsp;</li><li><a href="http://amazon.co.uk/" target="_blank" rel="noreferrer noopener">amazon.co.uk</a>&nbsp;</li><li><a href="http://amazon.it/" target="_blank" rel="noreferrer noopener">amazon.it</a>&nbsp;</li><li><a href="http://amazon.fr/" target="_blank" rel="noreferrer noopener">amazon.fr</a>&nbsp;</li><li><a href="http://marriott.com/" target="_blank" rel="noreferrer noopener">marriott.com</a>&nbsp;</li><li><a href="http://cisco.com/" target="_blank" rel="noreferrer noopener">cisco.com</a>&nbsp;</li><li><a href="http://amazon.in/" target="_blank" rel="noreferrer noopener">amazon.in</a>&nbsp;</li><li><a href="http://paypal.com/" target="_blank" rel="noreferrer noopener">paypal.com</a>&nbsp;</li><li><a href="http://amazon.ca/" target="_blank" rel="noreferrer noopener">amazon.ca</a>&nbsp;</li><li><a href="http://goodreads.com/" target="_blank" rel="noreferrer noopener">goodreads.com</a>&nbsp;</li><li><a href="http://webex.com/" target="_blank" rel="noreferrer noopener">webex.com</a>&nbsp;</li><li><a href="http://custhelp.com/" target="_blank" rel="noreferrer noopener">custhelp.com</a>&nbsp;</li><li><a href="http://imdb.com/" target="_blank" rel="noreferrer noopener">imdb.com</a>&nbsp;</li><li><a href="http://intuit.com/" target="_blank" rel="noreferrer noopener">intuit.com</a>&nbsp;</li><li><a href="http://ndtv.com/" target="_blank" rel="noreferrer noopener">ndtv.com</a>&nbsp;</li><li><a href="http://amazon.cn/" target="_blank" rel="noreferrer noopener">amazon.cn</a>&nbsp;</li><li><a href="http://makemytrip.com/" target="_blank" rel="noreferrer noopener">makemytrip.com</a>&nbsp;</li><li><a href="http://amazon.com.au/" target="_blank" rel="noreferrer noopener">amazon.com.au</a>&nbsp;</li><li><a href="http://amazonaws.com/" target="_blank" rel="noreferrer noopener">amazonaws.com</a>&nbsp;</li><li><a href="http://primevideo.com/" target="_blank" rel="noreferrer noopener">primevideo.com</a>&nbsp;</li><li><a href="http://amazon.es/" target="_blank" rel="noreferrer noopener">amazon.es</a>&nbsp;</li><li><a href="http://irs.gov/" target="_blank" rel="noreferrer noopener">irs.gov</a>&nbsp;</li><li><a href="http://amazon.com.br/" target="_blank" rel="noreferrer noopener">amazon.com.br</a>&nbsp;</li><li><a href="http://aastocks.com/" target="_blank" rel="noreferrer noopener">aastocks.com</a>&nbsp;</li><li><a href="http://ebay.com/" target="_blank" rel="noreferrer noopener">ebay.com</a>&nbsp;</li><li><a href="http://amazon.de/" target="_blank" rel="noreferrer noopener">amazon.de</a>&nbsp;</li><li><a href="http://ebay.de/" target="_blank" rel="noreferrer noopener">ebay.de</a>&nbsp;</li><li><a href="http://ebay.co.uk/" target="_blank" rel="noreferrer noopener">ebay.co.uk</a>&nbsp;</li><li><a href="http://ebay.com.au/" target="_blank" rel="noreferrer noopener">ebay.com.au</a>&nbsp;</li><li><a href="http://mayoclinic.org/" target="_blank" rel="noreferrer noopener">mayoclinic.org</a>&nbsp;</li><li><a href="http://audible.com/" target="_blank" rel="noreferrer noopener">audible.com</a>&nbsp;</li></ul><p>Note that this doesn't take into account servers that don't have an MX record let alone an SMTP server.&nbsp;</p><p>&nbsp;</p><h2>Further vulnerabilities&nbsp;</h2><p>During the research we've also discovered some exotic inbound SMTP servers that interpret end-of-data sequences like <strong>&lt;CR&gt;&lt;LF&gt;\x00.&lt;CR&gt;&lt;LF&gt;</strong>, with "\x00" representing a null byte. With proprietary SMTP components and lots of different e-mail services intertwined it's hard to tell what is possible until an e-mail reaches its final destination.&nbsp;</p><p>Even though SMTP smuggling might still be hiding in some places, we hopefully eliminated some big targets.&nbsp;<br> &nbsp;</p><h2>Responsible Disclosure&nbsp;</h2><p>How do we report a vulnerability that is based on protocol interpretation? Who is right, who is wrong? Let's take a look at some RFCs!&nbsp;</p><p>In general, <a href="https://www.rfc-editor.org/rfc/rfc5321" target="_blank" rel="noreferrer">RFC 5321</a> from 2008 states the following:&nbsp;</p><p><strong><em>"The custom of accepting lines ending only in &lt;LF&gt;, as a concession to non-conforming behavior on the part of some UNIX systems, has proven to cause more interoperability problems than it solves, and SMTP server systems MUST NOT do this, even in the name of improved robustness.&nbsp; In particular, the sequence "&lt;LF&gt;.&lt;LF&gt;" (bare line feeds, without carriage returns) MUST NOT be treated as equivalent to &lt;CRLF&gt;.&lt;CRLF&gt; as the end of mail data indication."&nbsp;</em></strong></p><p>So, it's the inbound SMTP server's fault! But wait, <a href="https://www.rfc-editor.org/rfc/rfc5322" target="_blank" rel="noreferrer">RFC 5322</a>, also from 2008, says the following about the body of a message:&nbsp;</p><p><em><strong>"CR and LF MUST only occur together as CRLF; they MUST NOT appear independently in the body."</strong></em></p><p>This essentially means that <strong>both sides (outbound and inbound)</strong> are at fault! Also, this shows us that inconsistent interpretation of the end-of-data sequence is not a novel issue. Now, what do the affected parties think about this? We have thus initiated our responsible disclosure process around <strong>end of July 2023</strong> (see Timeline further below).&nbsp;</p><h3>GMX&nbsp;</h3><p>The responsible disclosure process with GMX was pure bliss. After immediately receiving a response, the issue was fixed in roughly ten days. Aside from paying a bounty, they even added Timo to their <a href="https://bugbounty.gmx.net/halloffame-index.html" target="_blank" rel="noreferrer">bug bounty hall of fame</a>. All-in-all a great experience! Huge props to GMX for such a professional and quick reaction.&nbsp;</p><h3>Microsoft&nbsp;</h3><p>The outbound SMTP smuggling vulnerability was submitted via the <a href="https://www.microsoft.com/en-us/msrc" target="_blank" rel="noreferrer">Microsoft Security Response Center (MSRC)</a>. Roughly a month later, Microsoft replied:&nbsp;</p><p><strong><em>"Thank you again for submitting this issue to Microsoft. Currently, MSRC prioritizes vulnerabilities that are assessed as “Important” or “Critical'’ severities for immediate servicing. After careful investigation, this case has been assessed as moderate severity and does not meet MSRC’s bar for immediate servicing since the attack only works if the mail server of the recipient treats a non-standard EOD sequence as EOD . However, we have shared the report with the team responsible for maintaining the product or service. They will take appropriate action as needed to help keep customers protected"&nbsp;&nbsp;</em></strong></p><p>Fair enough, they got bigger fish to fry! After retesting the issue every now and then, they seem to have fixed it roughly in the middle of October 2023.&nbsp;</p><h3>Cisco&nbsp;</h3><p>As previously mentioned, the "vulnerability" in Cisco Secure Email (Cloud) Gateway is not a bug, but a feature. And, unlike in most cases, this is actually somewhat true.&nbsp;</p><p>Cisco Secure Email (Cloud) Gateway can be configured to handle carriage returns and line feeds in a special manner, as seen <a href="https://www.cisco.com/c/en/us/td/docs/security/esa/esa15-0/user_guide/b_ESA_Admin_Guide_15-0/b_ESA_Admin_Guide_12_1_chapter_0100.html?bookSearch=true#task_1254814__table_985308C400C84CE3BC190BC8A3A95D86" target="_blank" rel="noreferrer">here</a>.&nbsp;</p></div></div></div></section><section class="section section__text"><div id="c4653" class="frame frame-default frame-type-text frame-layout-0"><p>However, <strong>by default</strong>, Cisco Secure Email (Cloud) Gateway "Allows the message, but converts bare CR and LF characters to CRLF characters" (the vulnerable "Clean" setting), which basically <strong>enables inbound SMTP smuggling</strong> via <strong>&lt;CR&gt;.&lt;CR&gt; </strong>end-of-data sequences. We have communicated this issue to Cisco and CERT/CC and went back and forth quite a bit. But at the end of the day, it's not a bug, it's a feature.&nbsp;</p><p>Since this feature allowed us to send spoofed e-mails from arbitrary Exchange Online domains straight into our inboxes, we decided to <strong>change</strong> the configuration to "<strong>Allow</strong>".&nbsp;</p><p>This passes e-mails with bare carriage returns or line feeds on to our actual e-mail server (Cisco Secure Email Gateway is just a gateway), which only interprets &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt; as end-of-data sequence. If you don't want to receive spoofed e-mails with valid DMARC checks as well, we highly recommend changing your configuration!&nbsp;</p><h2>Conclusion&nbsp;</h2><p>We've shown a novel SMTP spoofing technique with this research that allowed to spoof e-mails from millions of domains.&nbsp;</p><p>Even though Microsoft and GMX have patched this issue promptly, inbound SMTP smuggling to Cisco Secure Email instances (cloud and on-premise) is still possible with <strong>default</strong> configurations. We highly encourage to change these default configurations, as described in the Responsible Disclosure chapter.&nbsp;</p><p>Also, this blog post hopefully sparked further interest in SMTP research, since there is still so much to explore. Even with SMTP smuggling alone, there are many things to look at:&nbsp;</p><ul class="list-normal"><li>Other smuggling techniques&nbsp;</li><li>Bounce smuggling&nbsp;</li><li>Smuggling via BDAT&nbsp;</li><li>Smuggling dangerous/exotic SMTP commands&nbsp;</li><li>Internet-wide scans&nbsp;</li><li>Other SMTP software&nbsp;</li><li>etc.&nbsp;</li></ul><p>So, this is probably not the last time you've heard of SMTP smuggling!&nbsp;</p></div></section><section class="section section__text"><div id="c4655" class="frame frame-default frame-type-text frame-layout-0"><h2>Timeline</h2></div></section><section class="section section__table"><div id="c4654" class="frame frame-default frame-type-table frame-layout-0"><table class="ce-table"><tbody><tr><th>
                            
                    
            
    


        2023-06-07: 
    


        
                
                        
                                </th><td>
                    
            
    


        First outbound SMTP smuggling proof of concept (GMX)
    


        
                
                        </td></tr><tr><th>
                    
            
    


        2023-06-08:
    


        
                
                        </th><td>
            
    


        Discovery of outbound SMTP smuggling in Exchange Online
    


        
                </td></tr><tr><th>
                    
            
    


        2023-06-20: 
    


        
                
                        </th><td>
            
    


        Discovery of Cisco Secure Email (Cloud) Gateway inbound SMTP smuggling
    


        
                </td></tr><tr><th>
                    
            
    


        2023-06/2023-07: 
    


        
                
                        </th><td>
            
    


        Developing tools, analyzing test cases, further research
    


        
                </td></tr><tr><th>
                    
            
    


        2023-07-26:
    


        
                
                        </th><td>
            
    


        Contacting MSRC
    


        
                </td></tr><tr><th>
                    
            
    


        2023-07-27: 
    


        
                
                        </th><td>
            
    


        Contacting Cisco
    


        
                </td></tr><tr><th>
                    
            
    


        2023-07-29:
    


        
                
                        </th><td>
            
    


        Contacting GMX.
    


        
                </td></tr><tr><th>
                    
            
    


        2023-08-10:
    


        
                
                        </th><td>
            
    


        GMX fixed the issue
    


        
                </td></tr><tr><th>
                    
            
    


        2023-08-17: 
    


        
                
                        </th><td>
            
    


        Contacting CERT Coordination Center (CERT/CC) for further discussion with Cisco
    


        
                </td></tr><tr><th>
                    
            
    


        2023-08-23: 
    


        
                
                        </th><td>
            
    


        Microsoft responds and rates the vulnerability with moderate risk
    


        
                </td></tr><tr><th>
                    
            
    


        2023-09-13:
    


        
                
                        </th><td>
            
    


        CERT/CC accepts the case
    


        
                </td></tr><tr><th>
                    
            
    


        2023-10-16: 
    


        
                
                        </th><td>
            
    


        SMTP smuggling in Exchange Online is fixed
    


        
                </td></tr><tr><th>
                    
            
    


        2023-11-29:
    


        
                
                        </th><td>
            
    


        CERT/CC allows public release of SMTP smuggling, since no software vulnerabilities were identified ("it's not a bug, it's a feature")
    


        
                </td></tr><tr><th>
                    
            
    


        2023-12-05:
    


        
                
                        </th><td>
            
    


        Informing CERT.at and CERT-Bund about planned release, providing blog post draft, warning about Cisco configuration
    


        
                </td></tr><tr><th>
                    
            
    


        2023-12-18:
    


        
                
                        </th><td>
            
    


        Release date of blog post 
    


        
                </td></tr></tbody></table></div></section><section class="section section__text"><div id="c4657" class="frame frame-default frame-type-text frame-layout-0"><p class="text-center"><em>This research was done by Timo Longin and published on behalf of the <a href="https://sec-consult.com/vulnerability-lab/#c1699" target="_blank">SEC Consult Vulnerability Lab</a>.&nbsp;</em></p></div></section><section class="section section__accordion"><div id="c4656" class="frame frame-default frame-type-accordion frame-layout-0"><header><h2>
                FAQ 
            </h2></header><div id="accordion4656" class="accordion__content"><div class="accordion__card"><div class="accordion__header" id="accordionHeading-1-4656"><button class="accordion__button" data-toggle="#accordion-item-1-4656" data-toggle-role="accordion" aria-controls="accordion-item-1-4656" aria-expanded="false">How do I know if I am affected?  <span class="accordion__icon"></span></button></div><div class="accordion__dropdown" aria-labelledby="accordionHeading-1-4656" data-toggle-animate="" id="accordion-item-1-4656"><div class="accordion__body"><div class="accordion__text"><p>If you are a user of a big e-mail provider (Outlook, Gmail, etc.), you are most likely going to be fine (for now at least). Since SMTP smuggling is a fairly new topic and still has things to explore, we cannot be certain though. However, if you're using Cisco Secure Email (cloud or on-premise), you should definitely check your configuration (see Responsible Disclosure)!&nbsp;But, as always, don't blindly trust anything that lands in your e-mail inbox!&nbsp;</p><p>Update from 10/01/2024:&nbsp;Official tools to test for SMTP smuggling issues are now available on <a href="https://github.com/The-Login/SMTP-Smuggling-Tools" target="_blank" rel="noreferrer">GitHub</a>!</p><p>&nbsp;</p></div></div></div></div><div class="accordion__card"><div class="accordion__header" id="accordionHeading-2-4656"><button class="accordion__button" data-toggle="#accordion-item-2-4656" data-toggle-role="accordion" aria-controls="accordion-item-2-4656" aria-expanded="false">Is there a tool available to verify whether I am vulnerable?  <span class="accordion__icon"></span></button></div><div class="accordion__dropdown" aria-labelledby="accordionHeading-2-4656" data-toggle-animate="" id="accordion-item-2-4656"><div class="accordion__body"><div class="accordion__text"><p>Update from 10/01/2024:&nbsp;Official tools to test for SMTP smuggling issues are now available on <a href="https://github.com/The-Login/SMTP-Smuggling-Tools" target="_blank" rel="noreferrer">GitHub</a>!</p><p>We have developed an analysis tool internally but decided to publish it at a later date (maybe already at the <a href="https://events.ccc.de/congress/2023/hub/en/fahrplan" target="_blank" rel="noreferrer">37C3 conference</a> end of December 2023 where this research will be presented), as currently many Cisco Secure Mail installations are affected by the issue. &nbsp;</p></div></div></div></div><div class="accordion__card"><div class="accordion__header" id="accordionHeading-3-4656"><button class="accordion__button" data-toggle="#accordion-item-3-4656" data-toggle-role="accordion" aria-controls="accordion-item-3-4656" aria-expanded="false">Do smuggled e-mails always get past spam filters?  <span class="accordion__icon"></span></button></div><div class="accordion__dropdown" aria-labelledby="accordionHeading-3-4656" data-toggle-animate="" id="accordion-item-3-4656"><div class="accordion__body"><div class="accordion__text"><p>The short answer is no, not always! Even though the smuggled e-mail might come from a legitimate sender and passes e-mail authentication due to SPF alignment, the e-mail might still get blocked, depending on the e-mail contents and other factors. Also, if more than SPF alignment is required for the e-mail to go through, we're out of luck with SMTP smuggling.&nbsp;</p></div></div></div></div><div class="accordion__card"><div class="accordion__header" id="accordionHeading-4-4656"><button class="accordion__button" data-toggle="#accordion-item-4-4656" data-toggle-role="accordion" aria-controls="accordion-item-4-4656" aria-expanded="false">How would someone even get the idea of looking at a protocol like SMTP?  <span class="accordion__icon"></span></button></div><div class="accordion__dropdown" aria-labelledby="accordionHeading-4-4656" data-toggle-animate="" id="accordion-item-4-4656"><div class="accordion__body"><div class="accordion__text"><p>There are two major reasons:&nbsp;</p><ol><li>SMTP is a very old protocol that is somewhat flying under the radar of a lot of security researchers (kind of like <a href="https://sec-consult.com/blog/detail/taking-over-a-country-kaminsky-style/" target="_blank" rel="noreferrer noopener">DNS</a>). Since there wasn't any related research that indicated similar attacks, the chances were good for finding something new!&nbsp;</li><li>Phishing is one of the best ways for threat actors or our red teamers to gain initial access to an organization. Therefore, looking for vulnerabilities in the underlying e-mail protocol - SMTP - seemed natural.&nbsp;</li></ol></div></div></div></div><div class="accordion__card"><div class="accordion__header" id="accordionHeading-5-4656"><button class="accordion__button" data-toggle="#accordion-item-5-4656" data-toggle-role="accordion" aria-controls="accordion-item-5-4656" aria-expanded="false">Is this a novel attack technique?  <span class="accordion__icon"></span></button></div><div class="accordion__dropdown" aria-labelledby="accordionHeading-5-4656" data-toggle-animate="" id="accordion-item-5-4656"><div class="accordion__body"><div class="accordion__text"><p>Most likely! Again, for two major reasons:&nbsp;</p><ol><li>Microsoft's SMTP infrastructure including Exchange Online was vulnerable. This would have most likely been found and fixed by prior researchers.&nbsp;</li><li>We haven't found any research stating otherwise.&nbsp;</li></ol></div></div></div></div><div class="accordion__card"><div class="accordion__header" id="accordionHeading-6-4656"><button class="accordion__button" data-toggle="#accordion-item-6-4656" data-toggle-role="accordion" aria-controls="accordion-item-6-4656" aria-expanded="false">Are there other interesting SMTP and e-mailing attacks?  <span class="accordion__icon"></span></button></div><div class="accordion__dropdown" aria-labelledby="accordionHeading-6-4656" data-toggle-animate="" id="accordion-item-6-4656"><div class="accordion__body"><div class="accordion__text"><p>Yes, lots of them! For example, <a href="https://www.usenix.org/conference/usenixsecurity21/presentation/shen-kaiwen" target="_blank" rel="noreferrer">"Weak Links in Authentication Chains: A Large-scale - Analysis of Email Sender Spoofing Attacks"</a> shows a range of interesting attacks that even worked with Gmail!&nbsp;</p></div></div></div></div><div class="accordion__card"><div class="accordion__header" id="accordionHeading-7-4656"><button class="accordion__button" data-toggle="#accordion-item-7-4656" data-toggle-role="accordion" aria-controls="accordion-item-7-4656" aria-expanded="false">Can confusions of &lt;CR&gt;&lt;LF&gt; and &lt;LF&gt; and alike cause security issues in other protocols as well?  <span class="accordion__icon"></span></button></div><div class="accordion__dropdown" aria-labelledby="accordionHeading-7-4656" data-toggle-animate="" id="accordion-item-7-4656"><div class="accordion__body"><div class="accordion__text"><p>Yes, of course! In general, implementations of (sometimes) vague specifications can cause all kinds of security issues.&nbsp;</p></div></div></div></div><div class="accordion__card"><div class="accordion__header" id="accordionHeading-8-4656"><button class="accordion__button" data-toggle="#accordion-item-8-4656" data-toggle-role="accordion" aria-controls="accordion-item-8-4656" aria-expanded="false">Have you scanned the whole Internet and tested ALL e-mailing services?  <span class="accordion__icon"></span></button></div><div class="accordion__dropdown" aria-labelledby="accordionHeading-8-4656" data-toggle-animate="" id="accordion-item-8-4656"><div class="accordion__body"><div class="accordion__text"><p>As already mentioned, scanning e-mail services for used software and versions may yield inaccurate results and will most likely get you on some kind of blacklist. The same goes for more specific end-of-data sequence checks, where basically a whole e-mail is sent. Therefore, we could roughly only analyze the top 10k of Alexa domains during this research.&nbsp;</p></div></div></div></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"FAQPage","@id":"/blog/detail/","mainEntity":[{"@type":"Question","name":"How do I know if I am affected? ","acceptedAnswer":{"@type":"Answer","text":"<p>If you are a user of a big e-mail provider (Outlook, Gmail, etc.), you are most likely going to be fine (for now at least). Since SMTP smuggling is a fairly new topic and still has things to explore, we cannot be certain though. However, if you're using Cisco Secure Email (cloud or on-premise), you should definitely check your configuration (see Responsible Disclosure)!&nbsp;But, as always, don't blindly trust anything that lands in your e-mail inbox!&nbsp;</p>\n<p>Update from 10/01/2024:&nbsp;Official tools to test for SMTP smuggling issues are now available on <a href=\"https://github.com/The-Login/SMTP-Smuggling-Tools\" target=\"_blank\" rel=\"noreferrer\">GitHub</a>!</p>\n<p>&nbsp;</p>"}},{"@type":"Question","name":"Is there a tool available to verify whether I am vulnerable? ","acceptedAnswer":{"@type":"Answer","text":"<p>Update from 10/01/2024:&nbsp;Official tools to test for SMTP smuggling issues are now available on <a href=\"https://github.com/The-Login/SMTP-Smuggling-Tools\" target=\"_blank\" rel=\"noreferrer\">GitHub</a>!</p>\n<p>We have developed an analysis tool internally but decided to publish it at a later date (maybe already at the <a href=\"https://events.ccc.de/congress/2023/hub/en/fahrplan\" target=\"_blank\" rel=\"noreferrer\">37C3 conference</a> end of December 2023 where this research will be presented), as currently many Cisco Secure Mail installations are affected by the issue.\u202f&nbsp;</p>"}},{"@type":"Question","name":"Do smuggled e-mails always get past spam filters? ","acceptedAnswer":{"@type":"Answer","text":"<p>The short answer is no, not always! Even though the smuggled e-mail might come from a legitimate sender and passes e-mail authentication due to SPF alignment, the e-mail might still get blocked, depending on the e-mail contents and other factors. Also, if more than SPF alignment is required for the e-mail to go through, we're out of luck with SMTP smuggling.&nbsp;</p>"}},{"@type":"Question","name":"How would someone even get the idea of looking at a protocol like SMTP? ","acceptedAnswer":{"@type":"Answer","text":"<p>There are two major reasons:&nbsp;</p><ol> \t<li>SMTP is a very old protocol that is somewhat flying under the radar of a lot of security researchers (kind of like <a href=\"https://sec-consult.com/blog/detail/taking-over-a-country-kaminsky-style/\" target=\"_blank\" rel=\"noreferrer noopener\">DNS</a>). Since there wasn't any related research that indicated similar attacks, the chances were good for finding something new!&nbsp;</li> \t<li>Phishing is one of the best ways for threat actors or our red teamers to gain initial access to an organization. Therefore, looking for vulnerabilities in the underlying e-mail protocol - SMTP - seemed natural.&nbsp;</li></ol>"}},{"@type":"Question","name":"Is this a novel attack technique? ","acceptedAnswer":{"@type":"Answer","text":"<p>Most likely! Again, for two major reasons:&nbsp;</p><ol> \t<li>Microsoft's SMTP infrastructure including Exchange Online was vulnerable. This would have most likely been found and fixed by prior researchers.&nbsp;</li> \t<li>We haven't found any research stating otherwise.&nbsp;</li></ol>"}},{"@type":"Question","name":"Are there other interesting SMTP and e-mailing attacks? ","acceptedAnswer":{"@type":"Answer","text":"<p>Yes, lots of them! For example, <a href=\"https://www.usenix.org/conference/usenixsecurity21/presentation/shen-kaiwen\" target=\"_blank\" rel=\"noreferrer\">\"Weak Links in Authentication Chains: A Large-scale - Analysis of Email Sender Spoofing Attacks\"</a> shows a range of interesting attacks that even worked with Gmail!&nbsp;</p>"}},{"@type":"Question","name":"Can confusions of <CR><LF> and <LF> and alike cause security issues in other protocols as well? ","acceptedAnswer":{"@type":"Answer","text":"<p>Yes, of course! In general, implementations of (sometimes) vague specifications can cause all kinds of security issues.&nbsp;</p>"}},{"@type":"Question","name":"Have you scanned the whole Internet and tested ALL e-mailing services? ","acceptedAnswer":{"@type":"Answer","text":"<p>As already mentioned, scanning e-mail services for used software and versions may yield inaccurate results and will most likely get you on some kind of blacklist. The same goes for more specific end-of-data sequence checks, where basically a whole e-mail is sent. Therefore, we could roughly only analyze the top 10k of Alexa domains during this research.&nbsp;</p>"}}]}</script></div></section><section class="section section__call_to_action"><div id="c4658" class="frame frame-default frame-type-call_to_action frame-layout-0"><div class="cta"><div class="cta__left"><header><h3>
                Are you interested in working at SEC Consult?
            </h3></header>
    



            SEC Consult is always searching for talented security professionals to work in our team.
        </div><div class="cta__right"><a href="https://sec-consult.com/career/#c2854" class="cta__btn">
                More Information
            </a></div></div></div></section><div class="news-detail__authors"><h4>
                    About the author
                </h4><div class="news-author"><div class="news-author__img"><picture><source data-srcset="/fileadmin/_processed_/7/6/csm_a-TLO_d31c6ef63b.webp" type="image/webp" media="(min-width: 567px)"><source data-srcset="/fileadmin/_processed_/7/6/csm_a-TLO_8cd69e1dd8.webp" type="image/webp" media="(min-width: 100px)"><source data-srcset="/fileadmin/_processed_/7/6/csm_a-TLO_3e1f9a3b48.jpg" type="image/jpg" media="(min-width: 567px)"><source data-srcset="/fileadmin/_processed_/7/6/csm_a-TLO_382f2d4a9d.jpg" type="image/jpg" media="(min-width: 100px)"><img data-sizes="auto" class="lazyload" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAcAQAAAAC8Xyl9AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACdFJOUwAAdpPNOAAAAAJiS0dEAAHdihOkAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5wseCw4XEYbXjwAAAAxJREFUCNdjYBg8AAAAjAABU9Jk1AAAABt0RVh0aWNjOmNvcHlyaWdodABQdWJsaWMgRG9tYWlutpExWwAAACJ0RVh0aWNjOmRlc2NyaXB0aW9uAEdJTVAgYnVpbHQtaW4gc1JHQkxnQRMAAAAVdEVYdGljYzptYW51ZmFjdHVyZXIAR0lNUEyekMoAAAAOdEVYdGljYzptb2RlbABzUkdCW2BJQwAAAABJRU5ErkJggg==" data-src="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/Authors/a-TLO.png" width="300" height="336" alt="Portrait of Timo Longin SEC Consult" title=""></picture></div><div class="news-author__text"><span class="news-author__name">Timo Longin</span><br><span>SEC Consult </span><br><span>Senior Security Consultant</span><br><p>Timo Longin (also known as Login) is a senior security consultant at SEC Consult at day and a security researcher at night. Aside from everyday security assessments, he publishes blog posts and security tools, holds talks at conferences and universities,&nbsp;and has a passion for CTFs. As a well-rounded offensive security researcher, he tries to find forgotten and new exploitation techniques that make the unthinkable possible!</p></div></div></div><div class="news-detail__back-link-wrap"><a class="news-detail__back-link" href="https://sec-consult.com/blog/">
                    Back
                </a></div></div></div></div></div></section><!--TYPO3SEARCH_end--></div></section><footer class="footer"><div class="footer-top"><div class="footer__container"><div class="footer__row"><div class="footer__col footer__col--4"><nav><ul class="footer-nav"><li class="footer-nav__item"><a class="footer-nav__link" href="https://sec-consult.com/legalnotice/">Legal Notice</a></li><li class="footer-nav__item"><a class="footer-nav__link" href="https://sec-consult.com/privacy-statement/">Privacy Statement</a></li><li class="footer-nav__item"><a class="footer-nav__link" href="https://sec-consult.com/career/">Jobs</a></li></ul></nav></div><div class="footer__col footer__col--8"><p class="footer-text">
                        
                        
                        
                        
                        
                        
                        
                        SEC Consult is one of the leading consultancies in the field of cyber and <a href="https://sec-consult.com/security-testing/web-application-security/" title="Web Application Security">application security</a>. The company specializes in <a href="https://sec-consult.com/processes-organisation/information-security-management-ism/" title="Information Security Management (ISM)">information security management</a>, <a href="https://sec-consult.com/processes-organisation/network-and-information-systems-security-nis/" title="NIS security audits">NIS security audits</a>, <a href="https://sec-consult.com/security-testing/penetration-testing/" title="Pentesting (Pentest)">penetration testing</a>, ISO 27001 certification support, <a href="https://sec-consult.com/incident-response/sec-defence/" title="Cyber Defence">Cyber Defence</a> and <a href="https://sec-consult.com/processes-organisation/secure-software-development/" title="Secure Software Development Consulting">secure software certification</a>. SEC Consult is part of <a href="https://eviden.com/" title="Link to Eviden website" target="_blank" rel="noreferrer">Eviden</a>.
                    </p></div></div></div></div><div class="footer-middle"><div class="footer__container"><div class="footer-logos"><a title="About us" href="https://sec-consult.com/about-us/"><img class="lazyload" alt="bsi ISO/IEC 27001 Information Security Management CERTIFIED" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAEAQAAAABqvRjQAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAnRSTlMAAHaTzTgAAAACYktHRAAB3YoTpAAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cIEQkBF4pZdagAAAALSURBVAjXY2CAAAAACAABLyDdMQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wOC0xN1QwODo1ODowNiswMDowMB1J7+AAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDgtMTdUMDg6NTg6MDYrMDA6MDBsFFdcAAAAG3RFWHRpY2M6Y29weXJpZ2h0AFB1YmxpYyBEb21haW62kTFbAAAAInRFWHRpY2M6ZGVzY3JpcHRpb24AR0lNUCBidWlsdC1pbiBzUkdCTGdBEwAAABV0RVh0aWNjOm1hbnVmYWN0dXJlcgBHSU1QTJ6QygAAAA50RVh0aWNjOm1vZGVsAHNSR0JbYElDAAAAAElFTkSuQmCC" data-src="/typo3temp/assets/_processed_/4/e/csm_bsi_0cef4aa90e.png" width="140" height="80" title=""></a><a title="About us" href="https://sec-consult.com/about-us/"><img class="lazyload" alt="ISO 27001 CREST certified" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEMAAABQAQAAAABq8/XrAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAnRSTlMAAHaTzTgAAAACYktHRAAB3YoTpAAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cIEQkBF4pZdagAAAAQSURBVCjPY2AYBaNgFOACAAMgAAHOjxDEAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA4LTE3VDA4OjU4OjA2KzAwOjAwHUnv4AAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wOC0xN1QwODo1ODowNiswMDowMGwUV1wAAAAbdEVYdGljYzpjb3B5cmlnaHQAUHVibGljIERvbWFpbraRMVsAAAAidEVYdGljYzpkZXNjcmlwdGlvbgBHSU1QIGJ1aWx0LWluIHNSR0JMZ0ETAAAAFXRFWHRpY2M6bWFudWZhY3R1cmVyAEdJTVBMnpDKAAAADnRFWHRpY2M6bW9kZWwAc1JHQltgSUMAAAAASUVORK5CYII=" data-src="/typo3temp/assets/_processed_/0/4/csm_crest_00f1456b85.png" width="67" height="80" title=""></a><a title="About us" href="https://sec-consult.com/about-us/"><img class="lazyload" alt="Great Place To Work AT certified" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAABQAQAAAAChKBEVAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAnRSTlMAAHaTzTgAAAACYktHRAAB3YoTpAAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cIEQkBF4pZdagAAAAPSURBVCjPY2AYBaOAeAAAAjAAASx75zQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDgtMTdUMDg6NTg6MDYrMDA6MDAdSe/gAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA4LTE3VDA4OjU4OjA2KzAwOjAwbBRXXAAAABt0RVh0aWNjOmNvcHlyaWdodABQdWJsaWMgRG9tYWlutpExWwAAACJ0RVh0aWNjOmRlc2NyaXB0aW9uAEdJTVAgYnVpbHQtaW4gc1JHQkxnQRMAAAAVdEVYdGljYzptYW51ZmFjdHVyZXIAR0lNUEyekMoAAAAOdEVYdGljYzptb2RlbABzUkdCW2BJQwAAAABJRU5ErkJggg==" data-src="/typo3temp/assets/_processed_/e/8/csm_great-place-to-work-at_0baea5649b.png" width="47" height="80" title=""></a><a title="About us" href="https://sec-consult.com/about-us/"><img class="lazyload" alt="Great Place To Work DE certified" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAABQAQAAAAChKBEVAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAnRSTlMAAHaTzTgAAAACYktHRAAB3YoTpAAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cIEQkBF4pZdagAAAAPSURBVCjPY2AYBaOAeAAAAjAAASx75zQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDgtMTdUMDg6NTg6MDYrMDA6MDAdSe/gAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA4LTE3VDA4OjU4OjA2KzAwOjAwbBRXXAAAABt0RVh0aWNjOmNvcHlyaWdodABQdWJsaWMgRG9tYWlutpExWwAAACJ0RVh0aWNjOmRlc2NyaXB0aW9uAEdJTVAgYnVpbHQtaW4gc1JHQkxnQRMAAAAVdEVYdGljYzptYW51ZmFjdHVyZXIAR0lNUEyekMoAAAAOdEVYdGljYzptb2RlbABzUkdCW2BJQwAAAABJRU5ErkJggg==" data-src="/typo3temp/assets/_processed_/5/7/csm_great-place-to-work-de_25b749e961.png" width="47" height="80" title=""></a></div></div></div><div class="footer-bottom"><div class="footer__container"><nav><ul class="footer-social"><li class="footer-social__item"><a class="footer-social__link" title="Twitter" rel="noopener noreferrer" href="https://twitter.com/sec_consult"><span class="i-twitter"></span></a></li><li class="footer-social__item"><a class="footer-social__link" title="Linkedin" rel="noopener noreferrer" href="https://www.linkedin.com/company/sec-consult"><span class="i-linkedin"></span></a></li><li class="footer-social__item"><a class="footer-social__link" title="Xing" rel="noopener noreferrer" href="https://www.xing.com/companies/secconsultunternehmensberatunggmbh"><span class="i-xing"></span></a></li><li class="footer-social__item"><a class="footer-social__link" href="https://sec-consult.com/contact/"><span class="i-mail-alt"></span></a></li></ul></nav></div></div></footer></div>

<div class="tx-ls-cookie-consent">
    
    <div class="cookie-panel" data-lscookie-panel="1">
        <div class="cookie-panel__inner">
            <button class="cookie-panel__close" title="Close" data-lscookie-close="">
                <span class="cookie-panel__close--one"></span>
                <span class="cookie-panel__close--two"></span>
            </button>
            <div class="cookie-panel__panel">
                <h2 class="c-p-header">We use Cookies</h2>
                <div class="c-p-description">
                    <p>We use cookies to offer you a perfect visit experience. These include cookies that are necessary for the operation of the site and for the control of our commercial corporate goals, as well as those that are only used for anonymous statistical purposes, for convenience settings or to display personalized content. Decide for yourself which categories you want to allow. Please note that based on your settings, not all functions of the site may be available.</p>
<p><strong><a href="https://sec-consult.com/legalnotice/">Legal Notice</a></strong><strong>&nbsp;</strong> •&nbsp; <strong><a href="https://sec-consult.com/privacy-statement/">Privacy Statement</a></strong></p>
                </div>
                
                <form class="c-p-selection">
                    
                        <div class="c-p-group">
                            <div class="c-p-group__header">
                                <div class="c-p-group__header-left">
                                    <div class="c-p-group__name">
                                        <h3>
                                            Technically required
                                        </h3>
                                        <span>
                                            (
                                                0
                                                Service
                                            )
                                        </span>
                                    </div>
                                    
                                </div>
                                <div class="c-p-group__header-right">
                                    <div class="checkbox checkbox--labeled-slider checkbox--disabled">
                                        <span>no</span>
                                        <input class="checkbox-input" autocomplete="off" data-lscookie-grp="group-1" id="group-1" type="checkbox" checked="" disabled="" value="group-1">
                                        <label class="checkbox-label--switch" for="group-1">
                                            <span class="sr-only">
                                                Technically required (
                                                0
                                                Service
                                                )
                                            </span>
                                        </label>
                                        <div class="checkbox-slider__switch checkbox-slider__switch--labeled">

                                        </div>
                                        <span>yes</span>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="c-p-group">
                            <div class="c-p-group__header">
                                <div class="c-p-group__header-left">
                                    <div class="c-p-group__name">
                                        <h3>
                                            Analysis / statistics
                                        </h3>
                                        <span>
                                            (
                                                1
                                                Service
                                            )
                                        </span>
                                    </div>
                                    <p>Anonymous evaluation for troubleshooting and further development</p>
                                </div>
                                <div class="c-p-group__header-right">
                                    <div class="checkbox checkbox--labeled-slider">
                                        <span>no</span>
                                        <input class="checkbox-input" autocomplete="off" data-lscookie-grp="group-2" id="group-2" type="checkbox" value="group-2">
                                        <label class="checkbox-label--switch" for="group-2">
                                            <span class="sr-only">
                                                Analysis / statistics (
                                                1
                                                Service
                                                )
                                            </span>
                                        </label>
                                        <div class="checkbox-slider__switch checkbox-slider__switch--labeled">

                                        </div>
                                        <span>yes</span>
                                    </div>
                                </div>
                            </div>
                            
                                <div class="c-p-group__cookies">
                                    
                                        <div class="c-p-cookie">
                                            <div class="c-p-cookie__top">
                                                <h4>Matomo</h4>
                                                <div class="checkbox checkbox--labeled-slider">
                                                    <span>no</span>
                                                    <input class="checkbox-input" autocomplete="off" data-lscookie-parent="group-2" data-lscookie-cookie="cookie-5" id="cookie-5" type="checkbox" value="cookie-5">
                                                    <label class="checkbox-label--switch" for="cookie-5"><span class="sr-only">Matomo</span></label>
                                                    <div class="checkbox-slider__switch checkbox-slider__switch--labeled">
                                                    </div>
                                                    <span>yes</span>
                                                </div>
                                            </div>
                                            <div class="c-p-cookie__bottom">
                                                <span>Matomo.org</span>
                                                
                                                    <a href="https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/#" class="c-p-cookie__toggle" data-lscookie-toggle="#detail5">
                                                        <span class="c-p-cookie__toggle-show">
                                                            Show details
                                                        </span>
                                                        <span class="c-p-cookie__toggle-hide">
                                                            Hide details
                                                        </span>
                                                    </a>
                                                
                                            </div>
                                            <div class="c-p-cookie__detail" id="detail5">
                                                <p><strong>Purpose</strong>: Error analysis, statistical evaluation of our website accesses, campaign analysis, conversion tracking.<br> <strong>Processing operations</strong>: collection of access data, data from your browser and data about the content accessed; execution of analysis software and storage of data on your terminal device, anonymization of the data collected; evaluation of the anonymous data in the form of statistics.<br> <strong>Storage period</strong>: 1 year.<br> <strong>Joint controller</strong>: LimeSoda Interactive Marketing GmbH.<br> <strong>Legal basis for data processing</strong>: Art. 6 para. 1 lit. f of the DSGVO.<br> <strong>Consequences of non-consent</strong>: This basic tracking is absolutely necessary for the operation of our website.<br> <strong>Data transfer</strong>: The data collected with Matomo is stored on our own servers. It is not passed on to third parties.</p>
                                                <p></p>
                                            </div>
                                        </div>
                                    
                                </div>
                            
                        </div>
                    
                </form>
            </div>
            <div class="c-p-controls">
                <button data-lscookie-save="" class="c-p-btn--secondary">
                    Accept selected
                </button>
                <button data-lscookie-save="" data-lscookie-grp="none" class="c-p-btn--secondary">
                    Reject all
                </button>
                <button data-lscookie-save="" data-lscookie-grp="all" class="c-p-btn--secondary">
                    Accept all
                </button>
            </div>
        </div>
    </div>

</div>

<script src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/merged-64e71fe2fae3dfe72fe6a870bb75cf7e-55ab943080efcd2d91fe842c78f00f3c.js"></script>
<script async="async" src="./SMTP Smuggling - Spoofing E-Mails Worldwide - SEC Consult_files/cfd16b174d7f7b046e20adbc2e0a1094.js"></script>



</body></html>